(function WP$Payments$PaymentMethodEntryStepController$definition(){var p="fieldIsInvalid",Zb="fieldIsRequired",ib="@MYCHART@FIELDNAME@",yb="#TogglePaymentMethodType",Yb="#CardEntry-Column1",v="#CardInfoDiv",G="#CardEntry",hb="col-12",gb="#NicknameDiv",o="#CheckEntry",Xb="selectionMade",Wb="#CardEntry-AddressList",fb="#Address_",T="fieldContainsInvalidCharacters",Vb="#NicknameEntry",Ub=".ajaxspinner",Tb="body > .ajaxspinner",Sb="#PaymentMethodEntryStep > .ajaxspinner",xb="#AddressEntryFields",Rb="#CardEntryDivider",Qb="AccountState",Pb="#bank_account_type_",wb="last4digits",S="#last_four_",vb="#option_image_",eb="#expiration_",ub="#CardEntry-RoutingNumberValidIcon",Ob="#subway-cancel",Nb="#subway-back",n="true",Mb="#btnAddNewCard",R="selected",Lb="#payment_method_container_",tb="Payments/",sb="#Dialog-Save",Kb="#CardEntry-Nickname-Edit-Error",Jb="#EditNicknameField",H="noDisp",rb="#CardEntry-AccountNumberValidIcon",qb="SecurityCode",db="Nickname",Q="src",m="#nickname_",cb="evp-id",P="#payment_method_options_",bb="Payments/PaymentMethod/ShowPaymentResult?workflow=",Ib=".formbuttons",Hb="#pmtMethodHeader",F="#SavedPaymentMethod-Error",Gb="data-page-id",u="#AddCardForm",E="false",h="aria-disabled",d="disabled",D="POST",C="json",Fb="#CardEntry-AccountState",l="placeholder",Eb="#extPmtPageHeader",Db="#iFrameLoadingIndicator",pb="#CardEntry-ExpYYYY",ob="#CardEntry-ExpMM",Cb=".FieldToggle",nb="#CardEntry-CardNumber",B="#CardEntry-AccountNumberValidation",O="#CardEntry-AccountNumber",ab="#CardEntry-RoutingNumber",t="input",mb="blur",N="change",s="keyup",M="focusout",k="keydown",g="click",A="#PaymentMethodType-CreditCard",z="#PaymentMethodType-Check",e="Manual",j="hidden",Z="#divStoredPaymentMethodSection",y="#CardEntry-Nickname",Y="#CardEntry-SaveToken",r="ExpYYYY",x="ExpMM",X="CardholderName",W="CardNumber",lb="RoutingNumber",Bb="BankAccountLastName",V="BankAccountFirstName",L="AccountNumberValidation",K="AccountNumber",J="BankAccountTypeNumber",f="checked",U="#extPmtPageFrame",I="#AddPmtMethodIFrame",kb="#CardEntry-BrandImage",Ab="paymentWorkflowStepRendered",q="undefined",w="#subway-next",c="",b=false,jb="function",ac="Payments.Shared.CardSelection",a=true,i=null,zb=function WP$Payments$PaymentMethodEntryStepController(f,e,g,c,d){var b=this;b.WP$UI$SubwayStopController(f,e,$$WP.Templates.Payments.PaymentMethodEntryStep,i,a);b.CONST_CARDSELECTION_STRINGS=$$WP.Strings.getNamespace(ac);if(typeof c===jb)b._externalPaymentProcessedCallback=c;b._workflowController=d;b._validationFields={}},bc={CONST_CARDSELECTION_STRINGS:{},CONST_POLLING_INTERVAL:1e3,CONST_STRING_NAMESPACE:ac,s_addressFields:["Street","City","State","Zip","County","Country","HomePhone","Email"],_addCardFormShown:b,_addCheckFormShown:b,_isDeactivating:b,_iFrameShown:b,_isPolling:b,_nicknameShown:b,_pollingCount:0,_pollingLimit:0,_nicknameComponent:i,_overlayShown:b,_paymentSessionId:c,_uniqueIdentifier:c,_selectedAddressId:c,_selectedTokenEvpId:c,_tempNextButtonStateEnabled:b,_validationFields:i,_externalPaymentControlerName:"PaymentMethod",_externalPaymentProcessedCallback:i,_autoAdvanceOnSuccess:a,_forceSuccess:b,_clearPaymentMethodModelOnLoad:b,_forceDisableNext:b,_workflowController:i,activateStep:function WP$Payments$PaymentMethodEntryStepController$activateStep(c,b){this.WP$UI$SubwayStopController$activateStep(c);b(a)},deactivateStep:function WP$Payments$PaymentMethodEntryStepController$deactivateStep(e,d){var c=this;c.WP$UI$SubwayStopController$deactivateStep(e);if(c.DataPool.PaymentMethodModel.UseIFrame&&c._iFrameShown&&!c._forceSuccess){c._isDeactivating=a;c._closeIFrame();c._enableNavigation();d(a);c._iFrameShown=b;c._overlayShown=b}else{c._addCardFormShown=b;c._addCheckFormShown=b;c._iFrameShown=b;c._nicknameShown=b;d(a)}},renderStep:function WP$Payments$PaymentMethodEntryStepController$renderStep(){var a=this;if(a._clearPaymentMethodModelOnLoad)a.DataPool.PaymentMethodModel=i;a.DataPool.PaymentMethodEntryStepSettings&&a.DataPool.PaymentMethodEntryStepSettings.NextButtonCaption&&$$WP.FormValidation.updateButtonAfterValidation($afe.select(w),a.DataPool.PaymentMethodEntryStepSettings.NextButtonCaption);if(typeof a.DataPool.PaymentMethodModel===q||a.DataPool.PaymentMethodModel===i||a.DataPool.PaymentMethodModel.LoadingStatus!==$$WP.Payments.PaymentMethod.LoadingStatusEnum.Loaded){var b=a.$root.children(".subwayStep"),c=b.height();b.empty().safeAppend($afe.renderTemplate($$WP.Templates.Payments.Shared._PaymentStepLoading));$$WPUtil.ShowAjaxSpinner($afe.select("#PaymentMethodEntryStepLoading > .ajaxspinner"));a._disableNavigation();$$WP.Payments.DataPoolHelpers.loadPaymentMethodModel(a.DataPool,$.proxy(a._afterLoadPaymentMethodModel,a))}else{a.WP$UI$SubwayStopController$renderStep(a.DataPool.PaymentMethodModel);a._setupPage();$afe.jq(window).trigger(Ab)}},_setupPage:function WP$Payments$PaymentMethodEntryStepController$_setupPage(){var a=this,d=a.DataPool.PaymentPostingDataModel.PaymentWorkflow;a._enableNavigation();a._windowResizeHandler();$afe.select(kb).hide();$afe.select(".card_actions_container .SecurityCode").hide();if(!a.DataPool.PaymentMethodModel.UseIFrame)a._setupNewPaymentMethodEntryForm();else{if(d===$$WP.Payments.PaymentPostingData.WorkflowEnum.PayAsGuest||d===$$WP.Payments.PaymentPostingData.WorkflowEnum.PremiumGuestPay)a._externalPaymentControlerName="ExternalGuestPaymentMethod";$afe.select(I).hide();$afe.select(U).load($.proxy(a._afterIFrameContentLoad,a));a._setupSavedPaymentMethodInfoIcons()}a._setupEventListeners();a._updateNextButtonState(b);a._setupDefaultValuesFromDataPool();a._fixSidebar();$$WP.Payments.PaymentMethodEntryHelpers.alignStoredPaymentMethodEditButtons();var c=a.$root.find("img, input[type=image]");c.off("load");c.on("load",function(){$$WP.Payments.PaymentMethodEntryHelpers.alignStoredPaymentMethodEditButtons()})},_setupAddInfoIcons:function WP$Payments$PaymentMethodEntryStepController$_setupAddInfoIcons(){for(var c=[["SecurityCodeHelpBubble","newCardSecurityCodeHelpText"],["RoutingNumberHelpBubble","newCheckRoutingHelpText"],["AccountNumberHelpBubble","newCheckAccountNumberHelpText"],["AccountStateHelpBubble","newCheckAccountStateHelpText"],["DriversLicenseHelpBubble","newCheckDriversLicenseHelpText"],["NicknameHelpBubble","newPmtMthdNicknameHelpText"]],b=0;b<c.length;b++){var d=$afe.select("#"+c[b][0]);if(!d)continue;var e=new $$WP.UI.InfoBubble($$WP.UI.InfoBubble.SimpleInfoBubble($$WP.Strings.get(c[b][1],this.CONST_STRING_NAMESPACE),a));d.empty().safeAppend($afe.renderTemplate($$WP.Templates.UI.InfoBubble,e))}this._setupSavedPaymentMethodInfoIcons()},_setupSavedPaymentMethodInfoIcons:function WP$Payments$PaymentMethodEntryStepController$_setupSavedPaymentMethodInfoIcons(){var a=this;if(a.DataPool.PaymentMethodModel.SavedPaymentMethods&&a.DataPool.PaymentMethodModel.SavedPaymentMethods.length>0)for(var b=0;b<a.DataPool.PaymentMethodModel.SavedPaymentMethods.length;b++){$$WP.Payments.PaymentMethodEntryHelpers.setupSecurityCodeField(a.DataPool.PaymentMethodModel.SavedPaymentMethods[b].pageId);a._disableSecurityCode(a.DataPool.PaymentMethodModel.SavedPaymentMethods[b].pageId)}},_setupDefaultAddressValuesFromDataPool:function WP$Payments$PaymentMethodEntryStepController$_setupDefaultAddressValuesFromDataPool(){var a=this;this.DataPool.PaymentMethodModel.NewPmtMethodModel.AddressEntryFields&&this.DataPool.PaymentMethodModel.NewPmtMethodModel.AddressEntryFields.forEach(function(b){a._defaultOneFieldForCardEntry(b.Id)})},_setupDefaultBankAccountValuesFromDataPool:function WP$Payments$PaymentMethodEntryStepController$_setupDefaultBankAccountValuesFromDataPool(){var c=this,d=+c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.BankAccountTypeNumber;if(d===+$$WP.Payments.PaymentPostingData.BankAccountTypeEnum.Checking)$afe.select("#CardEntry-BankAccountTypeNumber-Checking").prop(f,a);else d===+$$WP.Payments.PaymentPostingData.BankAccountTypeEnum.Savings&&$afe.select("#CardEntry-BankAccountTypeNumber-Savings").prop(f,a);c._validateCheckEntry(J,b,a);var g=[K,L,V,Bb,lb],e=c;g.forEach(function(a){e._defaultOneFieldForBankAccountEntry(a)});c.DataPool.PaymentMethodModel.NewPmtMethodModel.BankAccountExtraFields&&c.DataPool.PaymentMethodModel.NewPmtMethodModel.BankAccountExtraFields.forEach(function(a){e._defaultOneFieldForBankAccountEntry(a.Id)})},_setupDefaultCardValuesFromDataPool:function WP$Payments$PaymentMethodEntryStepController$_setupDefaultCardValuesFromDataPool(){var a=[W,X,x,r],b=this;a.forEach(function(a){b._defaultOneFieldForCardEntry(a)});this.DataPool.PaymentPostingDataModel.PaymentMethodInfo.SecurityCode=c},_setupDefaultSaveTokenNicknameFromDataPool:function WP$Payments$PaymentMethodEntryStepController$_setupDefaultSaveTokenNicknameFromDataPool(){if(this.DataPool.PaymentPostingDataModel.PaymentMethodInfo.SaveToken){$afe.select(Y).prop(f,a);$afe.select(y).val(this.DataPool.PaymentPostingDataModel.PaymentMethodInfo.Nickname);this._showNicknameField()}},_setupDefaultValuesFromDataPool:function WP$Payments$PaymentMethodEntryStepController$_setupDefaultValuesFromDataPool(){var d=this,g=d.DataPool.PaymentPostingDataModel.SelectedPaymentMethod;!$$WP.Payments.DataPoolHelpers.hasAnySavedPaymentMethods(d.DataPool)&&$afe.select(Z).addClass(j);if(typeof g===q||!g)!$$WP.Payments.DataPoolHelpers.hasAnySavedPaymentMethods(d.DataPool)&&d._selectPaymentMethod(e,b);else{var k=d._getPageIdFromEvpId(g);if(typeof k===q||!k){d._selectPaymentMethod(e,b);return}d._selectPaymentMethod(k,a);if(g===e&&!d.DataPool.PaymentMethodModel.UseIFrame){var i=b,h=b;if(d.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCardAllowed&&d.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCheckAllowed){if(+d.DataPool.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodType===+$$WP.Payments.PaymentPostingData.PaymentMethodTypeEnum.BankAccount){$afe.select(z).prop(f,a);d._selectBankAccountOption(a);h=a}else if(+d.DataPool.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodType===+$$WP.Payments.PaymentPostingData.PaymentMethodTypeEnum.CreditCard){$afe.select(A).prop(f,a);d._selectCreditCardOption(a);i=a}}else if(d.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCardAllowed)i=a;else if(d.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCheckAllowed)h=a;if(i){d._setupDefaultCardValuesFromDataPool();d.DataPool.PaymentPostingDataModel.PaymentMethodInfo.HaveAddressInfo&&d.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId===e&&d._setupDefaultAddressValuesFromDataPool();d.DataPool.PaymentMethodModel.NewPmtMethodModel.AllowSavingPaymentMethod&&d._setupDefaultSaveTokenNicknameFromDataPool();d._updateNextButtonState(d._isFormValid())}else if(h){d._setupDefaultBankAccountValuesFromDataPool();d.DataPool.PaymentMethodModel.NewPmtMethodModel.AllowSavingPaymentMethod&&d._setupDefaultSaveTokenNicknameFromDataPool();d._updateNextButtonState(d._isFormValid())}}else if(d.DataPool.PaymentPostingDataModel.PaymentMethodInfo)d.DataPool.PaymentPostingDataModel.PaymentMethodInfo.SecurityCode=c}},_setupEventListeners:function WP$Payments$PaymentMethodEntryStepController$_setupEventListeners(){var a=this,h=$afe.select(".payment_method_option");h.on(g,$.proxy(a._selectPaymentMethodClickHandler,a));h.on(k,$.proxy(a._fakeButtonKeyHandler,a));var b=$afe.select("input.SecurityCode");b.on(M,$.proxy(a._savedPaymentMethodCVVFocusOut,a));b.on(k,$.proxy(a._keyPressForSavedPaymentMethodCVV,a));b.on(s,$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength);var d=$afe.select(".action_delete");d.on(g,$.proxy(a._deleteButtonClickHandler,a));d.on(k,$.proxy(a._fakeButtonKeyHandler,a));var f=$afe.select(".action_edit");f.on(g,$.proxy(a._editButtonClickHandler,a));f.on(k,$.proxy(a._fakeButtonKeyHandler,a));var e=$afe.select("#editModeLink");e.on(g,$.proxy(a._editModeClickHandler,a));e.on(k,$.proxy(a._fakeButtonKeyHandler,a));var c=$afe.select("#selectionModeLink");c.on(g,$.proxy(a._selectionModeClickHandler,a));c.on(k,$.proxy(a._fakeButtonKeyHandler,a));$afe.jq(window).on("resize orientationchange",$.proxy(a._windowResizeHandler,a))},_setupNewPaymentMethodEntryForm:function WP$Payments$PaymentMethodEntryStepController$_setupNewPaymentMethodEntryForm(){var c=".FieldInputBox",a=this;a._initCardValidationFields();a._setupAddInfoIcons();var d=$afe.select(".disableCopyPaste");d.on("contextmenu",$.proxy(a._preventDefault,a));d.on("paste",$.proxy(a._preventDefault,a));d.on("copy",$.proxy(a._preventDefault,a));$afe.select(A).on(N,$.proxy(a._selectCreditCardHandler,a));$afe.select(z).on(N,$.proxy(a._selectCheckHandler,a));$afe.select(A).on(f,$.proxy(a._selectCreditCardHandler,a));$afe.select(z).on(f,$.proxy(a._selectCheckHandler,a));$afe.select(Y).on(g,$.proxy(a._afterSaveCheckboxChangeHandler,a));$afe.select(Y).on(k,$.proxy(a._afterSaveCheckboxKeyHandler,a));$afe.select(y).on(M,$.proxy(a._afterNicknameChangeHandler,a));$afe.select(y).on(k,$.proxy(a._afterNicknameKeyDownHandler,a));$afe.select(c).on(mb,$.proxy(a._validateField,a));$afe.select(c).on(t,$.proxy(a._validateField,a));$afe.select(ab).on(s,$.proxy(a._duringRoutingNumberChangeHandler,a));$afe.select(O).on(s,$.proxy(a._duringAccountNumberChangeHandler,a));$afe.select(B).on(s,$.proxy(a._duringAccountNumberChangeHandler,a));$afe.select("#CardEntry-CardNumber, #CardEntry-AccountNumber, #CardEntry-AccountNumberValidation").on(M,$.proxy(a._pmtMethodNumberFocusOutHandler,a));var b=$afe.select(".CardEntryAddress");b.on(g,$.proxy(a._selectAddressClickHandler,a));b.on(k,$.proxy(a._fakeButtonKeyHandler,a));b=$afe.select(nb);b.on(s,$.proxy(a._duringCardNumberChangeHandler,a));b.on(N,$.proxy(a._afterCardNumberChangeHandler,a));b=$afe.select(Cb);b.on(mb,$.proxy(a._validateField,a));b.on(N,$.proxy(a._validateField,a));$afe.select("#CardEntry-BankAccountFirstName").on(t,$.proxy(a._duringCheckNameChangeHandler,a));$afe.select("#CardEntry-BankAccountLasttName").on(t,$.proxy(a._duringCheckNameChangeHandler,a));b=$afe.select(ob);b.on(t,$.proxy(a._duringCardEntryMMInputHandler,a));if($$WP.Utilities.UI.IsMobile)b.on(s,$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength);$afe.select(pb).on(s,$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength);a._forceDisableNext=a.DataPool.PaymentMethodModel.NewPmtMethodModel.ShowSaveButton},_afterIFrameContentLoad:function WP$Payments$PaymentMethodEntryStepController$_afterIFrameContentLoad(){$afe.select(Db).addClass(j);$afe.select(Eb).removeClass(j);this._fixSidebar()},_afterNicknameChangeHandler:function WP$Payments$PaymentMethodEntryStepController$_afterNicknameChangeHandler(){this.DataPool.PaymentPostingDataModel.PaymentMethodInfo.Nickname=$afe.select(y).val()},_afterNicknameKeyDownHandler:function WP$Payments$PaymentMethodEntryStepController$_afterNicknameKeyDownHandler(a){(a.which===13||a.which===9)&&$afe.select(y).trigger(M)},_afterSaveCheckboxChangeHandler:function WP$Payments$PaymentMethodEntryStepController$_afterSaveCheckboxChangeHandler(){var a=this;if(a._nicknameShown){a._hideNickname();a.DataPool.PaymentPostingDataModel.PaymentMethodInfo.Nickname=c}else a._showNicknameField();a.DataPool.PaymentPostingDataModel.PaymentMethodInfo.SaveToken=$afe.select(Y).is(":checked");a._fixSidebar()},_pmtMethodNumberFocusOutHandler:function WP$Payments$PaymentMethodEntryStepController$_pmtMethodNumberFocusOutHandler(d){var a=$afe.jq(d.delegateTarget);if(a.length>0&&a.val()!==c){a.safeAttr(l,c);var b=a.safeAttr("id");if(b==="CardEntry-AccountNumber")$afe.select(B).safeAttr(l,c);else b==="CardEntry-AccountNumberValidation"&&$afe.select(O).safeAttr(l,c)}},_fakeButtonKeyHandler:function WP$Payments$PaymentMethodEntryStepController$_fakeButtonKeyHandler(a){if(a.which===13||a.which===32){$afe.jq(a.delegateTarget).trigger(g);return b}},_windowResizeHandler:function WP$Payments$PaymentMethodEntryStepController$_windowResizeHandler(){var a="#SavedPaymentMethods .card, .card_actions_container";if($afe.select("#main").width()<=900)$afe.select(a).removeClass("col-4").addClass("col-6");else $afe.select(a).removeClass("col-6").addClass("col-4");$$WP.Payments.PaymentMethodEntryHelpers.alignStoredPaymentMethodEditButtons();$afe.select(Fb).width($afe.select(ab).width())},_keyPressForSavedPaymentMethodCVV:function WP$Payments$PaymentMethodEntryStepController$_keyPressForSavedPaymentMethodCVV(a){var b=a.which;if(b===13||b===9){var c=$afe.jq(a.delegateTarget);if(b===13&&c.parent(".CardButtons").length>0){$afe.select(w).focus();a.stopImmediatePropagation();a.preventDefault()}else c.trigger(M)}},_saveNewCard:function WP$Payments$PaymentMethodEntryStepController$_saveNewCard(){var b=this;if(b.DataPool.PaymentMethodModel.NewPmtMethodModel.ShowSaveButton&&!b.DataPool.PaymentMethodModel.NewPmtMethodModel.HideSaveForFutureCheckbox&&!b.DataPool.PaymentPostingDataModel.PaymentMethodInfo.SaveToken)b.DataPool.PaymentPostingDataModel.PaymentMethodInfo.SingleUse=a;var c=$.proxy(b._afterTokenizePaymentMethod,b);b._showSectionOverlay();$.ajax({data:$$WPUtil.postify(b.DataPool.PaymentPostingDataModel),dataType:C,type:D,url:makeLink("Payments/PaymentMethod/TokenizePaymentMethod"),success:c,error:c})},_afterTokenizePaymentMethod:function WP$Payments$PaymentMethodEntryStepController$_afterTokenizePaymentMethod(a){this._hideSectionOverlay();this._handleTokenizePaymentMethodResponse(a.Success,a.EncEvpId,a.ErrorMessage)},_handleTokenizePaymentMethodResponse:function WP$Payments$PaymentMethodEntryStepController$_handleTokenizePaymentMethodResponse(k,j){var c=this;if(k===a){c.DataPool.PaymentPostingDataModel.SelectedPaymentMethod=j;c._clearPaymentMethodModelOnLoad=a;var f=$afe.select(w);f.removeClass(d);f.prop(d,b);f.safeAttr(h,E);f.show();c._autoAdvanceOnSuccess&&f.click()}else{if(c._addCardFormShown){c._cardEntrySecurityClear();c._disableCardEntrySubmit()}else if(c._addCheckFormShown){c._checkEntrySecurityClear();c._disableCardEntrySubmit()}else{c._hideIFrame();c._selectPaymentMethod(e,a)}var g;if(c.DataPool.PaymentMethodModel.NewPmtMethodModel&&c.DataPool.PaymentMethodModel.NewPmtMethodModel.HideSaveForFutureCheckbox)g=$$WP.Strings.getForTemplate("saveErrFailedToSaveCardInline",c.CONST_STRING_NAMESPACE);else g=$$WP.Strings.getForTemplate("processErrFailedToSaveCardInline",c.CONST_STRING_NAMESPACE);var i=c.DataPool.PaymentMethodModel.UseIFrame?I:u;$$WPUtil.SmoothScrollToElement($$WPUtil.ScrollableBody(),$afe.select(i),100,function(){$$WPUtil.quickMessageBoxByEnum(g,$$WPUtil.quickMessageBoxByEnum.typeEnum.Ok)})}},_savedPaymentMethodCVVFocusOut:function WP$Payments$PaymentMethodEntryStepController$_savedPaymentMethodCVVFocusOut(a){if(this.DataPool.PaymentPostingDataModel.PaymentMethodInfo)this.DataPool.PaymentPostingDataModel.PaymentMethodInfo.SecurityCode=$afe.jq(a.delegateTarget).val()},_selectCheckHandler:function WP$Payments$PaymentMethodEntryStepController$_selectCheckHandler(d){var a=this,c=d.currentTarget.checked;if(c&&!a._addCheckFormShown){a._selectBankAccountOption();a._fixSidebar()}else if(!c)a._addCheckFormShown=b},_selectCreditCardHandler:function WP$Payments$PaymentMethodEntryStepController$_selectCreditCardHandler(d){var a=this,c=d.currentTarget.checked;if(c&&!a._addCardFormShown){a._selectCreditCardOption();a._fixSidebar()}else if(!c)a._addCardFormShown=b},_selectPaymentMethodClickHandler:function WP$Payments$PaymentMethodEntryStepController$_selectPaymentMethodClickHandler(a){var b=$afe.jq(a.delegateTarget).safeAttr(Gb);this._selectPaymentMethod(b);this._clearFieldError(F);this._fixSidebar()},_editModeClickHandler:function WP$Payments$PaymentMethodEntryStepController$_editModeClickHandler(b){var a=this;$afe.select(Z).empty().safeAppend($afe.renderTemplate($$WP.Templates.Payments.Shared.EditStoredPaymentMethodsSection,a.DataPool.PaymentMethodModel));a._setupEventListeners();a._disableNavigation();a._enableCancelButton();$afe.select(u).hide();$$WP.Strings.setDisplayText($afe.select(Hb),"editModeHeader",a.CONST_STRING_NAMESPACE);$afe.select("#editModeDescription").focus();$afe.select(Ib).hide();b&&b.preventDefault()},_selectionModeClickHandler:function WP$Payments$PaymentMethodEntryStepController$_selectionModeClickHandler(c){var b=this;$afe.select(Z).empty().safeAppend($afe.renderTemplate($$WP.Templates.Payments.Shared.StoredPaymentMethodsSection,b.DataPool.PaymentMethodModel));b._setupEventListeners();b._setupSavedPaymentMethodInfoIcons();b._enableNavigation();$afe.select(Ib).show();$afe.select(Hb).text(b.DataPool.PaymentMethodModel.HeaderText);var d=b.DataPool.PaymentPostingDataModel.SelectedPaymentMethod;if(d){var e=b._getPageIdFromEvpId(d);b._selectPaymentMethod(e,a)}$afe.select("#selectionModeDescription").focus();c&&c.preventDefault()},_afterClearPaymentSession:function WP$Payments$PaymentMethodEntryStepController$_afterClearPaymentSession(d){var c=this;if(c._forceSuccess){d.Success=a;c._isDeactivating=b}if(d.Success===a)if(c._isDeactivating){c._isDeactivating=b;c._iFrameShown=b;c._overlayShown=b}else{c._hideIFrame();c._hideSectionOverlay();c._fixSidebar()}else if(d.KeepPolling===a){c._isPolling=a;c._pollingCount=0;c._pollingLimit=5;setTimeout($.proxy(c._pollForPaymentResult,c),c.CONST_POLLING_INTERVAL)}else{WP.Events.cancelBeforeUnload();if(c.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment&&c._workflowController.isECheckInWorkflow())c._workflowController.handleConfirmationPageForECheckIn({workflow:c._dataPool.PaymentPostingDataModel.PaymentWorkflow});else $$WPUtil.TryRedirect(makeLink(bb+encodeURIComponent(c.DataPool.PaymentPostingDataModel.PaymentWorkflow)))}},_afterDeletePmtMtd:function WP$Payments$PaymentMethodEntryStepController$_afterDeletePmtMtd(g){var d=this,f;g=g||{};if(g.Success){f=g.PageId;if(d.DataPool.PaymentPostingDataModel.SelectedPaymentMethod===$afe.select(P+f).data(cb)){d._selectedTokenEvpId=c;d._updateNextButtonState(b);d._deselectCurrentPaymentMethod()}d._hideSectionOverlay(a);$afe.select("#payment_method_options_container_"+f).remove();$$WP.Payments.DataPoolHelpers.removePaymentMethod(d.DataPool,f);var i=f+1,h=$afe.select("Edit_"+i);h.length>0&&h.focus();if($$WP.Payments.DataPoolHelpers.getNumberOfSavedPaymentMethods(d.DataPool)===0){d._selectPaymentMethod(e,b);d._selectionModeClickHandler();$afe.select(Z).addClass(j);$afe.select("#newEntryModeDescription").focus()}}else{d._hideSectionOverlay(a);d._showFieldError(F,"deletePaymentMethodError");return}d._fixSidebar()},_afterEditNicknameHandler:function WP$Payments$PaymentMethodEntryStepController$_afterEditNicknameHandler(f){var j="#AccountName_",h="#aria_label_",g=this,a,d,e;f=f||{};if(f.Success){var b=f.NewNickname;a=f.PageId;d=$afe.select(m+a);d.text(b);d.safeAttr("title",b);e=g._getAriaLabelForPaymentMethod(a,b);$afe.select(h+a).text(e);g._updateSavedPaymentMethodNicknameInDataPool(a,b,e);if(b!==i&&b!==c){d.show();$afe.select(j+a).hide()}else{d.hide();$afe.select(j+a).show()}$$WP.Payments.PaymentMethodEntryHelpers.alignEditNicknameButton($afe.select("#Card_"+a));e=g._getAriaLabelForPaymentMethod(a,b);$afe.select(h+a).text(e)}else{g._showFieldError(F,"editNicknameError");g._fixSidebar();return}},_afterGetExtPmtPageUrl:function WP$Payments$PaymentMethodEntryStepController$_afterGetExtPmtPageUrl(d){var c=this;if(d.Success&&!$$WPUtil.IsNullOrEmpty(d.SessionId)&&!$$WPUtil.IsNullOrEmpty(d.Url)){c._paymentSessionId=d.SessionId;c._isPolling=a;$afe.select(U).safeAttr(Q,d.Url);c._showIFrame();c._pollForPaymentResult()}else{c._showFieldError(F,"loadIFrameError");c._hideIFrame();c._updateNextButtonState(b)}c._fixSidebar()},_afterPollForPaymentResult:function WP$Payments$PaymentMethodEntryStepController$_afterPollForPaymentResult(e){var f="PaymentMethodIsCard",h="PaymentMethodType",g="LastFour",d=this;d._pollingCount++;if(e.Success===a&&e.SessionState===$$WP.Payments.PaymentPostingData.SessionStateEnum.Unknown||e.SessionState===$$WP.Payments.PaymentPostingData.SessionStateEnum.PaymentCompleted){d._isPolling=b;WP.Events.cancelBeforeUnload();if(d.DataPool.PaymentPostingDataModel.GetExternalResultInfoObject){$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"Success",e.Success);if(e.Success){$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,g,e.LastFour,d._getFieldTitle(g));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,db,e.Nickname,d._getFieldTitle(db));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,h,e.MethodType,d._getFieldTitle(h));$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"PaymentDate",e.PaymentDate);$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"AuthCode",e.AuthCode);$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"TotalAuthorizedAmount",e.TotalAuthorizedAmount);$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"MerchantId",e.MerchantId);$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"TransactionId",e.TransactionId);$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"TrySavePaymentDetails",e.TrySavePaymentDetails);$$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"TokenSavingFailed",e.TokenSavingFailed);if(e.MethodType===0){$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,f,a,d._getFieldTitle(f));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,x,e.ExpMM,d._getFieldTitle(x));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,r,e.ExpYYYY,d._getFieldTitle(r));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,X,e.HolderName,d._getFieldTitle(X));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,"Brand",e.Brand,d._getFieldTitle("Brand"))}else{$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,f,b,d._getFieldTitle(f));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,J,e.AccountType,d._getFieldTitle(J));$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(d.DataPool,V,e.HolderName,d._getFieldTitle(V))}d._forceSuccess=a}else $$WP.Payments.DataPoolHelpers.setPaymenResultInfoData(d.DataPool,"DeclineType",e.DeclineType);typeof d._externalPaymentProcessedCallback===jb&&d._externalPaymentProcessedCallback();d._handleTokenizePaymentMethodResponse(e.Success,e.TokenId,c)}else if(d.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment&&d._workflowController.isECheckInWorkflow()){var i={workflow:d.DataPool.PaymentPostingDataModel.PaymentWorkflow,id:e.ConfirmationId};d._workflowController.handleConfirmationPageForECheckIn(i)}else $$WPUtil.TryRedirect(makeLink(bb+encodeURIComponent(d.DataPool.PaymentPostingDataModel.PaymentWorkflow)+"&id="+encodeURIComponent(e.ConfirmationId)))}else if(d._pollingLimit>0&&d._pollingCount>=d._pollingLimit){WP.Events.cancelBeforeUnload();if(d.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment&&d._workflowController.isECheckInWorkflow())d._workflowController.handleConfirmationPageForECheckIn({workflow:d._dataPool.PaymentPostingDataModel.PaymentWorkflow});else $$WPUtil.TryRedirect(makeLink(bb+encodeURIComponent(d.DataPool.PaymentPostingDataModel.PaymentWorkflow)));typeof d._externalPaymentProcessedCallback===jb&&d._externalPaymentProcessedCallback()}else setTimeout($.proxy(d._pollForPaymentResult,d),d.CONST_POLLING_INTERVAL)},_afterLoadPaymentMethodModel:function WP$Payments$PaymentMethodEntryStepController$_afterLoadPaymentMethodModel(b){var a=this;a._hideSectionOverlay();if(b){a.WP$UI$SubwayStopController$renderStep(a.DataPool.PaymentMethodModel);a._setupPage();$afe.jq(window).trigger(Ab)}else{WP.Events.cancelBeforeUnload();if(a.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment&&a._workflowController.isECheckInWorkflow())a._workflowController.handleConfirmationPageForECheckIn({workflow:a._dataPool.PaymentPostingDataModel.PaymentWorkflow});else $$WPUtil.TryRedirect(makeLink(bb+encodeURIComponent(a.DataPool.PaymentPostingDataModel.PaymentWorkflow)))}},_areAddressFieldsVisible:function WP$Payments$PaymentMethodEntryStepController$_areAddressFieldsVisible(){return this.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId===e},_cardEntrySecurityClear:function WP$Payments$PaymentMethodEntryStepController$_cardEntrySecurityClear(){var a=this;$afe.select(nb).val(c);$afe.select("#CardEntry-SecurityCode").val(c);a._setEntryBrandImage(c);a._validationFields.CardNumber=b;a._validationFields.SecurityCode=!a._isFieldRequired(qb)},_checkBankAccountNumbersMatch:function WP$Payments$PaymentMethodEntryStepController$_checkBankAccountNumbersMatch(){var f=$afe.select(O),d=f.val();if(d===c)d=$$WP.Payments.PaymentMethodEntryHelpers.getPlaceholderString(f);var g=$afe.select(B),e=g.val();if(e===c)e=$$WP.Payments.PaymentMethodEntryHelpers.getPlaceholderString(g);if(d!==c&&d===e){$afe.select(rb).show();return a}$afe.select(rb).hide();return b},_checkEntrySecurityClear:function WP$Payments$PaymentMethodEntryStepController$_checkEntrySecurityClear(){$afe.select(B).val(c);this._validationFields.AccountNumberValidation=b;$afe.select(rb).hide()},_clearFieldError:function WP$Payments$PaymentMethodEntryStepController$_clearFieldError(a){$afe.select(a).addClass(H);$afe.select(a).empty()},_clickConfirmDeletePopup:function WP$Payments$PaymentMethodEntryStepController$_clickConfirmDeletePopup(c,d,b,a){a==="toolbarcontinue"&&this._deletePaymentMethod(c,d,b)},_clickEditNickname:function WP$Payments$PaymentMethodEntryStepController$_clickEditNickname(c){switch(c.dataId){case"save":var a=$afe.select("#EditTokenPopUp"),g=a.data("evpid"),f=a.data("pageid"),e=$afe.select(Jb).val(),b=$afe.select(Kb);if(!this._editNickname(g,f,e)){b.removeClass(j);break}if($afe.select(sb).hasClass(d))break;b.addClass(j);case"goBack":this._nicknameComponent.dispose();this._nicknameComponent=i;c.preventDefault()}},_closeIFrame:function WP$Payments$PaymentMethodEntryStepController$_closeIFrame(){var a=this;a._isPolling=b;if(a._iFrameShown){var c=$.proxy(a._afterClearPaymentSession,a);a._showSectionOverlay();$.ajax({data:{sessionId:a._paymentSessionId},dataType:C,type:D,url:makeLink(tb+a._externalPaymentControlerName+"/ClearPaymentSession"),success:c,error:c})}},_defaultOneFieldForBankAccountEntry:function WP$Payments$PaymentMethodEntryStepController$_defaultOneFieldForBankAccountEntry(c){var d=this,e=$afe.select(d._getFieldIdInput(c));if(e.length>0){if(c===K||c===L)e.safeAttr(l,$$WP.Payments.DataPoolHelpers.getLastFourDisplayString(d.DataPool));else e.val($$WP.Payments.DataPoolHelpers.getPaymentMethodInfoFieldData(d.DataPool,c));d._validateCheckEntry(c,b,a)}},_defaultOneFieldForCardEntry:function WP$Payments$PaymentMethodEntryStepController$_defaultOneFieldForCardEntry(c){var d=this,e=$afe.select(d._getFieldIdInput(c));if(e.length>0){if(c===W)e.safeAttr(l,$$WP.Payments.DataPoolHelpers.getLastFourDisplayString(d.DataPool));else e.val($$WP.Payments.DataPoolHelpers.getPaymentMethodInfoFieldData(d.DataPool,c));d._validateCardEntry(c,b,a)}},_deleteButtonClickHandler:function WP$Payments$PaymentMethodEntryStepController$_deleteButtonClickHandler(c){var b=this;c.stopImmediatePropagation();var a=$afe.jq(c.currentTarget),e=a.data("page-id"),f=a.data(cb),g=a.data("token");b._clearFieldError(F);if(a.hasClass(d)){$$WPUtil.quickMessageBoxByEnum($$WP.Strings.getForTemplate("deleteButtonTitleDisabled",b.CONST_STRING_NAMESPACE),$$WPUtil.quickMessageBoxByEnum.typeEnum.Ok);return}b._verifyDelete(f,g,e);b._fixSidebar()},_deletePaymentMethod:function WP$Payments$PaymentMethodEntryStepController$_deletePaymentMethod(d,e,c){var a=this,b=$.proxy(a._afterDeletePmtMtd,a);a._showSectionOverlay();$.ajax({data:$$WP.Payments.DataPoolHelpers.getDataToDeletePaymentMethod(a.DataPool,d,e,c),dataType:C,type:D,url:makeLink("Payments/PaymentMethod/DeletePaymentMethod"),success:b,error:b})},_deselectCurrentPaymentMethod:function WP$Payments$PaymentMethodEntryStepController$_deselectCurrentPaymentMethod(){var a=this,b=c,d=a.DataPool.PaymentPostingDataModel.SelectedPaymentMethod;if(d)b=a._getPageIdFromEvpId(d);if(b!==c){if(b===e)if(a.DataPool.PaymentMethodModel.UseIFrame)a._closeIFrame();else a._hideAddCardForm();$afe.select(Lb+b).removeClass(R);a._disableSecurityCode(b);a._setPaymentMethodSelectionInDataPool(c)}},_disableCardEntrySubmit:function WP$Payments$PaymentMethodEntryStepController$_disableCardEntrySubmit(){var c=$afe.select(Mb);c.prop(d,a);c.safeAttr(h,n);c.off(g);c.addClass(d);this._updateNextButtonState(b)},_disableNavigation:function WP$Payments$PaymentMethodEntryStepController$_disableNavigation(){var b=this,c;if(b.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment){$$WP.BillPay.VisitPaymentHelpers.disableBackButton(b.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,b._workflowController.parentWorkflowController);$$WP.BillPay.VisitPaymentHelpers.disableCancelOrFinishLater(b.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,b._workflowController.parentWorkflowController);c=$$WP.BillPay.VisitPaymentHelpers.getNextButton(b.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,b._workflowController.parentWorkflowController);b._tempNextButtonStateEnabled=!c.hasClass(d);$$WP.BillPay.VisitPaymentHelpers.disableNextButton(b.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,b._workflowController.parentWorkflowController)}else{c=$afe.select(w);b._tempNextButtonStateEnabled=!c.hasClass(d);c.addClass(d);c.prop(d,a);c.safeAttr(h,n);var f=$afe.select(Nb);f.addClass(d);f.prop(d,a);f.safeAttr(h,n);var e=$afe.select(Ob);e.addClass(d);e.prop(d,a);e.safeAttr(h,n)}},_disableSecurityCode:function WP$Payments$PaymentMethodEntryStepController$_disableSecurityCode(g){var e="aria-hidden",b="#security_code_grouper_",f=$afe.select(b+g+" input");f.val(c);f.prop(d,a).safeAttr(h,n);f.safeAttr(e,n);$afe.select(b+g).safeAttr(e,n);$afe.select(b+g+" .infoBubbleTarget").prop("tabindex","-1")},_duringAccountNumberChangeHandler:function WP$Payments$PaymentMethodEntryStepController$_duringAccountNumberChangeHandler(){this._checkBankAccountNumbersMatch()},_duringCardEntryMMInputHandler:function WP$Payments$PaymentMethodEntryStepController$_duringCardEntryMMInputHandler(){var b=$afe.select(ob).val(),a=parseInt(b,10);(a>=2&&a<=9||a>=10&&a<=12||b==="01")&&$afe.select(pb).focus()},_duringCardNumberChangeHandler:function WP$Payments$PaymentMethodEntryStepController$_duringCardNumberChangeHandler(a){$$WP.Utilities.UI.IsMobile&&$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength(a);var b=a.target.value.replace(/\D/g,c);this._setEntryBrandImage(b)},_duringCheckNameChangeHandler:function WP$Payments$PaymentMethodEntryStepController$_duringCheckNameChangeHandler(){var a=$afe.select(Cb);a.trigger(mb)},_duringRoutingNumberChangeHandler:function WP$Payments$PaymentMethodEntryStepController$_duringRoutingNumberChangeHandler(b){$$WP.Utilities.UI.IsMobile&&$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength(b);var a=$afe.select(ab).val();if($$WP.Payments.FormValidationHelpers.isValidRoutingNumber(a))$afe.select(ub).show();else $afe.select(ub).hide()},_editButtonClickHandler:function WP$Payments$PaymentMethodEntryStepController$_editButtonClickHandler(a){a.stopImmediatePropagation();a.preventDefault();var b=$afe.jq(a.currentTarget).data("page-id"),c=$afe.jq(a.currentTarget).data(cb),d=$afe.jq(a.currentTarget).data("token");this._clearFieldError(F);this._launchEditNickname(c,d,b);this._fixSidebar()},_editNickname:function WP$Payments$PaymentMethodEntryStepController$_editNickname(g,f,d){if(!$$WP.Payments.FormValidationHelpers.isValidNickname(d))return b;var e={encEvpId:g,newNickname:d,pageId:f},c=$.proxy(this._afterEditNicknameHandler,this);$.ajax({data:e,dataType:C,type:D,url:makeLink("Payments/PaymentMethod/EditNickname"),success:c,error:c});return a},_editNicknameChangeEvt:function WP$Payments$PaymentMethodEntryStepController$_editNicknameChangeEvt(b){var c=b.dataId,a=$afe.select(Kb);switch(c){case"editNicknameField":if(!$$WP.Payments.FormValidationHelpers.isValidNickname($afe.select(Jb).val())){a.removeClass(j);$afe.select(sb).addClass(d)}else{a.addClass(j);$afe.select(sb).removeClass(d)}}},_enableCardEntrySubmit:function WP$Payments$PaymentMethodEntryStepController$_enableCardEntrySubmit(){var e=this,c=$afe.select(Mb);c.prop(d,b);c.safeAttr(h,E);c.off(g).on(g,$.proxy(e._saveNewCard,e));c.removeClass(d);!e._forceDisableNext&&e._updateNextButtonState(a)},_enableNavigation:function WP$Payments$PaymentMethodEntryStepController$_enableNavigation(){var a=this;if(a.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment){$$WP.BillPay.VisitPaymentHelpers.enableBackButton(a.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,a._workflowController.parentWorkflowController);$$WP.BillPay.VisitPaymentHelpers.enableCancelOrFinishLater(a.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,a._workflowController.parentWorkflowController);a._tempNextButtonStateEnabled&&$$WP.BillPay.VisitPaymentHelpers.enableNextButton(a.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,b,a._workflowController.parentWorkflowController);a._iFrameShown&&$$WP.BillPay.VisitPaymentHelpers.hideNextButton(a.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,a._workflowController.parentWorkflowController)}else{var c=$afe.select(w);if(a._tempNextButtonStateEnabled){c.removeClass(d);c.prop(d,b);c.safeAttr(h,E)}!a._iFrameShown&&c.show();var e=$afe.select(Nb);e.removeClass(d);e.prop(d,b);e.safeAttr(h,E);a._enableCancelButton()}},_enableCancelButton:function WP$Payments$PaymentMethodEntryStepController$_enableCancelButton(){var a=$afe.select(Ob);a.removeClass(d);a.prop(d,b);a.safeAttr(h,E)},_fixSidebar:function WP$Payments$PaymentMethodEntryStepController$_fixSidebar(){if(this.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.PayAsGuest)$$WPUtil.CalculateAndSetBodyHeight();else $afe.jq(window).trigger("matchColumnHeights")},_getAriaLabelForPaymentMethod:function WP$Payments$PaymentMethodEntryStepController$_getAriaLabelForPaymentMethod(b,d){var n="@MYCHART@ARIABANKLASTFOUR@",l="@MYCHART@ARIABANKTYPE@",k="@MYCHART@ARIABANKNAME@",j="@MYCHART@ARIACARDLASTFOUR@",h="@MYCHART@ARIACARDBRAND@",g="@MYCHART@ARIACARDYYYY@",f="@MYCHART@ARIACARDMM@",e="@MYCHART@ARIACARDNAME@",a=this,p=$afe.select(P+b).data("type"),o;if(d===i||d===c)d=zb===0?$afe.select(m+b).data("CardHolderName"):$afe.select(m+b).data("BankAccountName");if(p===0){a.CONST_CARDSELECTION_STRINGS.addMnemonic(e,d,$$WP.Strings.EncodingTypes.None);a.CONST_CARDSELECTION_STRINGS.addMnemonic(f,$afe.select(eb+b).data("mm"));a.CONST_CARDSELECTION_STRINGS.addMnemonic(g,$afe.select(eb+b).data("yyyy"));a.CONST_CARDSELECTION_STRINGS.addMnemonic(h,$afe.select(vb+b).data("brandname"));a.CONST_CARDSELECTION_STRINGS.addMnemonic(j,$afe.select(S+b).data(wb));o=a.CONST_CARDSELECTION_STRINGS.getString("fullCardDescAriaLabel");a.CONST_CARDSELECTION_STRINGS.removeMnemonic(e);a.CONST_CARDSELECTION_STRINGS.removeMnemonic(f);a.CONST_CARDSELECTION_STRINGS.removeMnemonic(g);a.CONST_CARDSELECTION_STRINGS.removeMnemonic(h);a.CONST_CARDSELECTION_STRINGS.removeMnemonic(j)}else{a.CONST_CARDSELECTION_STRINGS.addMnemonic(k,d,$$WP.Strings.EncodingTypes.None);a.CONST_CARDSELECTION_STRINGS.addMnemonic(l,$afe.select(Pb+b).text());a.CONST_CARDSELECTION_STRINGS.addMnemonic(n,$afe.select(S+b).data(wb));o=a.CONST_CARDSELECTION_STRINGS.getString("fullBankDescAriaLabel");a.CONST_CARDSELECTION_STRINGS.removeMnemonic(k);a.CONST_CARDSELECTION_STRINGS.removeMnemonic(l);a.CONST_CARDSELECTION_STRINGS.removeMnemonic(n)}return o},_getFieldBase:function WP$Payments$PaymentMethodEntryStepController$_getFieldBase(a){return a===i||a===c||a.indexOf("-")===-1?c:a.split("-")[1]},_getFieldDisplayName:function WP$Payments$PaymentMethodEntryStepController$_getFieldDisplayName(a){return a===x||a===r?$afe.select("#CardEntry-Exp-Label").text().trim():$afe.select(this._getFieldIdInput(a)+"-Label").text().trim()},_getFieldIdError:function WP$Payments$PaymentMethodEntryStepController$_getFieldIdError(a){return a===x||a===r?"#CardEntry-Exp-Error":this._getFieldIdInput(a)+"-Error"},_getFieldIdInput:function WP$Payments$PaymentMethodEntryStepController$_getFieldIdInput(a){return"#CardEntry-"+a},_getFieldTitle:function WP$Payments$PaymentMethodEntryStepController$_getFieldTitle(a){return a==="State"?$afe.select("#CardEntry-State option:selected").text():a==="County"?$afe.select("#CardEntry-County option:selected").text():a==="Country"?$afe.select("#CardEntry-Country option:selected").text():a===Qb?$afe.select("#CardEntry-AccountState option:selected").text():c},_getFieldValue:function WP$Payments$PaymentMethodEntryStepController$_getFieldValue(a){return a===this._getFieldIdInput(J)?$afe.select(a+" input[type='radio']:checked").val():$afe.select(a).val()},_getNewPageId:function WP$Payments$PaymentMethodEntryStepController$_getNewPageId(){var a=$afe.select(".SavedCard").length;while($afe.select("#Card_"+a).length>0)a++;return a},_getPageIdFromEvpId:function WP$Payments$PaymentMethodEntryStepController$_getPageIdFromEvpId(b){var d=c,a=$afe.select("input[data-evp-id='"+b+"']");if(a.length===0)a=$afe.select("label[data-evp-id='"+b+"']");if(a.length>0)d=a.safeAttr(Gb);return d},_hideAddCardForm:function WP$Payments$PaymentMethodEntryStepController$_hideAddCardForm(){var a=this;a._disableCardEntrySubmit();a._addCardFormShown=b;a._addCheckFormShown=b;$afe.select(u).hide();a._resetCardEntryForm()},_hideAddressEntryFields:function WP$Payments$PaymentMethodEntryStepController$_hideAddressEntryFields(){$afe.select(Rb).height(250);$afe.select(xb).hide(0,function(){$afe.select("#AddressEntryFieldss").addClass(H)});this._updateAddressValidationFields()},_hideIFrame:function WP$Payments$PaymentMethodEntryStepController$_hideIFrame(){$$WPUtil.ShowAjaxSpinner($afe.select(Sb));$afe.select(Tb).safeAttr("style","display:block;");this._iFrameShown=b;$afe.select(I).hide();$afe.select(U).safeAttr(Q,"about:blank");$afe.select(Eb).addClass(j)},_hideSectionOverlay:function WP$Payments$PaymentMethodEntryStepController$_hideSectionOverlay(a){this._overlayShown=b;$$WPUtil.HideAjaxSpinner($afe.select(Ub));!a&&this._enableNavigation()},_hideNickname:function WP$Payments$PaymentMethodEntryStepController$_hideNickname(){if(this._nicknameShown){this._nicknameShown=b;$afe.select(Vb).addClass(H);$afe.select(y).val(c)}},_isCurrentlySeletected:function WP$Payments$PaymentMethodEntryStepController$_isCurrentlySelected(g){var d=this.DataPool.PaymentPostingDataModel.SelectedPaymentMethod,e=b;if(d){var f=this._getPageIdFromEvpId(d);if(c+f===c+g)e=a}return e},_initCardValidationFields:function WP$Payments$PaymentMethodEntryStepController$_initCardValidationFields(){this._validationFields={CardholderName:b,CardNumber:b,ExpMM:b,ExpYYYY:b,SecurityCode:!this._isFieldRequired(qb)}},_initCheckValidationFields:function WP$Payments$PaymentMethodEntryStepController$_initCheckValidationFields(){this._validationFields={BankAccountTypeNumber:b,BankAccountFirstName:b,BankAccountLastName:b,RoutingNumber:b,AccountNumber:b,AccountNumberValidation:b,AccountState:!this._isFieldRequired(Qb),DriversLicense:!this._isFieldRequired("DriversLicense")}},_isFieldRequired:function WP$Payments$PaymentMethodEntryStepController$_isFieldRequired(b){return $afe.select(this._getFieldIdInput(b)).prop("required")===a},_isFormValid:function WP$Payments$PaymentMethodEntryStepController$_isFormValid(){var b=a;for(var c in this._validationFields)b=this._validationFields[c]&&b;return b},_launchEditNickname:function WP$Payments$PaymentMethodEntryStepController$_launchEditNickname(j,k,i){var d=this,h={};h.SupressTitle=a;h.TitleText=c;h.IsClosable=a;h.IsCondensed=b;var f=new $$WP.Payments.Components.EditNicknamePopup(h),e={};e.goBack=$$WP.Strings.getForTemplate("goBackButton",d.CONST_STRING_NAMESPACE);e.save=$$WP.Strings.getForTemplate("saveButton",d.CONST_STRING_NAMESPACE);e.label=$$WP.Strings.getForTemplate("nicknameEditLabel",d.CONST_STRING_NAMESPACE);e.default=$afe.select(m+i).text();e.evpid=j;e.token=k;e.pageid=i;e.errorTitle=$$WP.Strings.getForTemplate("error",d.CONST_STRING_NAMESPACE);e.errorText=$$WP.Strings.getForTemplate(T,d.CONST_STRING_NAMESPACE);f.setData(e);f.addEventListener(g,$.proxy(d._clickEditNickname,d));f.addEventListener(t,$.proxy(d._editNicknameChangeEvt,d));d._nicknameComponent=f;$$WPUtil.quickPopup(f,{Size:$$WPContain.Popup.SizeEnum.SMALL,Class:"pocdefaultpopup ",positioningFunction:$$WPContain.Positions.InsideCentered})},_loadIFrame:function WP$Payments$PaymentMethodEntryStepController$_loadIFrame(){var b=this;if(b._iFrameShown===a)return;var c=$.proxy(b._afterGetExtPmtPageUrl,b);$afe.select(Db).removeClass(j);$.ajax({data:$$WPUtil.postify(b.DataPool.PaymentPostingDataModel),dataType:C,type:D,url:makeLink(tb+b._externalPaymentControlerName+"/GetExtPmtUrl"),success:c,error:c})},_pollForPaymentResult:function WP$Payments$PaymentMethodEntryStepController$_pollForPaymentResult(){var a=this;if(a._isPolling){var b=$.proxy(a._afterPollForPaymentResult,a);$.ajax({data:{sessionId:a._paymentSessionId},dataType:C,type:D,url:makeLink(tb+a._externalPaymentControlerName+"/GetExtPmtResult"),success:b,error:b})}},_preventDefault:function WP$Payments$PaymentMethodEntryStepController$_preventDefault(a){a.preventDefault()},_resetCardEntryErrors:function WP$Payments$PaymentMethodEntryStepController$_resetCardEntryErrors(){this._clearFieldError(".CardEntryError")},_resetCardEntryForm:function WP$Payments$PaymentMethodEntryStepController$_resetCardEntryForm(){var b=this;$afe.select("#CardEntryForm").trigger("reset");if(b._addCardFormShown){$afe.select(A).prop(f,a);$afe.select(nb).safeAttr(l,c)}else if(b._addCheckFormShown){$afe.select(z).prop(f,a);$afe.select(O).safeAttr(l,c);$afe.select(B).safeAttr(l,c)}$afe.select(".validationImg").hide();b._resetCardEntryErrors();b._setEntryBrandImage(c);b._resetSavedAddressEntry();b._hideNickname();b._disableCardEntrySubmit()},_resetSavedAddressEntry:function WP$Payments$PaymentMethodEntryStepController$_resetSavedAddressEntry(){var a=this,b=a.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId;if(b){$afe.select(fb+b).removeClass(R);$afe.select(Wb).removeClass(Xb)}a.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId=c;a._hideAddressEntryFields();a._fixSidebar()},_showAddressEntryFields:function WP$Payments$PaymentMethodEntryStepController$_showAddressEntryFields(){$afe.select(Rb).height(430);$afe.select(xb).removeClass(H);$afe.select(xb).show();this._updateAddressValidationFields()},_selectAddress:function WP$Payments$PaymentMethodEntryStepController$_selectAddress(d,h){var c=this;if(!d)return;var f=c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId,g=b;if(f!==d)$afe.select(fb+f).removeClass(R);else g=a;$afe.select(fb+d).addClass(R);$afe.select(Wb).addClass(Xb);!g&&c._setAddressDataInDataPool(d);if(typeof d===q||!d||d===e){c._showAddressEntryFields();!c._validateAddress(h)&&c._disableCardEntrySubmit()}else{c._hideAddressEntryFields();c._isFormValid()&&c._enableCardEntrySubmit()}},_selectAddressClickHandler:function WP$Payments$PaymentMethodEntryStepController$_selectAddressClickHandler(b){var a=$afe.jq(b.currentTarget).safeAttr("data-address-id");this._selectAddress(a);this._fixSidebar()},_selectBankAccountOption:function WP$Payments$PaymentMethodEntryStepController$_selectBankAccountOption(d){var c=this;$afe.select(o).safeAppend($afe.select(gb).removeClass(hb));if(!c._addCardFormShown){$afe.select(o).show();$afe.select(G).hide();$afe.select(v).show()}else{$afe.select(v).show();$afe.select(G).hide();$afe.select(o).show()}c._addCardFormShown=b;c._addCheckFormShown=a;if(!d){$$WP.Payments.DataPoolHelpers.resetPaymentMethodToNewAch(c.DataPool);c._resetCardEntryForm()}c._initCheckValidationFields();$afe.select(Fb).width($afe.select(ab).width())},_selectCreditCardOption:function WP$Payments$PaymentMethodEntryStepController$_selectCreditCardOption(d){var c=this;$afe.select(Yb).safeAppend($afe.select(gb).removeClass(hb));if(!c._addCheckFormShown){$afe.select(o).hide();$afe.select(G).show();$afe.select(v).show()}else{$afe.select(v).show();$afe.select(o).hide();$afe.select(G).show()}c._addCardFormShown=a;c._addCheckFormShown=b;if(!d){$$WP.Payments.DataPoolHelpers.resetPaymentMethodToNewCreditCard(c.DataPool);c._resetCardEntryForm()}c._initCardValidationFields();c._selectDefaultAddress(d)},_selectDefaultAddress:function WP$Payments$PaymentMethodEntryStepController$_selectDefaultAddress(f){var a=this,b=a.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId;if(typeof b===q||b===c){var d=$afe.select(".CardEntryAddress:first").data("address-id");if(d)a._selectAddress(d);else a._selectAddress(e)}else a._selectAddress(b,f)},_selectPaymentMethod:function WP$Payments$PaymentMethodEntryStepController$_selectPaymentMethod(b,g){var d=this;if(!g&&(b===i||typeof b===q||b===c))return;if(!g&&d._isCurrentlySeletected(b)){$$WP.Payments.PaymentMethodEntryHelpers.enableSecurityCode(b);return}!g&&d._deselectCurrentPaymentMethod();var h=$afe.select(P+b);if(!h.prop(f)){h.prop(f,a);h.trigger(N)}(b!==e||!g)&&d._setPaymentMethodSelectionInDataPool($afe.select(P+b).data(cb));$afe.select(Lb+b).addClass(R);$$WP.Payments.PaymentMethodEntryHelpers.enableSecurityCode(b);if(b===e)if(d.DataPool.PaymentMethodModel.UseIFrame)d._loadIFrame();else{d._switchAllowedMethods(g);$$WPUtil.SmoothScrollToElement($$WPUtil.ScrollableBody(),$afe.select(u),300);d._fixSidebar()}else d._updateNextButtonState(a)},_setAddressDataInDataPool:function WP$Payments$PaymentMethodEntryStepController$_setAddressDataInDataPool(f){var b=this,a=$afe.select(fb+f);if(f===e)for(var d in b.s_addressFields){var h=b._getFieldIdInput(b.s_addressFields[d]),g=$afe.select(h);if(g.length>0)$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(b.DataPool,b.s_addressFields[d],g.val(),b._getFieldTitle(b.s_addressFields[d]));else $$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(b.DataPool,b.s_addressFields[d],c,c)}else if(a.length>0)$$WP.Payments.DataPoolHelpers.setAddressInfo(b.DataPool,a.safeAttr("data-street"),a.safeAttr("data-city"),a.safeAttr("data-state"),a.safeAttr("data-state-name"),a.safeAttr("data-zip"),a.safeAttr("data-county"),a.safeAttr("data-county-name"),a.safeAttr("data-country"),a.safeAttr("data-country-name"),a.safeAttr("data-homephone"),a.safeAttr("data-email"));else $$WP.Payments.DataPoolHelpers.clearAddressInfo(b.DataPool);b.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId=f},_setEntryBrandImage:function WP$Payments$PaymentMethodEntryStepController$_setEntryBrandImage(c){if($$WP.Payments.FormValidationHelpers.isValidCreditCardNumber(c,this.DataPool.PaymentMethodModel.NewPmtMethodModel.AllowedCardBrands)){var b=$$WP.Payments.CreditCardBrand.getCardBrandFromNumber(c),a=$afe.select(kb);a.safeAttr(Q,b.ImageFile);a.safeAttr("alt",b.Name);a.safeAttr("data-brandnumber",b.Id);a.show()}else $afe.select(kb).hide()},_setPaymentMethodSelectionInDataPool:function WP$Payments$PaymentMethodEntryStepController$_setPaymentMethodSelectionInDataPool(h){var f="data-nickname",d="data-last4digits",b=this;if(typeof h===q||h===c)$$WP.Payments.DataPoolHelpers.clearPaymentMethod(b.DataPool);else{var a=b._getPageIdFromEvpId(h);b.DataPool.PaymentPostingDataModel.SelectedPaymentMethod=h;if(a!==e){var j=$afe.select(P+a);if(j.length>0){var k=j.safeAttr("data-type"),g=$afe.select(vb+a);if(+k===+$$WP.Payments.PaymentPostingData.PaymentMethodTypeEnum.BankAccount){var l=$afe.select(Pb+a);$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoSavedBankAccount(b.DataPool,g.safeAttr(Q),g.safeAttr("alt"),$afe.select(S+a).safeAttr(d),$afe.select(m+a).safeAttr(f),l.safeAttr("data-account-type"),l.text(),$afe.select(m+a).safeAttr("data-bankname"))}else if(+k===+$$WP.Payments.PaymentPostingData.PaymentMethodTypeEnum.CreditCard){var i=$afe.select(eb+a);$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoSavedCreditCard(b.DataPool,g.safeAttr(Q),g.safeAttr("alt"),$afe.select(S+a).safeAttr(d),$afe.select(m+a).safeAttr(f),i.safeAttr("data-mm"),i.safeAttr("data-yyyy"),i.text(),$afe.select(vb+a).safeAttr("data-number"),$afe.select(m+a).safeAttr("data-cardname"))}}}else $$WP.Payments.DataPoolHelpers.setPaymentMethodInfoNewMethod(b.DataPool)}},_showAddCardForm:function WP$Payments$PaymentMethodEntryStepController$_showAddCardForm(d){var c=this;if(c._addCardFormShown)return;c._selectDefaultAddress(d);c._disableCardEntrySubmit();c._addCardFormShown=a;c._addCheckFormShown=b;$afe.select(o).hide();$afe.select(G).show();$afe.select(yb).hide();$afe.select(A).prop(f,a).change();$afe.select(Yb).safeAppend($afe.select(gb).addClass(hb));$afe.select(v).show();$afe.select(u).show();c._initCardValidationFields()},_showAddCheckForm:function WP$Payments$PaymentMethodEntryStepController$_showAddCheckForm(){var c=this;if(c._addCheckFormShown)return;c._disableCardEntrySubmit();$afe.select(G).hide();$afe.select(o).show();$afe.select(yb).hide();$afe.select(z).prop(f,a).change();$afe.select(o).safeAppend($afe.select(gb).removeClass(hb));$afe.select(v).show();$afe.select(u).show();c._addCheckFormShown=a;c._addCardFormShown=b;c._initCheckValidationFields()},_showAddForm:function WP$Payments$PaymentMethodEntryStepController$_showAddForm(){$afe.select(v).hide();this._disableCardEntrySubmit();this._addCardFormShown=b;this._addCheckFormShown=b;$afe.select(A).prop(f,b).change();$afe.select(z).prop(f,b).change();$afe.select(yb).show();$afe.select(u).show()},_showIFrame:function WP$Payments$PaymentMethodEntryStepController$_showIFrame(){$$WPUtil.HideAjaxSpinner($afe.select(Ub));$afe.select(Tb).safeAttr("style","display:none;");this._iFrameShown=a;$afe.select(U).show();$afe.select(I).show();$$WPUtil.ShowAjaxSpinner($afe.select("#AddPmtMethodIFrame .ajaxspinner"));$$WPUtil.SmoothScrollToElement($$WPUtil.ScrollableBody(),$afe.select(I),300);this._updateNextButtonState(b)},_showFieldError:function WP$Payments$PaymentMethodEntryStepController$_showFieldError(c,b){var a=$afe.select(c);a.empty();$$WP.Strings.setDisplayText(a,b,this.CONST_STRING_NAMESPACE);a.safePrepend($$WP.SimpleTemplates.ErrorLabel());a.hide().show()},_showSectionOverlay:function WP$Payments$PaymentMethodEntryStepController$_showSectionOverlay(){this._overlayShown=a;$$WPUtil.ShowAjaxSpinner($afe.select(Sb));this._disableNavigation()},_showNicknameField:function WP$Payments$PaymentMethodEntryStepController$_showNicknameField(){this._nicknameShown=a;$afe.select(Vb).removeClass(H)},_switchAllowedMethods:function WP$Payments$PaymentMethodEntryStepController$_switchAllowedMethods(d){var c=this;if(c.DataPool.PaymentMethodModel.UseIFrame)c._showIFrame();else if(c.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCardAllowed&&c.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCheckAllowed)c._showAddForm();else if(c.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCardAllowed){c._showAddCardForm(d);if(!d){c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodIsCard=a;c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodType=0}}else if(c.DataPool.PaymentMethodModel.NewPmtMethodModel.IsCheckAllowed){c._showAddCheckForm();if(!d){c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodIsCard=b;c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodType=1}}},_trimOnValidate:function WP$Payments$PaymentMethodEntryStepController$_trimOnValidate(b){var a=$afe.jq(b);a.val($.trim(a.val()))},_tokenSelected:function WP$Payments$PaymentMethodEntryStepController$_tokenSelected(){return this._selectedTokenEvpId===c||this._selectedTokenEvpId===e?b:a},_updateAddressValidationFields:function WP$Payments$PaymentMethodEntryStepController$_updateAddressValidationFields(){var b=this;for(var c in b.s_addressFields)if(b._isFieldRequired(b.s_addressFields[c]))b._validationFields[b.s_addressFields[c]]=!b._areAddressFieldsVisible();else b._validationFields[b.s_addressFields[c]]=a},_updateNextButtonState:function WP$Payments$PaymentMethodEntryStepController$_updateNextButtonState(f){var c=this;if(c._overlayShown)c._tempNextButtonStateEnabled=f;else{var e=$afe.select(w);if(c._iFrameShown)if(c.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment)$$WP.BillPay.VisitPaymentHelpers.hideNextButton(c.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,c._workflowController.parentWorkflowController);else e.hide();else if(c.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment)$$WP.BillPay.VisitPaymentHelpers.showNextButton(c.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,c._workflowController.parentWorkflowController);else e.show();if(f===a)if(c.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment)$$WP.BillPay.VisitPaymentHelpers.enableNextButton(c.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,b,c._workflowController.parentWorkflowController);else{e.removeClass(d);e.prop(d,b);e.safeAttr(h,E)}else if(!c._iFrameShown)if(c.DataPool.PaymentPostingDataModel.PaymentWorkflow===$$WP.Payments.PaymentPostingData.WorkflowEnum.VisitPayment)$$WP.BillPay.VisitPaymentHelpers.disableNextButton(c.DataPool.PaymentWorkflowModel.VisitPaymentWorkflow,c._workflowController.parentWorkflowController);else{e.addClass(d);e.prop(d,a);e.safeAttr(h,n)}}},_updateSavedPaymentMethodNicknameInDataPool:function _updateSavedPaymentMethodNicknameInDataPool(h,g,f){var c=this,e=b,d=0;while(!e)if(d>$$WP.Payments.DataPoolHelpers.getNumberOfSavedPaymentMethods(c.DataPool))e=a;else if(+c.DataPool.PaymentMethodModel.SavedPaymentMethods[d].pageId===+h){c.DataPool.PaymentMethodModel.SavedPaymentMethods[d].Nickname=g;c.DataPool.PaymentMethodModel.SavedPaymentMethods[d].AriaDescription=f;if(c.DataPool.PaymentMethodModel.SavedPaymentMethods[d].evpId===c.DataPool.PaymentPostingDataModel.SelectedPaymentMethod){c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.Nickname=g;c.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AriaDescription=f}e=a}else d++},_saveManualAddressToDataPool:function WP$Payments$PaymentMethodEntryStepController$_saveManualAddressToDataPool(){var a=this;if(a._addCardFormShown)a.DataPool.PaymentPostingDataModel.PaymentMethodInfo&&a.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId===e&&a._setAddressDataInDataPool(e)},_validateAccountNumber:function WP$Payments$PaymentMethodEntryStepController$_validateAccountNumber(){var c=this,e=$afe.select(O).val(),d=$afe.select(B).val();if($$WPUtil.IsNullOrEmpty(e))return a;if($$WPUtil.IsNullOrEmpty(d))return a;c._clearFieldError(c._getFieldIdError(K));c._clearFieldError(c._getFieldIdError(L));if(e!==d)return b;c._validationFields.AccountNumber=a;c._validationFields.AccountNumberValidation=a;return a},_validateAddress:function WP$Payments$PaymentMethodEntryStepController$_validateAddress(d){var b=this,c=a;for(var e in b.s_addressFields)c=c&&b._validateCardEntry(b.s_addressFields[e],a,d);c&&b._saveManualAddressToDataPool();return c},_validateCardEntry:function WP$Payments$PaymentMethodEntryStepController$_validateCardEntry(s,q,o){var e=this,h,d,f,n,m,g,i,k,j,l=b;e.DataPool.PaymentPostingDataModel.PaymentMethodInfo.AddressId===c&&e._showFieldError("#CardEntry-Address-Error","addressIsRequired");g=c;d=s;if(d==="Number")d=W;h=$afe.select(e._getFieldIdInput(d));if(h.length===0)return a;f=h.val();if(f===c)f=$$WP.Payments.PaymentMethodEntryHelpers.getPlaceholderString(h);n=e._isFieldRequired(d);m=e._getFieldDisplayName(d);i=e._getFieldIdError(d);e.CONST_CARDSELECTION_STRINGS.addMnemonic(ib,m,$$WP.Strings.EncodingTypes.None);if(n&&!$.trim(f))g=Zb;else if(d===W){if($$WP.Payments.PaymentMethodEntryHelpers.isLastFourFormat(f))if(!$$WP.Payments.FormValidationHelpers.isValidLastFour(f,e.DataPool))g=p;else{e._setEntryBrandImage($$WP.Payments.DataPoolHelpers.getPaymentMethodInfoFieldData(e.DataPool,"Number"));l=a}else if(!$$WP.Payments.FormValidationHelpers.isValidCreditCardNumber(f,e.DataPool.PaymentMethodModel.NewPmtMethodModel.AllowedCardBrands))g=p}else if(d===X||d==="Street"||d==="City"){if($.isNumeric(f))g=p;if(f.indexOf("^")!==-1||f.indexOf('"')!==-1)g=T}else if(d===db){if(f.indexOf("^")!==-1||f.indexOf('"')!==-1)g=T}else if(d===r||d===x){k=parseInt($afe.select(ob).val(),10);j=$afe.select(pb).val();g=$$WP.Payments.FormValidationHelpers.isValidExpirationMonth(k);if(g===c&&(d===r||j!==c))g=e._validateExpirationDate(k,j)}else if(d===qb)if(f.length>0&&f.length<3)g=p;if($$WPUtil.IsNullOrEmpty(g)){e._validationFields[d]=a;e._clearFieldError(i);!o&&!l&&$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(e.DataPool,d,f,e._getFieldTitle(d))}else{e._validationFields[d]=b;!o&&$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(e.DataPool,d,c,e._getFieldTitle(d));!q&&e._showFieldError(i,g)}e.CONST_CARDSELECTION_STRINGS.removeMnemonic(ib);return e._isFormValid()},_validateCheckEntry:function WP$Payments$PaymentMethodEntryStepController$_validateCheckEntry(d,e,f){var b=this,c=a;b._validationFields[d]=b._validateCheckField(d,e,f);for(var g in b._validationFields)c=b._validationFields[g]&&c;return c},_validateCheckField:function WP$Payments$PaymentMethodEntryStepController$_validateCheckField(d,q,r){var h="accountNumberMatch",f=this,l,e,j,n,k,g,i,o=a,m=b;g=c;k=f._getFieldIdInput(d);l=$afe.select(k);if(l.length===0)return a;e=f._getFieldValue(k);if(e===c)e=$$WP.Payments.PaymentMethodEntryHelpers.getPlaceholderString(l);if(d===J)j=a;else j=f._isFieldRequired(d);n=f._getFieldDisplayName(d);i=f._getFieldIdError(d);f.CONST_CARDSELECTION_STRINGS.addMnemonic(ib,n,$$WP.Strings.EncodingTypes.None);if(j&&!$.trim(e))g=Zb;else if(d===lb){if(!$$WP.Payments.FormValidationHelpers.isValidRoutingNumber(e))g=p}else if(d===K||d===L)if($$WP.Payments.PaymentMethodEntryHelpers.isLastFourFormat(e))if(!$$WP.Payments.FormValidationHelpers.isValidLastFour(e,f.DataPool))g=p;else if(!f._validateAccountNumber())g=h;else m=a;else{var s=e.replace(/\d/g,c);if(s!==c&&e!==c)g=p;else if(!f._validateAccountNumber())g=h}else if(d===V||d===Bb){if($.isNumeric(e))g=p;else if(e.indexOf("^")!==-1||e.indexOf('"')!==-1)g=T}else if(d===db)if(e.indexOf("^")!==-1||e.indexOf('"')!==-1)g=T;if($$WPUtil.IsNullOrEmpty(g)){f._clearFieldError(i);!r&&!m&&$$WP.Payments.DataPoolHelpers.setPaymentMethodInfoFieldData(f.DataPool,d,e,f._getFieldTitle(d));if(d===lb)$afe.select(ub).show();else(d===K||d===L)&&f._checkBankAccountNumbersMatch()}else{o=b;!q&&f._showFieldError(i,g)}f.CONST_CARDSELECTION_STRINGS.removeMnemonic(ib);return o},_validateExpirationDate:function WP$Payments$PaymentMethodEntryStepController$_validateExpirationDate(g,e){var b=c,f=new Date,d=parseInt(e,10);if(isNaN(d))b="invalidYear";else{if(e.length===2)d=2e3+d;if(e.length!==2&&e.length!==4)b="yearMustBe2or4Digits";else if(d<f.getFullYear()||d===f.getFullYear()&&g-1<f.getMonth())b="cardDateInPast"}if($$WPUtil.IsNullOrEmpty(b)){this._validationFields.ExpYYYY=a;this._validationFields.ExpMM=a}return b},_validateField:function WP$Payments$PaymentMethodEntryStepController$_validateField(e){var c=this,d=b,f=b;if(e.type===t)f=a;var g=e.target||e.srcElement;e.type!==t&&c._trimOnValidate(g);if(c._addCardFormShown&&c._validateCardEntry(c._getFieldBase(g.id),f))if(c._areAddressFieldsVisible()){if(c._validateAddress(b))d=a}else d=a;else if(c._addCheckFormShown&&c._validateCheckEntry(c._getFieldBase(g.id),f))d=a;if(d)c._enableCardEntrySubmit();else c._disableCardEntrySubmit();c._fixSidebar()},_verifyDelete:function WP$Payments$PaymentMethodEntryStepController$_verifyDelete(g,i,f){var d="@MYCHART@LAST4@",a=this,e=c,h=$afe.select(S+f).data(wb);$$WP.Strings.addMnemonic(d,h,b,a.CONST_STRING_NAMESPACE);if($afe.select(eb+f).length)e=$$WP.Strings.getForTemplate("deletePaymentMethodConfirmCard",a.CONST_STRING_NAMESPACE);else e=$$WP.Strings.getForTemplate("deletePaymentMethodConfirmECheck",a.CONST_STRING_NAMESPACE);$$WP.Strings.removeMnemonic(d);$$WPUtil.quickMessageBoxByEnum(e,$$WPUtil.quickMessageBoxByEnum.typeEnum.DeleteGoback,$.proxy(a._clickConfirmDeletePopup,a),[g,i,f])}};zb.prototype=bc;$$WP.Payments=$$WP.Payments||{};$$WP.Payments.PaymentMethodEntryStepController=zb;zb.extend($$WP.UI.SubwayStopController,"WP$Payments$PaymentMethodEntryStepController")})();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function UnitTests$PaymentMethodEntryStepController(){var a;a=$$WP.Debug.UnitTest.assert})