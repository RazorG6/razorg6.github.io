$$WP=$$WP||{};$$WP.Payments=$$WP.Payments||{};$$WP.Payments.DataPoolHelpers={afterLoadPaymentMethodModel:function WP$Payments$DataPoolHelpers$afterLoadPaymentMethodModel(a,c,b){if(b.Success){a.PaymentMethodModel=b.Data;a.PaymentMethodModel.LoadingStatus=$$WP.Payments.PaymentMethod.LoadingStatusEnum.Loaded;a.PaymentMethodModel.SavedPaymentMethods&&a.PaymentMethodModel.SavedPaymentMethods.forEach(function(a){a.imageSrc=makeStaticLink(a.imageSrc);a.EditButtonPath=makeStaticLink(a.EditButtonPath);a.DeleteButtonPath=makeStaticLink(a.DeleteButtonPath)})}typeof c==="function"&&c(b.Success)},clearAddressInfo:function WP$Payments$DataPoolHelpers$clearAddressInfo(a){a.PaymentPostingDataModel.PaymentMethodInfo.HaveAddressInfo=false;a.PaymentPostingDataModel.PaymentMethodInfo.Address={}},clearPaymentMethod:function WP$Payments$DataPoolHelpers$clearPaymentMethod(a){a.PaymentPostingDataModel.SelectedPaymentMethod="";a.PaymentPostingDataModel.PaymentMethodInfo={}},getDataToDeletePaymentMethod:function WP$Payments$DataPoolHelpers$getDataToDeletePaymentMethod(a,c,d,b){return{pmtWorkflow:a.PaymentPostingDataModel.PaymentWorkflow,encEvpId:c,encToken:d,context:a.PaymentPostingDataModel.MerchantContext,serviceAreaId:a.PaymentPostingDataModel.MerchantServiceAreaId,departmentId:a.PaymentPostingDataModel.MerchantDepartmentId,guarantorAccountId:a.PaymentPostingDataModel.PrimaryGuarantorAccountId,pageId:b}},getDataToLoadPaymentMethodModel:function WP$Payments$DataPoolHelpers$getDataToLoadPaymentMethodModel(a){return{pmtWorkflow:a.PaymentPostingDataModel.PaymentWorkflow,context:a.PaymentPostingDataModel.MerchantContext,serviceAreaId:a.PaymentPostingDataModel.MerchantServiceAreaId,departmentId:a.PaymentPostingDataModel.MerchantDepartmentId,guarantorAccountId:a.PaymentPostingDataModel.PrimaryGuarantorAccountId,forceLoadEvpId:a.PaymentPostingDataModel.SelectedPaymentMethod}},getDetailPaymentAmount:function WP$Payments$DataPoolHelpers$getDetailPaymentAmount(a){return $$WP.Currency.Helpers.currencyToNumber(a.PaymentAmount)},getLastFourDisplayString:function WP$Payments$PaymentMethodEntryStepController$getLastFourDisplayString(b){var a=$$WP.Payments.DataPoolHelpers.getPaymentMethodInfoFieldData(b,"LastFour");return a.length>0?"x"+a:""},getNumberOfSavedPaymentMethods:function WP$Payments$PaymentMethodEntryStepController$getNumberOfSavedPaymentMethods(a){return a.PaymentMethodModel.SavedPaymentMethods.length},hasAnySavedPaymentMethods:function WP$Payments$PaymentMethodEntryStepController$hasAnySavedPaymentMethods(a){return!a.PaymentMethodModel.SavedPaymentMethods?false:this.getNumberOfSavedPaymentMethods(a)===0?false:true},getPaymentMethodInfoFromStoredPaymentMethod:function WP$Payments$PaymentMethodEntryStepController$getPaymentMethodInfoFromStoredPaymentMethod(a){var d="PaymentMethodIsCard",b="",c=this;a.PaymentPostingDataModel={};a.PaymentPostingDataModel.PaymentMethodInfo={};c.setPaymentMethodInfoFieldData(a,"LastFour",a.LastFourDigits,b);c.setPaymentMethodInfoFieldData(a,"Nickname",a.Nickname,b);c.setPaymentMethodInfoFieldData(a,"ExpiredToken",a.ExpiredToken,b);c.setPaymentMethodInfoFieldData(a,"ExpiringSoonToken",a.ExpiringSoonToken,b);if(a.PaymentMethodType=="0"||a.PaymentMethodType=="CreditCard"){c.setPaymentMethodInfoFieldData(a,d,true,b);c.setPaymentMethodInfoFieldData(a,"CardholderName",a.CardholderName,b);c.setPaymentMethodInfoFieldData(a,"Brand",Number(a.BrandNumber),b);c.setPaymentMethodInfoFieldData(a,"ExpMM",a.ExpMM,b);c.setPaymentMethodInfoFieldData(a,"ExpYYYY",a.ExpYYYY,b);c.setPaymentMethodInfoFieldData(a,"Expired",a.Expired,b);c.setPaymentMethodInfoFieldData(a,"ExpiringSoon",a.ExpiringSoon,b)}else{c.setPaymentMethodInfoFieldData(a,d,false,b);c.setPaymentMethodInfoFieldData(a,"BankAccountTypeNumber",a.BankAccountTypeNumberInt.toString(),b);c.setPaymentMethodInfoFieldData(a,"BankAccountFirstName",a.BankAccountName,b);c.setPaymentMethodInfoFieldData(a,"BankAccountLastName"," ",b)}},getPaymentMethodInfoFieldData:function WP$Payments$DataPoolHelpers$getPaymentMethodFieldData(b,c){var a="";switch(c){case"HouseNumber":case"Street":case"City":case"Zip":a=b.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo[c];break;case"District":a=b.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.District.Number;break;case"County":a=b.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.County.Number;break;case"Country":a=b.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.Country.Number;break;case"State":a=b.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.State.Number;break;case"Email":case"HomePhone":a=b.PaymentPostingDataModel.PaymentMethodInfo.Address[c];break;case"AccountState":a=b.PaymentPostingDataModel.PaymentMethodInfo.AccountState?b.PaymentPostingDataModel.PaymentMethodInfo.AccountState.Number:"";break;default:a=b.PaymentPostingDataModel.PaymentMethodInfo[c]}if(typeof a==="undefined")a="";return a},getTotalPaymentAmount:function WP$Payments$DataPoolHelpers$getTotalPaymentAmount(a){return $$WP.Currency.Helpers.currencyToNumber(a.PaymentPostingDataModel.TotalPaymentAmount)},loadPaymentMethodModel:function WP$DataPoolHelpers$loadPaymentMethodModel(a,b,c){var e="function";if(a.PaymentMethodModel&&a.PaymentMethodModel.LoadingStatus===$$WP.Payments.PaymentMethod.LoadingStatusEnum.Loading){if(typeof c==="undefined")c=0;if(c<=9)setTimeout($.proxy($$WP.Payments.DataPoolHelpers.loadPaymentMethodModel,this,a,b,++c),1e3);else typeof b===e&&b()}else if(a.PaymentMethodModel&&a.PaymentMethodModel.LoadingStatus===$$WP.Payments.PaymentMethod.LoadingStatusEnum.Loaded)typeof b===e&&b(true);else{var d=$.proxy($$WP.Payments.DataPoolHelpers.afterLoadPaymentMethodModel,this,a,b);$.ajax({data:$$WP.Payments.DataPoolHelpers.getDataToLoadPaymentMethodModel(a),dataType:"json",type:"POST",url:makeLink("Payments/PaymentMethod/LoadPaymentMethodEntryData"),success:d,error:d})}},removePaymentMethod:function WP$Payments$DataPoolHelpers$removePaymentMethod(b,d){var c=false,a=0;while(!c)if(a>b.PaymentMethodModel.SavedPaymentMethods.length)c=true;else if(+b.PaymentMethodModel.SavedPaymentMethods[a].pageId===+d){b.PaymentMethodModel.SavedPaymentMethods.splice(a,1);c=true}else a++},resetPaymentMethodToNewAch:function WP$Payments$DataPoolHelpers$resetPaymentMethodToNewAch(a){a.PaymentPostingDataModel.PaymentMethodInfo={};a.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodIsCard=false;a.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodType=1},resetPaymentMethodToNewCreditCard:function WP$Payments$DataPoolHelpers$resetPaymentMethodToNewCreditCard(a){a.PaymentPostingDataModel.PaymentMethodInfo={};a.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodIsCard=true;a.PaymentPostingDataModel.PaymentMethodInfo.PaymentMethodType=0},setAddressInfo:function WP$Payments$DataPoolHelpers$setAddressInfo(b,k,c,i,a,d,g,h,e,f,j,l){b.PaymentPostingDataModel.PaymentMethodInfo.HaveAddressInfo=true;b.PaymentPostingDataModel.PaymentMethodInfo.Address={AddressInfo:{Street:k,City:c,State:{Number:i,Title:a},Zip:d,CityStateZipString:$$WP.Payments.DataPoolHelpers._getCSZ(c,a,d),County:{Number:g,Title:h},Country:{Number:e,Title:f}},HomePhone:j,Email:l}},setPaymentMethodInfoFieldData:function WP$Payments$DataPoolHelpers$setPaymentMethodFieldData(a,c,b,h){var g=true,m="District",l="@MYCHART@YYYY@",k="@MYCHART@MM@",j="undefined",d=$$WP.Strings.getNamespace("Payments.Shared.CardSelection");switch(c){case"AccountNumber":case"AccountNumberValidation":a.PaymentPostingDataModel.PaymentMethodInfo.AccountNumber=b;a.PaymentPostingDataModel.PaymentMethodInfo.LastFour=this._getLastFour(b);break;case"BankAccountTypeNumber":a.PaymentPostingDataModel.PaymentMethodInfo.BankAccountTypeNumber=b;if(+b===1)a.PaymentPostingDataModel.PaymentMethodInfo.BankAccountTypeTitle=d.getString("newCheckChecking");else a.PaymentPostingDataModel.PaymentMethodInfo.BankAccountTypeTitle=d.getString("newCheckSavings");a.PaymentPostingDataModel.PaymentMethodInfo.ImageSource=makeStaticLink("images/payment_check.png");a.PaymentPostingDataModel.PaymentMethodInfo.ImageAlt=d.getString("checkAltText");break;case"BankAccountFirstName":case"BankAccountLastName":a.PaymentPostingDataModel.PaymentMethodInfo[c]=b;a.PaymentPostingDataModel.PaymentMethodInfo.BankAccountFullName=a.PaymentPostingDataModel.PaymentMethodInfo.BankAccountFirstName+" "+a.PaymentPostingDataModel.PaymentMethodInfo.BankAccountLastName;break;case"Brand":a.PaymentPostingDataModel.PaymentMethodInfo.Brand={Number:b};var n=$$WP.Payments.CreditCardBrand.getCardBrandFromId(b);a.PaymentPostingDataModel.PaymentMethodInfo.ImageSource=n.ImageFile;a.PaymentPostingDataModel.PaymentMethodInfo.ImageAlt=n.Name;break;case"CardNumber":if(b){var i=$$WP.Payments.CreditCardBrand.getCardBrandFromNumber(b);a.PaymentPostingDataModel.PaymentMethodInfo.Number=b;a.PaymentPostingDataModel.PaymentMethodInfo.LastFour=this._getLastFour(b);a.PaymentPostingDataModel.PaymentMethodInfo.ImageSource=i.ImageFile;a.PaymentPostingDataModel.PaymentMethodInfo.ImageAlt=i.Name;a.PaymentPostingDataModel.PaymentMethodInfo.Brand={Number:i.Id}}else{a.PaymentPostingDataModel.PaymentMethodInfo.Number="";a.PaymentPostingDataModel.PaymentMethodInfo.LastFour="";a.PaymentPostingDataModel.PaymentMethodInfo.ImageSource="";a.PaymentPostingDataModel.PaymentMethodInfo.ImageAlt="";a.PaymentPostingDataModel.PaymentMethodInfo.Brand={}}break;case"ExpMM":case"ExpYYYY":a.PaymentPostingDataModel.PaymentMethodInfo[c]=b;var f=a.PaymentPostingDataModel.PaymentMethodInfo.ExpMM;if(typeof f!==j&&f!==""&&f.length===1){f="0"+f;a.PaymentPostingDataModel.PaymentMethodInfo.ExpMM=f}var e=a.PaymentPostingDataModel.PaymentMethodInfo.ExpYYYY;if(typeof e!==j&&e!==""&&e.length===2){e="20"+e;a.PaymentPostingDataModel.PaymentMethodInfo.ExpYYYY=e}d.addMnemonic(k,f);d.addMnemonic(l,e);a.PaymentPostingDataModel.PaymentMethodInfo.ExpDisplayString=d.getString("expirationDate");d.removeMnemonic(k);d.removeMnemonic(l);break;case"HouseNumber":case"Street":case m:case"County":case"Country":a.PaymentPostingDataModel.PaymentMethodInfo.Address=a.PaymentPostingDataModel.PaymentMethodInfo.Address||{};a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo||{};a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.County=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.County||{};a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.Country=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.Country||{};a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.District=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.District||{};if(c==="County"){a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.County.Number=b;a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.County.Title=h}else if(c==="Country"){a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.Country.Number=b;a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.Country.Title=h}else if(c===m){a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.District.Number=b;a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.District.Title=h}else a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo[c]=b;if(b.length!==0)a.PaymentPostingDataModel.PaymentMethodInfo.HaveAddressInfo=g;break;case"City":case"State":case"Zip":a.PaymentPostingDataModel.PaymentMethodInfo.Address=a.PaymentPostingDataModel.PaymentMethodInfo.Address||{};a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo||{};a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.State=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.State||{};if(c==="State"){a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.State.Number=b;a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.State.Title=h}else a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo[c]=b;var p=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.City,o=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.State.Title,q=a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.Zip;a.PaymentPostingDataModel.PaymentMethodInfo.Address.AddressInfo.CityStateZipString=$$WP.Payments.DataPoolHelpers._getCSZ(p,o,q);if(b.length!==0)a.PaymentPostingDataModel.PaymentMethodInfo.HaveAddressInfo=g;break;case"HomePhone":case"Email":a.PaymentPostingDataModel.PaymentMethodInfo.Address=a.PaymentPostingDataModel.PaymentMethodInfo.Address||{};a.PaymentPostingDataModel.PaymentMethodInfo.Address[c]=b;if(b.length!==0)a.PaymentPostingDataModel.PaymentMethodInfo.HaveAddressInfo=g;break;case"DriversLicense":a.PaymentPostingDataModel.PaymentMethodInfo.DriversLicense=b;a.PaymentPostingDataModel.PaymentMethodInfo.HaveAccountInfo=g;break;case"AccountState":a.PaymentPostingDataModel.PaymentMethodInfo.AccountState=a.PaymentPostingDataModel.PaymentMethodInfo.AccountState||{};a.PaymentPostingDataModel.PaymentMethodInfo.AccountState.Number=b;a.PaymentPostingDataModel.PaymentMethodInfo.AccountState.Title=h;a.PaymentPostingDataModel.PaymentMethodInfo.HaveAccountInfo=g;break;default:a.PaymentPostingDataModel.PaymentMethodInfo[c]=b}},setPaymentMethodInfoNewMethod:function WP$Payments$DataPoolHelpers$setPaymentMethodInfoNewMethod(a){a.PaymentPostingDataModel.UsingStoredPaymentMethod=false;a.PaymentPostingDataModel.PaymentMethodInfo={}},setPaymentMethodInfoSavedBankAccount:function WP$Payments$DataPoolHelpers$setPaymentMethodInfoSavedBankAccount(a,e,f,g,h,b,c,d){a.PaymentPostingDataModel.UsingStoredPaymentMethod=true;a.PaymentPostingDataModel.PaymentMethodInfo={ImageSource:e,ImageAlt:f,PaymentMethodType:$$WP.Payments.PaymentPostingData.PaymentMethodTypeEnum.BankAccount,LastFour:g,Nickname:h,BankAccountTypeNumber:b,BankAccountTypeTitle:c,BankAccountFullName:d,PaymentMethodIsCard:false}},setPaymentMethodInfoSavedCreditCard:function WP$Payments$DataPoolHelpers$setPaymentMethodInfoSavedCreditCard(a,d,f,g,h,j,i,e,c,b){a.PaymentPostingDataModel.UsingStoredPaymentMethod=true;a.PaymentPostingDataModel.PaymentMethodInfo={ImageSource:d,ImageAlt:f,PaymentMethodType:$$WP.Payments.PaymentPostingData.PaymentMethodTypeEnum.CreditCard,LastFour:g,Nickname:h,ExpMM:j,ExpYYYY:i,ExpDisplayString:e,Brand:{Number:c},CardholderName:b,PaymentMethodIsCard:true}},setPaymenResultInfoData:function WP$Payments$DataPoolHelpers$setPaymentResultInfoData(a,b,c){a.PaymentResultInfoModel=a.PaymentResultInfoModel||{};a.PaymentResultInfoModel[b]=c},setDetailPaymentAmount:function WP$Payments$DataPoolHelpers$setDetailPaymentAmount(b,a){if(isNaN(a))return;b.PaymentAmount=$$WP.Currency.Helpers.numberToCurrency(a,true,true)},setTotalPaymentAmount:function WP$Payments$DataPoolHelpers$setTotalPaymentAmount(b,a){if(isNaN(a))return;b.PaymentPostingDataModel.TotalPaymentAmount=$$WP.Currency.Helpers.numberToCurrency(a,true,true)},_getCSZ:function WP$Payments$PaymentMethodEntryStepController$_getCSZ(c,b,d){var a="";if(c&&b)a=c+", "+b;else if(c)a=c;else if(b)a=b;if(d)a+=(a?" ":"")+d;return a},_getLastFour:function WP$Payments$PaymentMethodEntryStepController$_getLastFour(a){a=a+"";return a.length>4?a.substr(a.length-4):a}}