/*! Copyright (c) Epic Systems Corporation 2016-2019 */
var stepEnum={patientStep:0,proxyStep:1};Epic.PatientAccess.Controllers.SignupController=function Epic$PatientAccess$Controllers$SignupController(o){var m="#Signup_signupoptions",l="AnonymousTelehealth",e="Signup.Signup",b=this;b.Controllers$Controller();var a,n,c,d,i,k,j,h,f,g;a=b;b._useCompact=!$$WP.CurrentLocale||$$WP.CurrentLocale.Language==="EN";b._currentSignupOption="";c=$$WP.Strings.get("SignupOption",e);d=$$WP.Strings.get(l,e)==="1";i=$$WP.Strings.get("GuestProxySignupUseLoggedInUser",e)==="1";j=$$WP.Strings.get("IsAnonymousTelehealthJumpURLSet",e)==="1";if(!j&&d){$afe.select(".title h1").text("");$afe.select(m).addClass("hidden");window.location.href=makeLink(l);return}k=d&&!i;b._signupDemogComponent=new $$WPComp.SignupDemographicsForm({parent:a,submitFunc:a.ValidateDemographicsAndProceed,multipleSteps:k,isGuest:d,addressConfig:o});if(d)c="2";if(c===null)return;if(c!==""){a._startStep=c;a.ChangeSignupOption(a,c,b._signupDemogComponent._automaticallySubmitForm)}else{n=$afe.select(m).find(".card");n.click(a,function chooseOption(){location.hash=1;a.ChangeSignupOption(a,$afe.jq(this).find("a").safeAttr("data-value"));return false})}window.onhashchange=function handleBack(){if(location.hash!=="#1")window.location.href=makeLink("Signup")};if(b._signupDemogComponent._automaticallySubmitForm){h=b._signupDemogComponent._submitButton;g=20;if(typeof ep!="undefined"&&ep!=null){f=function(){if(g===0||$afe.select("#user_prefs2").val()!=="")h.trigger("click");else{g--;setTimeout(f,500)}};f()}else h.trigger("click")}b._setPreloginTimeout()};Epic.PatientAccess.Controllers.SignupController.prototype={_currentSignupOption:null,_signupDemogComponent:null,_thirdPartyVerificationComponent:null,_startStep:null,_currentStep:null,_verificationToken:null,_isGuestWorkflow:false,_guestProxySignupUseLoggedInUser:false,_schedulingSession:null,_useCompact:false,_subwayStopControllers:[],_subwayStops:[],_timer:null,ChangeSignupOption:function Epic$PatientAccess$Controllers$SignupController$ChangeSignupOption(a,f,k){var e="#SignupDemog_buttonnext",d="#SignupDemog_buttonsubmit",j="new-password",i="autocomplete",c="Signup.Signup",b,h,g;a._currentSignupOption=f;a._signupDemogComponent.currentSignupOption=f;a._isGuestWorkflow=$$WP.Strings.get("AnonymousTelehealth",c)==="1";a._guestProxySignupUseLoggedInUser=$$WP.Strings.get("GuestProxySignupUseLoggedInUser",c)==="1";a._schedulingSession=$$WP.Strings.get("SchedulingSession",c);a._isGuestWorkflow&&!a._guestProxySignupUseLoggedInUser&&a.BuildSubway(a);b=$afe.select("#Signup_demographics");a._startStep!==""&&$afe.select("#Signup_signupoptions").addClass("hidden");a.HideAllPreAndPostTexts(a,b);if(!k){a.Show(b);a.UpdateTitle($$WP.Strings.get("DemographicsTitle",c));this._currentStep=stepEnum.patientStep}if(a._isGuestWorkflow){$afe.select("form").safeAttr(i,j);$afe.select("input").safeAttr(i,j);a.UpdateTitle($$WP.Strings.get("GuestPatientDemographicsTitle",c));a.ChangePatientStepVisibility(a,true);a.ChangeProxyStepVisibility(a,false);if(a._guestProxySignupUseLoggedInUser){a.Show(b.find(d));a.Hide(b.find(e))}else{a.Hide(b.find(d));a.Show(b.find(e))}a.Show($afe.select("#SignupDemog_buttoncancel"))}else if(f==="1"){a.Show($afe.select("#pretextdemog"));a.Show($afe.select("#posttextdemog"));a.Show($afe.select(d));a.Hide($afe.select(e))}else if(f==="2"){a.Show($afe.select("#pretextthirdparty"));a.Show($afe.select("#posttextthirdparty"));a.Hide($afe.select(d));a.Show($afe.select(e))}if(a._currentSignupOption==="2"&&a._thirdPartyVerificationComponent===null){h=b.find("#token").val();if(h&&h.length)g=true;else g=false;a._thirdPartyVerificationComponent=new $$WP.Components.ThirdPartyVerification({$container:$afe.select("#Signup_thirdpartyquestion"),showExplanation:g});typeof ep!="undefined"&&ep!=null&&ep.fnep(null)}$$WP.FormValidation.initializeDOMSubtree(b);$afe.jq(window).trigger("matchColumnHeights")},ValidateDemographicsAndProceed:function Epic$PatientAccess$Controllers$SignupController$ValidateDemographicsAndProceed(a){if(a._isGuestWorkflow&&!a._guestProxySignupUseLoggedInUser&&a._currentStep==stepEnum.patientStep)a.SwitchToStep(a,stepEnum.proxyStep);else if(a._isGuestWorkflow)a._signupDemogComponent.ValidateProxyAndPatientDemographicsAndProceed(a._signupDemogComponent,a,a.ShowSubmissionResult,a._currentSignupOption,a._schedulingSession);else if(a._currentSignupOption==="2"&&a._signupDemogComponent!==null&&a._thirdPartyVerificationComponent!==null){typeof ep!="undefined"&&ep!=null&&ep.cnep("plep");a._signupDemogComponent.ValidateDemographicsAndProceed(a._signupDemogComponent,a,a.DoThirdPartyValidation,a._currentSignupOption)}},DoThirdPartyValidation:function Epic$PatientAccess$Controllers$SignupController$DoThirdPartyValidation(a,b){if(a._thirdPartyVerificationComponent!==null){a.Show($afe.select("#Signup_thirdparty"));a.Hide($afe.select("#Signup_demographics"));a.UpdateTitle($$WP.Strings.get("ThirdPartyVerificationTitle","Signup.Signup"));if(typeof ep!="undefined"&&ep!=null){a._thirdPartyVerificationComponent._jsc=$afe.select("#plep").val();a._thirdPartyVerificationComponent._hdim=$afe.select("#user_prefs2").val()}a._thirdPartyVerificationComponent.DoInquiry(a._thirdPartyVerificationComponent,b,a,a.ContinueSubmission,a.HandleThirdPartyError,a.HandleQuestions)}},ContinueSubmission:function Epic$PatientAccess$Controllers$SignupController$ContinueSubmission(a){a._signupDemogComponent!==null&&a._signupDemogComponent.ContinueSubmission(a._signupDemogComponent,a,a.ShowSubmissionResult,a.HandleThirdPartyError)},ShowSubmissionResult:function Epic$PatientAccess$Components$DemographicComponent$ShowSubmissionResult(b,d,c){var a;a=$afe.select("#Signup_thirdparty");!a.hasClass("hidden")&&b.Hide(a.find(".waitimage"));b._signupDemogComponent.ShowMessageInLightBox(d,c)},HandleThirdPartyError:function Epic$PatientAccess$Components$DemographicComponent$HandleThirdPartyError(b,c){var a;b.Hide($afe.select("#Signup_thirdparty").find(".waitimage"));a=$afe.select("#FailureMessage_"+c+"Error").html();b._signupDemogComponent.ShowMessageInLightBox(a,"error")},HandleQuestions:function Epic$PatientAccess$Components$DemographicComponent$HandleQuestions(a){a.Hide($afe.select("#Signup_thirdparty"));a.Show($afe.select("#Signup_thirdpartyquestion"));a.UpdateTitle($$WP.Strings.get("ThirdPartyQuestionTitle","Signup.Signup"));a._thirdPartyVerificationComponent&&a.Show(a._thirdPartyVerificationComponent.$container);$$WPUtil.setScrollTop(0)},Hide:function Epic$PatientAccess$Controllers$SignupController$Hide(a){a.addClass("hidden")},Show:function Epic$PatientAccess$Controllers$SignupController$Show(a){a.removeClass("hidden")},UpdateTitle:function Epic$PatientAccess$Controllers$SignupController$UpdateTitle(a){$afe.select(".title h1").text(a)},ChangePatientStepVisibility:function Epic$PatientAccess$Controllers$SignupController$ChangePatientStepVisibility(a,h){var b=$afe.select("#Signup_demographics"),e=b.find("#pretextguestpatient"),d=b.find("#posttextguestpatient"),c=b.find("#SignupDemog_buttonnext"),g=b.find("#SignupDemographic_Form"),f=b.find("#SignupDemog_buttoncancel");if(h){a.Show(b);a.HideAllPreAndPostTexts(a,b);a.Show(e);a.Show(d);a._signupDemogComponent.$demoContainer=b;a._signupDemogComponent.$form=g;$$WP.FormValidation.initializeDOMSubtree(b);a.UpdateTitle($$WP.Strings.get("GuestPatientDemographicsTitle","Signup.Signup"));if(!a._guestProxySignupUseLoggedInUser){a.Data.Models[0].setProperty("Status",$$WP.UI.SubwayStop.StatusEnum.Current);a.Show(c);a.Show(f)}}else{a.Hide(b);a.Hide(e);a.Hide(d);a.Hide(c)}},ChangeProxyStepVisibility:function Epic$PatientAccess$Controllers$SignupController$ChangeProxyStepVisibility(a,h){var b=$afe.select("#Signup_proxydemographics"),e=b.find("#pretextguestproxy"),d=b.find("#posttextguestproxy"),c=b.find("#SignupDemog_buttonsubmit"),g=b.find("#SignupProxyDemographic_Form"),f=b.find("#SignupDemog_buttoncancel");if(h){a.Show(b);a.HideAllPreAndPostTexts(a,b);a.Show(e);a.Show(d);a.Show(c);a.Show(f);a._signupDemogComponent.$demoContainer=b;a._signupDemogComponent.$form=g;$$WP.FormValidation.initializeDOMSubtree(b);a.UpdateTitle($$WP.Strings.get("GuestProxyDemographicsTitle","Signup.Signup"));a.Data.Models[1].setProperty("Status",$$WP.UI.SubwayStop.StatusEnum.Current)}else{a.Hide(b);a.Hide(e);a.Hide(d);!a._guestProxySignupUseLoggedInUser&&a.Hide(c)}},HideAllPreAndPostTexts:function Epic$PatientAccess$Controllers$SignupController$HideAllPreAndPostTexts(b,a){b.Hide(a.find(".pretextcontainer"));b.Hide(a.find(".posttextcontainer"))},BuildSubway:function Epic$PatientAccess$Controllers$SignupController$BuildSubway(a){var b=false,d="demographicsform",c=[],f=0,e=$afe.select("#Signup_subway");c.push({Index:f++,Name:$$WP.Strings.get("PatientSubwayStop",d),Icon:"images/signup/User.png",Status:$$WP.UI.SubwayStop.StatusEnum.Current,Compact:a._useCompact});c.push({Index:f++,Name:$$WP.Strings.get("ProxySubwayStop",d),Icon:"images/signup/Guest.png",Status:$$WP.UI.SubwayStop.StatusEnum.Unstarted,Compact:a._useCompact});controlleroptions={formNavAlignment:1,useCompact:a._useCompact,AllowBackNavWhenInvalid:true,verifyCheckboxWithValidation:b,CanFinishLater:b,CanCancel:b};a.WP$UI$SubwayWorkflowController(e,c,controlleroptions);Handlebars.registerPartial("SubwayStop",$$WP.Templates.UI.SubwayStop);Handlebars.registerPartial("SubwayLine",$$WP.Templates.UI.SubwayLine);a.$root.empty().safeAppend($afe.renderTemplate($$WP.Templates.UI.Subway,{SubwayStops:a.Data.Models,DrawNavButtons:b,ViewBinderId:a._viewBinder.ViewBinderId}));a._setSubwayLineAnimation();a._viewBinder.setBindingRoot(a.$subway);a._viewBinder.bindAllModels(a.Data.Models);$$WP.Utilities.UI.MatchColumnHeights();a.Show(e);this.$subway.on("stepClicked",$.proxy(function(b,a){this.SwitchToStep(this,a)},this))},SwitchToStep:function Epic$PatientAccess$Components$DemographicComponent$SwitchToStep(a,b){if(b==stepEnum.patientStep){a.ChangeProxyStepVisibility(a,false);a.ChangePatientStepVisibility(a,true)}else{a.ChangePatientStepVisibility(a,false);a.ChangeProxyStepVisibility(a,true)}a._currentStep=b},_hasNoData:function Epic$PatientAccess$Components$DemographicComponent$_hasNoData(){return false},_isScrollable:function Epic$PatientAccess$Components$DemographicComponent$_isScrollable(){return false},_setPreloginTimeout:function Epic$PatientAccess$Controllers$SignupController$_setPreloginTimeout(){var a=this;a._resetTimer();document.body.addEventListener("click",$.proxy(a._resetTimer,a),true);document.body.addEventListener("keydown",$.proxy(a._resetTimer,a),true);document.body.addEventListener("scroll",$.proxy(a._resetTimer,a),true)},_resetTimer:function Epic$PatientAccess$Controllers$SignupController$_resetTimer(){var a=this;clearTimeout(a._timer);a._timer=setTimeout($.proxy(a._popupWarning,a),6e5)},_popupWarning:function Epic$PatientAccess$Controllers$SignupController$_popupWarning(){$$WPUtil.quickPopup(new $$WPComp.TimeoutWarningComponent({SecondsLeft:30,isPreLogin:true}),{DontMatchColumnHeights:true})}};$$WP.Controllers.SignupController.extend("Controllers.Controller");Epic.PatientAccess.Controllers.SignupController.extend($$WP.UI.SubwayWorkflowController,"Epic$PatientAccess$Controllers$SignupController")