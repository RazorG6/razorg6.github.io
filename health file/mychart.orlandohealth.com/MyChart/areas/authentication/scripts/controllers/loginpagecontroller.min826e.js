(function WP$Authentication$LoginController$definition(){var m="#loginErrorMessage .alert.card",c=false,b=null,e="#errorMessage",d=true,l="#noCookies",k=".signup",j=".login",i="withSidebar",h="#main",g="#footer",a="hidden",f="#sidebar";$$WP.Utilities.guaranteeExistence($$WP,"Authentication.Login.Controllers");var n=$$WP.Strings.getNamespace("authentication.login"),o=function LoginController(o){var m="_checkLogin",c="_registerHandlers",b=this;if(!$$WPUtil.IsNullOrEmpty(o))b._autoFocusInDataTile=o;b.proxify(c,m,"_cancelLogin","_storageAccessRequestFailed","_storageAccessRequestSucceeded","_launchLoginPopup");b._registerHandlers();if(WP.DOM.Browser.isIE&&self!==top){$afe.select(f).addClass(a);$afe.select(g).addClass(a);$afe.select(h).removeClass(i);$afe.select(j).addClass(a);$afe.select(k).addClass(a);$afe.select(l).show();return}if(!$$WPUtil.canWriteCookies()&&self===top){$afe.select(f).addClass(a);$afe.select(g).addClass(a);$afe.select(h).removeClass(i);$afe.select(j).addClass(a);$afe.select(k).addClass(a);$afe.select("#noCookiesError").show();return}var n=document.getElementById("loginForm");if(n){n.Login.value===""&&n.Password.value===""&&(b._autoFocusInDataTile===d||window.top===window)&&n.Login.focus();!$afe.select(".alert").hasClass(a)&&setTimeout(function(){$afe.select(e).safeAttr("role","alert");WP.DOM.Browser.isIE&&$afe.select(e).focus()},500)}b.proxify(c,m)};o.prototype={_autoFocusInDataTile:d,$SubmitButton:b,$BackButton:b,_registerHandlers:function(){var a=this,b=$afe.select("body");b.on("successfulStorageRequest",a._storageAccessRequestSucceeded);b.on("failedStorageRequest",a._storageAccessRequestFailed);a.$noCookiesButton=$afe.select("#noCookiesButton");a.$noCookiesButton.click(a._launchLoginPopup);a.$SubmitButton=$afe.select("#submit");a.$SubmitButton.click(a._checkLogin);a.$BackButton=$afe.select("#back");a.$BackButton&&a.$BackButton.click(a._cancelLogin);a.$SubmitButton.safeAttr("disabled",c)},_storageAccessRequestSucceeded:function(){WP.DOM.Browser.isSafari&&document.referrer!==window.location.href&&window.location.reload(d)},_storageAccessRequestFailed:function(){$afe.select(f).addClass(a);$afe.select(g).addClass(a);$afe.select(h).removeClass(i);$afe.select(j).remove();$afe.select(k).addClass(a);typeof document.requestStorageAccess==="function"&&$afe.select(l).is(":hidden")&&$afe.select("#noCookiesButtonContainer").safePrepend(n.getString("CookieAccessRequestFailed"));$afe.select(l).show()},_launchLoginPopup:function(){var a=document.location.protocol+"//"+document.location.hostname+makeLink("Authentication/Login");openWindow(a,"_blank","width=800,height=600,resizable,status,scrollbars",c)},_checkLogin:function(k){var h=this;h._clearErrorMessage();var e,a,g,i,f;f=$afe.select("#loginForm")[0];if(f){e=$afe.select("#Login")[0];a=$afe.select("#Password")[0];g=e.value;if(g)g=g.trim();i=a.value;if(g==""&&i==""){e!=b&&turnOnHighlight(e);a!=b&&turnOnHighlight(a);h._addErrorMessage(n.getString("NoUsernameOrPasswordError"));f.Login.focus();$$WP.Utilities.UI.MatchColumnHeights();return c}else if(g==""){e!=b&&turnOnHighlight(e);a!=b&&turnOffHighlight(a);h._addErrorMessage(n.getString("NoUsernameError"));f.Login.focus();$$WP.Utilities.UI.MatchColumnHeights();return c}else if(i==""){a!=b&&turnOnHighlight(a);e!=b&&turnOffHighlight(e);h._addErrorMessage(n.getString("NoPasswordError"));f.Password.focus();$$WP.Utilities.UI.MatchColumnHeights();return c}}e!=b&&turnOffHighlight(e);a!=b&&turnOffHighlight(a);k.preventDefault();var j={Type:"StandardLogin",Credentials:{Username:WP.Utils.b64EncodeUnicode(g),Password:WP.Utils.b64EncodeUnicode(i)}};loginJSON=JSON.stringify(j);$loginInfo=$afe.select("#LoginInfo");$loginInfo.val(loginJSON);f=$afe.select("#actualLogin");f.submit();disableButtonAndShowSpinner(h.$SubmitButton);return d},_cancelLogin:function(a){a.preventDefault();$$WP.Utilities.TryRedirect(makeLink("Authentication/Reauthenticate/Cancel"));return d},_clearErrorMessage:function(){var b=$afe.select(m);b.addClass(a)},_addErrorMessage:function(d){var c=$afe.select(m),b=$afe.select(e);b.text(d);c.removeClass(a)}};$$WP.Authentication.Login.Controllers.LoginController=o;o.extend($$WP.Controllers.Controller,"WP$Authentication$Login$Controllers$LoginController")})()