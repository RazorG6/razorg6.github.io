var _dateChooser;function callback(c,b,a){document.forms[0].year.value=c;document.forms[0].month.value=getMonthName(b+1);document.forms[0].day.value=a}function createClickFunction(a){function f(b){var e="currentselected",c=WP.Events.getThis(b),d;while(c.nodeName.toUpperCase()!=="TD")c=c.parentNode;d=c.id||c.getAttribute("name");if(d==="calnext"){_dateChooser.drawNextMonth();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}if(d==="calprev"){_dateChooser.drawPreviousMonth();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}if(d==="calcancel"){_dateChooser.clearCalendar();return}_dateChooser.date=d.replace("cal","");$afe.select(".currentselected").removeClass(e);$afe.jq(c).addClass(e);a.call(_dateChooser,_dateChooser.year,_dateChooser.month,d.replace("cal",""),_dateChooser.input);_dateChooser.clearCalendar();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}return f}function DateChooser(d,c,e,b,f){var a=this;a.trigger=d;a.callback=c;a.input=f;a.filter=e||function(){return true};if(b&&typeof b.getYear==="function")a.today=b;else if(typeof b==="string"){a.today=new Date(b);if(isNaN(a.today))a.today=new Date}else a.today=new Date;a.month=a.today.getMonth();a.year=a.today.getFullYear();a.date=a.today.getDate();a.calendar=null;a.clickFunction=createClickFunction(c);a.hoverText="Click to select";a.hoverTextDisabled="Not Available"}function isInCalendar(c){var b,a;for(a=c,b=0;a&&b<8;a=a.parentNode,b++)if(a&&a.id&&a.id.toLowerCase()==="calendar")return true;return false}function lo(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="TD")a=a.parentNode;$afe.jq(a).removeClass("hi")}function hi(b,a){return function(d){var c=WP.Events.getThis(d);if(a)while(c.nodeName.toUpperCase()!=="DIV")c=c.parentNode;else while(c.nodeName.toUpperCase()!=="TD")c=c.parentNode;$afe.jq(c).addClass("hi");if((!$afe.jq(c).hasClass("ctrl")||b)&&_dateChooser.focusOn&&_dateChooser.focusOn!==c.id){document.getElementById(_dateChooser.focusOn)&&lo({target:document.getElementById(_dateChooser.focusOn),srcElement:document.getElementById(_dateChooser.focusOn)});_dateChooser.focusOn=c.id}}}function restoreHi(c){var b=WP.Events.getThis(c),a;if(b&&b.className!=="calendar"&&!isInCalendar(b)){a="cal"+_dateChooser.date;if(_dateChooser.focusOn&&a!==_dateChooser.focusOn)if(_dateChooser.month===_dateChooser.today.getMonth()&&_dateChooser.year===_dateChooser.today.getFullYear()&&document.getElementById(a).firstChild.tagName)document.getElementById(a).firstChild.focus();else{a=document.getElementById(_dateChooser.focusOn);a.firstChild&&a.firstChild.blur();lo({target:a,srcElement:a})}}}function _removeCalendar(){var a=$afe.select("#calendar");if(a.length>0){WP.Events.removeListener(document.body,"click",removeCalendar);WP.Events.removeListener(document.body,"mouseover",restoreHi);accessibilityRestorePage();a.remove();_dateChooser=null}}function removeCalendar(b){var a=WP.Events.getThis(b);a&&a.className!=="calendar"&&!isInCalendar(a)&&_removeCalendar()}function keyOnPrevMonth(b){var a;if(b.keyCode===9){if(b.shiftKey){a=document.getElementById("calcancel").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.lastDate).firstChild.focus();return WP.Events.preventDefault(b)}return}if(b.keyCode===13)_dateChooser.wasEnter=true}function keyOnNextMonth(b){var a;if(b.keyCode===9){if(b.shiftKey){a=document.getElementById("calprev").firstChild;if(!a||a.nodeName.toUpperCase()!=="A"){a=document.getElementById("calcancel").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.lastDate).firstChild.focus();return WP.Events.preventDefault(b)}}return}if(b.keyCode===13)_dateChooser.wasEnter=true}function tabOnCancel(b){var a;if(b.keyCode===9){if(b.shiftKey)return;a=document.getElementById("calprev").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else{a=document.getElementById("calnext").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.firstDate).firstChild.focus()}return WP.Events.preventDefault(b)}}DateChooser.prototype.drawCalendar=function(){var h="keydown",e="cal",f="0px",o="calendar",b=this;_removeCalendar(true);_dateChooser=b;var a=document.createElement("div"),d,r,g,c,i,s,k,j,q,l,m;s=new Date;a.id=o;a.className=o;a.appendChild(b.getCalendarObject());b.setClickFunction(a);i=document.documentElement.className.indexOf("mobile")>=0;if(b.trigger.offsetParent){a.style.position="absolute";d=getElementPosition(b.trigger);r=d.topElement;r.appendChild(a);a.style.zIndex=4001;a.style.left=d.x;a.style.top=d.y;l=$afe.select("html.datatile")[0];q=$afe.jq(b.trigger).parents(".Popup")[0];m=document.getElementById("main");g=q||l||m;k=g.offsetWidth;j=g.offsetHeight;d=getElementPosition(b.trigger,g);if(a.offsetWidth){var n=parseInt(a.style.left,10);c=parseInt(d.x,10)+a.offsetWidth-k;if(c>0)if(c<n)a.style.left=n-c+"px";else a.style.left=f}if(a.offsetHeight){var p=parseInt(a.style.top,10);c=parseInt(d.y,10)+a.offsetHeight-j;if(c>0)if(c<p)a.style.top=p-c+"px";else a.style.top=f}if(i){a.style.left=f;a.style.position="fixed";a.style.top=f}}else{$afe.jq(b.trigger.parentNode).safeInsertBefore(a,b.trigger);$afe.jq(b.trigger).addClass("hidden")}$afe.select(".currentselected").removeClass("currentselect");b.calendar=a;WP.Events.addListener(document.body,"click",removeCalendar);WP.Events.addListener(document.body,"mouseover",restoreHi);if(b.month===b.today.getMonth()&&b.year===b.today.getFullYear()&&document.getElementById(e+s.getDate())){document.getElementById(e+b.date).firstChild.focus();b.focusOn=e+b.date}else{document.getElementById(e+b.firstDate).firstChild.focus();b.focusOn=e+b.firstDate}WP.Events.addListener(document.getElementById("calprev"),h,keyOnPrevMonth);WP.Events.addListener(document.getElementById("calnext"),h,keyOnNextMonth);WP.Events.addListener(document.getElementById("calcancel"),h,tabOnCancel);accessibilityHidePage();b.firstDate="";b.lastDate="";if(i)$afe.jq(a).on("touchmove",function(a){$$WP.Utilities.Mobile.Optimization.IgnoreTouchMove(a,true)})};DateChooser.prototype.clearCalendar=function(){var a=this;_removeCalendar();a.callback();a.trigger.className=a.trigger.className.replace(" hidden","");a.input.focus()};DateChooser.prototype.setClickFunction=function(l){var d=this;for(var j=d.hoverText,i=d.hoverTextDisabled,m=d.clickFunction,h=l.getElementsByTagName("td"),a,b,f=new Date,k=document.all?"hand":"pointer",e=function(a,c){var b="mouseover";WP.Events.addListener(a,"click",m);if(a.className==="ctrl"){WP.Events.addListener(a,b,hi());WP.Events.addListener(a,"mouseout",lo);WP.Events.addListener(a.firstChild,"focus",hi(true));WP.Events.addListener(a.firstChild,"blur",lo)}else{WP.Events.addListener(a,b,function(){a.firstChild.focus()});WP.Events.addListener(a.firstChild,"focus",hi())}a.style.cursor=k;if(c!==true)a.firstChild.title=j},c=function(a){a.style.cursor="default";a.title=i},g=0;g<h.length;++g){a=h[g];b=a.className;if(b==="null"||b==="hdr"||!a.firstChild)continue;if(b==="ctrl")e(a,true);else if(b.indexOf("othermonth")>0)c(a);else if(b.indexOf("n")===0)c(a);else if(b.indexOf("wkndn")===0)c(a);else if(b==="ctrln")c(a);else if(b!=="today")e(a);else if(d.filter(f.getFullYear(),f.getMonth(),f.getDate()))e(a);else c(a)}};DateChooser.prototype.drawNextMonth=function(){var a=this;a.clearCalendar();a.month=(a.month+1)%12;if(a.month===0)a.year++;a.drawCalendar();if(!a.wasEnter&&a.month!==a.today.getMonth()){var b=document.getElementById("calnext");if(b!==null){b=b.firstChild;b&&b.nodeName.toUpperCase()==="A"&&b.focus()}}};DateChooser.prototype.drawPreviousMonth=function(){var a=this;a.clearCalendar();a.month=a.month-1;if(a.month<0)a.month+=12;if(a.month===11)a.year--;a.drawCalendar();if(!a.wasEnter&&a.month!==a.today.getMonth()){var b=document.getElementById("calprev").firstChild;b&&b.nodeName.toUpperCase()==="A"&&b.focus()}};DateChooser.prototype.getCalendarObject=function(){var G="Cancel date selection - tab forward to change months",F="&raquo;",E="Go to next month",n="presentation",i="role",t="true",s="aria-hidden",r="aria-label",D="&laquo;",C="Go to previous month",e="",o="ctrl",m="td",q="tr",h=this,x=document.createElement("table"),z=document.createElement("thead"),u=document.createElement("tbody"),c,a,d,f=h.month,g=h.year,B=h.filter,w,l,b,A=new Date,K=A.getDate(),I=A.getMonth(),J=A.getFullYear(),j=WP.DOM.Create.tag,k=function(b,d){var c=1,a=makeDate(d,b+1,c);b=a.getMonth();while(a.getMonth()===b){if(B(a.getFullYear(),a.getMonth(),c))return true;a.setDate(++c)}return false};l=!k(f,g);c=document.createElement(q);if(k(f-1,g)||l){a=j(m,o+(k(f-1,g)||l?e:"n"),"calprev",C);d=WP.DOM.Create.anchoredNode(D,false,e);a.appendChild(d);d.setAttribute(r,C)}else{a=j(m,o+(k(f-1,g)||l?e:"n"),"calprev",$$WP.I18N.monthTitleFormat(makeDate(g,f)),D);a.setAttribute(s,t)}a.setAttribute(i,n);c.appendChild(a);c.appendChild(j("th","hdr calmonth",e,e,$$WP.I18N.monthTitleFormat(makeDate(g,f+1))));c.lastChild.colSpan=5;if(k(f+1,g)||l){a=j(m,o+(k(f+1,g)||l?e:"n"),"calnext",E);d=WP.DOM.Create.anchoredNode(F,false,e);a.appendChild(d);d.setAttribute(r,E)}else{a=j(m,o+(k(f+1,g)||l?e:"n"),"calnext",$$WP.I18N.monthTitleFormat(makeDate(g,f+2)),F);a.setAttribute(s,t)}a.setAttribute(i,n);c.appendChild(a);z.appendChild(c);c=document.createElement(q);for(w=0;w<7;w++){a=j("th","hdr",e,e,getDayLetter((w+getFirstDayOfWeek())%7));$afe.jq(a).safeAttr(s,t);c.appendChild(a)}z.appendChild(c);x.appendChild(z);var p,H=function(c,h){var b=c.getMonth(),d=c.getDate(),g=c.getFullYear(),i,j=c.getDay(),a;a=j===0||j===6;if(b===f&&b===I&&d===K&&g===J)return!B(g,b,d)?a?"today wkndn":"today n":a?"today wknd":"today";i=h?" othermonth":e;return B(g,b,d)&&!h?a?"wknd":"d":(a?"wkndn":"n")+i},v,y;b=makeDate(g,f+1,1);v=b.getDay()-getFirstDayOfWeek();if(v<0)v+=7;b.setDate(b.getDate()-v);while(b.getMonth()!==f+1&&b.getFullYear()<=g){c=document.createElement(q);c.setAttribute(i,n);for(y=0;y<7;y++){p=b.getMonth()!==f;a=j(m,H(b,p),p?e:"cal"+b.getDate());if(!p&&h.filter(g,f,b.getDate())){d=WP.DOM.Create.anchoredNode(b.getDate().toString(),true);d.setAttribute(i,"option");a.setAttribute(i,n);d.setAttribute(r,$$WP.I18N.getCalendarDateAriaString(b));if(!h.firstDate||h.firstDate===e)h.firstDate=b.getDate();if(!h.lastDate||h.lastDate<b.getDate())h.lastDate=b.getDate()}else{d=document.createElement("span");a.setAttribute(s,t);d.textContent=p?e:b.getDate()}a.appendChild(d);b.getTime()===_dateChooser.today.getTime()&&applyClass(a,"currentselected");c.appendChild(a);b.setDate(b.getDate()+1)}u.appendChild(c)}c=document.createElement(q);a=j(m,o,"calcancel",G);a.setAttribute(i,n);d=WP.DOM.Create.anchoredNode("Cancel");$afe.jq(d).safeAttr(i,"option");$afe.jq(d).safeAttr(r,G);a.appendChild(d);c.appendChild(a);c.firstChild.colSpan=7;u.appendChild(c);u.setAttribute(i,"listbox");$afe.jq(x).safeAttr(i,n);x.appendChild(u);return x};function dfltClndrCallbackFactory(a){return function(e,c,d){var b=document.getElementById(a);if(b){b.holdErrors=false;b.openingCalendar=false;if(e&&!isNaN(c)&&c>-1&&c<12&&d){b.value=formatDate(new Date(e,c,d));_dateChooser.today=parseDate(b.value,true);WP.Events.fireEvent(b,"change");b.focus()}}}}function textBoxDataChooser(h,f,i,a){var c,g,b,e,d;b=document.getElementById(f);if(typeof a==="string"&&a.length>0)c=window[a](f);else if($.isFunction(a))c=a;if(typeof c!=="function")c=dfltClndrCallbackFactory(f);d=$afe.jq(b).safeAttr("data-focus-dte");if(b.value!=="")e=parseDate(b.value,true);else if(typeof d!=="undefined")e=WP.Utils.dte2date(d);g=new DateChooser(h,c,WP.Validators.Calendar[i],e,b);g.drawCalendar()}function writeCalendar(a,g,k,h,i,j,l,f){var b=false,c="holdErrors",e="openingCalendar",d;if(typeof a==="string")a=$afe.select("#"+a);d=$$WP.SimpleTemplates.Anchor({href:"#","class":"calendar datechooserAnchor"});!$$WPUtil.IsNullOrEmpty(f)&&d.safeAttr("id",f);d.safeAppend($$WP.SimpleTemplates.Img({src:k,alt:"Calendar - Use to Select a Date"}));if(g==="range"){if(!$$WPUtil.IsNullOrEmpty(h))window.cachedStartDate=WP.Utils.dte2date(h);if(!$$WPUtil.IsNullOrEmpty(i))window.cachedEndDate=WP.Utils.dte2date(i)}d.click(function(){a.prop(e,true);a.prop(c,b);textBoxDataChooser(d[0],a.prop("id"),g,j);return b}).on("mousedown",function(){a.prop(c,true)}).on("mouseout",function(){a.prop(c,b);a.prop(e,b)});d.safeInsertAfter(a)}function clearCalendarDateRange(){window.cachedStartDate=null;window.cachedEndDate=null}function pageLo(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="DIV")a=a.parentNode;$afe.jq(a).removeClass("hover")}function pageHi(){return function(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="DIV")a=a.parentNode;$afe.jq(a).addClass("hover");_dateChooser.focusOn&&_dateChooser.focusOn!==a.id&&pageLo({target:document.getElementById(_dateChooser.focusOn),srcElement:document.getElementById(_dateChooser.focusOn)});_dateChooser.focusOn=a.id}}function pageCalendarEffects(){var d,b,c,a;d=document.getElementById("pagecalendar");if(d!==null){_dateChooser=function(){};b=d.getElementsByTagName("div");if(b!==null)for(c=0;c<b.length;c++){a=b[c];if($afe.jq(a).hasClass("NoData")||$afe.jq(a).hasClass("EditData")||$afe.jq(a).hasClass("ctrl")){WP.Events.addListener(a,"mouseover",function(){this.firstChild.focus()});WP.Events.addListener(a,"mouseout",function(){this.firstChild.blur()});WP.Events.addListener(a.firstChild,"focus",pageHi());WP.Events.addListener(a.firstChild,"blur",pageLo)}}}}function accessibilityHidePage(){var a=accessibilityGetElements();for(i=0;i<a.length;i++)a[i]&&a[i].setAttribute("aria-hidden","true")}function accessibilityRestorePage(){var a=accessibilityGetElements();for(i=0;i<a.length;i++)a[i]&&a[i].removeAttribute("aria-hidden")}function accessibilityGetElements(){return[document.getElementById("header"),document.getElementById("footer"),document.getElementById("content")]}$$WP.Utilities.UI.Calendars=function $$WP$Utilities$UI$Calendars(b){var a;if(b.type==="load"){a=$afe.select("input.date.withCalendar");a.each(function(){var a=$afe.jq(this);!a.next().is("a.datechooserAnchor")&&writeCalendar(a,a.safeAttr("data-filter"),makeStaticLink("images/calendar.svg"),a.safeAttr("data-filter-from"),a.safeAttr("data-filter-to"),a.safeAttr("data-callback"))})}};$$WP.Utilities.UI.Map.Support.calendars=$$WP.Utilities.UI.Calendars