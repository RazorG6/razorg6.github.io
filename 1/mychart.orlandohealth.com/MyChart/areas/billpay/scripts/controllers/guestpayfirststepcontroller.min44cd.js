(function WP$BillPay$GuestPayFirstStepController$defintion(){var bb="errAmbiguous",ab="errMatchFailed",u="false",F="aria-disabled",Z="callCustomerService",E="@MYCHART@CSPHONE@",Y="#divAccountType",X="&relaystate=",W="billing/guestpay/verify?guarantorID=",n="true",j="aria-hidden",K="href",J="#errorNoPayments",D="AccountNumericError",C="AccountBlankError",t="selected",s="#accountTypeValue",r="#DateOfBirthEntry-Year",q="#DateOfBirthEntry-Day",p="#DateOfBirthEntry-Month",h="disabled",m="#SSNEntry",B="#accountSelectPB",A="#accountSelectHB",e="click",z="#btnVerify",V="balanceForBothServicesAndServiceArea",U="#serviceAreaExplanationToggle",l="@MYCHART@SERVICEAREA@",T="H2MethodStep4",S="H2AmtStep3",R="divChooseAccount",Q="GuarantorBalanceInfo",P="divPmtMethod",y="divPaymentAmounts",O="H2MethodStep3",N="H2AmtStep2",b=false,a="hidden",I="#divVerifiedInfo",o="#errorLocked",i="#divLookupWarnings",x="warningTimeout",w="guarantorExplanation",H="divEditLookupInfo",M="#txtSecondAuth",L="#txtAccountId",k="#LastNameEntry",f="#AccountIDEntry",c="",g=null,G="BillPay.PayAsGuest",v="BillPay.MakePayment",d=true,cb=function WP$BillPay$GuestPayFirstStepController(c,b){var a=this;a.WP$UI$SubwayStopController(c,b,$$WP.Templates.BillPay.GuestPay.GuestPayFirstStep,b.WorkflowModel,d);a._PaymentAmountController=new $$WP.Billing.Shared.PaymentAmountController($.proxy(a.__onPaymentAmountChange,a),$$WP.Strings.get("pmtAmtInvalid",v));a.proxify("_onCaptchaSuccess")},db={Locked:-1,Fail:0,GuarantorMatch:1,HarMatch:2,Ambiguous:3},eb={_CONST_STRING_NAMESPACE:$$WP.Strings.getNamespace(v),_CONST_GUESTPAY_STRING_NAMESPACE:$$WP.Strings.getNamespace(G),_PaymentAmountController:g,_captcha:g,activateStep:function WP$BillPay$GuestPayFirstStepController$activateStep(b,a){this.WP$UI$SubwayStopController$activateStep(b);a(d)},deactivateStep:function WP$BillPay$GuestPayFirstStepController$deactivateStep(b,a){this.WP$UI$SubwayStopController$deactivateStep(b);a(d)},renderStep:function WP$BillPay$GuestPayFirstStepController$renderStep(){this.WP$UI$SubwayStopController$renderStep(this.DataPool.PaymentWorkflowModel);this._setupPage()},__onPaymentAmountChange:function __onPaymentAmountChange(c){var a=this,b=c.Amount;a.DataPool.PaymentWorkflowModel.SelectedAmountType=c.Type;a.DataPool.PaymentWorkflowModel.IsAmountValid=b>0;$$WP.Payments.DataPoolHelpers.setTotalPaymentAmount(a.DataPool,b);$$WP.Payments.DataPoolHelpers.setDetailPaymentAmount(a.DataPool.PaymentPostingDataModel.Details[0],b);a._checkForOverpayment(b);a._updateNextButtonState()},_setupPage:function WP$BillPay$GuestPayFirstStepController$_setupPage(){var h="@MYCHART@GUARACCTNOACCESS@",e="undefined",a=this,b,i;b=a.DataPool.PaymentWorkflowModel;a._setupClickHandlers();a._setupOnChangeHandlers();i=$afe.select(".captchaContainer");if(i.length===1){a._captcha=new $$WP.Captcha(i);setTimeout($.proxy(a._captcha.Render,a._captcha),800)}if(b.SelectedAmountType)a._setupPageFromDataPool();else if(!(typeof b.GuarantorAccountId===e||b.GuarantorAccountId===g||b.GuarantorAccountId===c))if(typeof b.GuarantorMatchInfo===e||b.GuarantorMatchInfo===g||b.GuarantorMatchInfo===c){$afe.select(f).val(b.GuarantorAccountId);setTimeout(function(){$afe.select(k).focus();WP.Events.cancelBeforeUnload()},700)}else{b.GuarantorReadyOnLoad=d;a._onClickVerify();setTimeout(function(){WP.Events.cancelBeforeUnload()},700)}else{$$WPUtil.CalculateAndSetBodyHeight();setTimeout(function(){$afe.select(f).focus();WP.Events.cancelBeforeUnload()},700)}if(b.RedirectedFromVerify){a._CONST_GUESTPAY_STRING_NAMESPACE.addMnemonic(h,b.GuarantorAccountId);$$WP.Strings.setDisplayText($afe.select("#msgMustContinueAsGuest"),"mustContinueWithGuestPay",G);a._CONST_GUESTPAY_STRING_NAMESPACE.removeMnemonic(h);$afe.select("#divMustContinueAsGuest").show()}a._updateNextButtonState();a._updateVerifyButtonState();WP.Events.cancelBeforeUnload()},_setupPageFromDataPool:function WP$BillPay$GuestPayFirstStepController$_setupPageFromDataPool(){var c=this,e=c.DataPool.PaymentWorkflowModel;$afe.select(L).text(e.GuarantorAccountId);$afe.select(M).text(e.GuarantorMatchInfo);$$WP.Billing.Helpers.hideElements([H,w,x]);$afe.select(i).hide();$afe.select(o).hide();c._changeGuarantorMatchFields();$afe.select(I).removeClass(a);c._continueWithGuestPay();e.HideOutStandingBalance=b;if(e.TypeDue===3&&e.HBInfo.CanMakePayment&&e.PBInfo.CanMakePayment){$$WP.Billing.Helpers.hideElements([N,O,y,P,Q]);$$WP.Billing.Helpers.showElements([R,S,T]);if(e.SelectedBillingSystem===1)c._pbSelectClicked(g,d);else c._hbSelectClicked(g,d);c._CONST_STRING_NAMESPACE.addMnemonic(l,e.ServiceAreaDescription,$$WP.Strings.EncodingTypes.None);$$WP.Strings.setDisplayText($afe.select(U),V,v);c._CONST_STRING_NAMESPACE.removeMnemonic(l)}else{var f=e.SelectedBillingSystem==1?d:b;c._setPaymentBubbleAmounts(f);c._setPaymentAmountExplanation()}},_setupClickHandlers:function WP$BillPay$GuestPayFirstStepController$_setupClickHandlers(){var b="keydown",c="keyup",a=this,n,k,j,l,d,g,h,i;$afe.select(".GuestPayInput").on(c,$.proxy(a._keyPressForAccountLookup,a));$afe.select(f).on(c,$.proxy(a._keyPressForAccountLookup,a));n=$afe.select(z);n.on(e,$.proxy(a._onClickVerify,a));n.on(b,$.proxy(a._fakeButtonKeyHandler,a));k=$afe.select("#btnTryName");k.on(e,1,$.proxy(a._onClickTryOther,a));k.on(b,1,$.proxy(a._fakeButtonKeyHandler,a));j=$afe.select("#btnTryDate");j.on(e,2,$.proxy(a._onClickTryOther,a));j.on(b,2,$.proxy(a._fakeButtonKeyHandler,a));l=$afe.select("#btnTrySSN");l.on(e,3,$.proxy(a._onClickTryOther,a));l.on(b,3,$.proxy(a._fakeButtonKeyHandler,a));d=$afe.select("#btnContinueWithoutAccount");d.on(e,$.proxy(a._continueWithGuestPay,a));d.on(b,$.proxy(a._fakeButtonKeyHandler,a));g=$afe.select("#btnContinueWithoutSignIn");g.on(e,$.proxy(a._continueWithGuestPay,a));g.on(b,$.proxy(a._fakeButtonKeyHandler,a));var o=$afe.select("#btnBackFromVerifyInfo");o.on(e,$.proxy(a._goBackToPaymentInfo,a));o.on(b,$.proxy(a._fakeButtonKeyHandler,a));h=$afe.select(A);h.on(e,$.proxy(a._hbSelectClicked,a));h.on(b,$.proxy(a._fakeButtonKeyHandler,a));i=$afe.select(B);i.on(e,$.proxy(a._pbSelectClicked,a));i.on(b,$.proxy(a._fakeButtonKeyHandler,a));$afe.select(".segment2").on("input","input",$.proxy(a._dateKeyUp,a));if($$WP.Utilities.UI.IsMobile){$afe.select(f).on(c,$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength);$afe.select(m).on(c,$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength)}},_setupOnChangeHandlers:function WP$BillPay$GuestPayFirstStepController$_setupOnChangeHandlers(){$afe.select(f).on("input change",$.proxy(this._onGuarantorAccountChange,this))},_onClickVerify:function WP$BillPay$GuestPayFirstStepController$_onClickVerify(){var b="Billing/GuestPay/VerifyGuarantor",a=this,e,c,d,i,j;if($afe.select(z).hasClass(h))return;d=a.DataPool.PaymentWorkflowModel.MatchInfoType;if(a.DataPool.PaymentWorkflowModel.GuarantorReadyOnLoad){e=a.DataPool.PaymentWorkflowModel.GuarantorAccountId;c=a.DataPool.PaymentWorkflowModel.GuarantorMatchInfo;d=a.DataPool.PaymentWorkflowModel.MatchInfoType;$afe.select(f).val(e)}else{if(!a._validateGuarantorLookupFields())return;if(d===2)c=$afe.select(p).val()+"/"+$afe.select(q).val()+"/"+$afe.select(r).val();else c=d===1?$afe.select(k).val().trim():$afe.select(m).val();e=$afe.select(f).val().trim()}a.DataPool.PaymentWorkflowModel.GuarantorMatchInfo=c;i={accountId:e,earInfo:c,infoType:d};if(a._captcha!==g){j=$.proxy(function(a){$.ajax({type:"POST",url:makeLink(b),data:i,dataType:"json",captchaResponse:a,success:this._onCaptchaSuccess})},a);a._captcha.GetResponse(j)}else $.ajax({type:"POST",url:makeLink(b),data:i,dataType:"json",success:$.proxy(a._returnFromGuarantorLookup,a)})},_onCaptchaSuccess:function WP$BillPay$GuestPayFirstStepController$_onCaptchaSuccess(a){if(a.Errors)this._handleErrors(a.Errors);else a.Success&&this._returnFromGuarantorLookup(a)},_handleErrors:function WP$BillPay$GuestPayFirstStepController$_handleErrors(d){var b,c,a;this._captcha.Reset();b=$afe.select(".captchaContainer .messagedisplay");c=d.split(" ");for(a=0;a<c.length;a++)if(c[a]==="recaptcha-not-reachable"){b.safeAppend($$WP.SimpleTemplates.ValidationMessage($$WP.Strings.get("reCaptchaNotReachableError",G)));return}b.safeAppend($$WP.SimpleTemplates.ValidationMessage($$WP.Strings.get("reCaptchaFailedError",G)))},_onClickTryOther:function WP$BillPay$GuestPayFirstStepController$_onClickTryOther(c){var a=this;a.DataPool.PaymentWorkflowModel.MatchInfoType=c.data;a._setGuarantorMatchErrorMessage(b);a._changeGuarantorMatchFields();a._updateVerifyButtonState();$$WPUtil.CalculateAndSetBodyHeight()},_continueWithGuestPay:function WP$BillPay$GuestPayFirstStepController$_continueWithGuestPay(){WP.Events.beforeUnload();$$WP.Billing.Helpers.hideElements(["divMyChartPrompt","divSigninPrompt"]);this._showPromptInSidebar();$afe.select("#paymentInfoContainer").removeClass(a);$$WPUtil.CalculateAndSetBodyHeight();$$WPUtil.setScrollTop($afe.select("#AmountSectionHeader").offset().top)},_hbSelectClicked:function WP$BillPay$GuestPayFirstStepController$_hbSelectClicked(f,e){var a=this,b=a.DataPool.PaymentWorkflowModel;$afe.select(A).prop("checked",d);if(!e&&b.SelectedBillingSystem===2)return;$$WP.Billing.Helpers.showElements([y]);$afe.select(s).text(a._CONST_STRING_NAMESPACE.getString("hb"));$afe.select(B).removeClass(t);$afe.select(A).addClass(t);if(b.SelectedBillingSystem!==2)b.SelectedAmountType=c;b.SelectedBillingSystem=2;a._setPaymentBubbleAmounts();a._setCustomerServiceMessage(b.HBInfo.CustomerServicePhone);a.DataPool.PaymentPostingDataModel.MerchantContext=2;a.DataPool.PaymentPostingDataModel.Details[0].BillingSystem=2;a._afterAccountToggle(e)},_pbSelectClicked:function WP$BillPay$GuestPayFirstStepController$_pbSelectClicked(f,e){var a=this,b=a.DataPool.PaymentWorkflowModel;$afe.select(B).prop("checked",d);if(!e&&b.SelectedBillingSystem===1)return;$$WP.Billing.Helpers.showElements([y]);$afe.select(s).text(a._CONST_STRING_NAMESPACE.getString("pb"));$afe.select(A).removeClass(t);$afe.select(B).addClass(t);if(b.SelectedBillingSystem!==1)b.SelectedAmountType=c;b.SelectedBillingSystem=1;a._setPaymentBubbleAmounts(d);a._setCustomerServiceMessage(b.PBInfo.CustomerServicePhone);a.DataPool.PaymentPostingDataModel.MerchantContext=1;a.DataPool.PaymentPostingDataModel.Details[0].BillingSystem=1;a._afterAccountToggle(e)},_fakeButtonKeyHandler:function WP$BillPay$GuestPayFirstStepController$_fakeButtonKeyHandler(a){if(a.which===13||a.which===32){$afe.jq(a.delegateTarget).trigger(e);a.stopPropagation();a.preventDefault()}},_keyPressForAccountLookup:function WP$BillPay$GuestPayFirstStepController$_keyPressForAccountLookup(b){this._updateVerifyButtonState();if(b.which===13){var a=$afe.select(z);!a.hasClass(h)&&a.trigger(e);b.preventDefault()}},_keyPressForOtherAmount:function WP$BillPay$GuestPayFirstStepController$_keyPressForOtherAmount(a){if(a.which===13||a.which===32){$afe.select("#PaymentOtherAmountInput").trigger("focusout");a.which===13&&a.preventDefault()}},_dateKeyUp:function WP$BillPay$GuestPayFirstStepController$_dateKeyUp(b){$$WP.Utilities.UI.IsMobile&&$$WP.Payments.FormValidationHelpers.enforceNumberFieldMaxLength(b);var a=b.target;if(a.value.length===a.maxLength)if(a.id==="DateOfBirthEntry-Month")$afe.select(q).focus();else $afe.select(r).focus()},_onGuarantorAccountChange:function WP$BillPay$GuestPayFirstStepController$_dateKeyUp(){$$WP.Billing.Helpers.hideElements([C,D]);$afe.select("#GuarantorAccountBlankError, #GuarantorAccountNumericError").empty()},_returnFromGuarantorLookup:function WP$BillPay$GuestPayFirstStepController$_returnFromGuarantorLookup(c){var b=this,a=c.Model;$afe.select(i).hide();$afe.select(o).hide();$afe.select(J).hide();if(a.Result===$$WP.BillPay.GuestPayLookupResultEnum.GuarantorMatch||a.Result===$$WP.BillPay.GuestPayLookupResultEnum.HarMatch){b._guarantorMatchSuccess(a,c.PBInfo,c.HBInfo);return}else if(a.Result===$$WP.BillPay.GuestPayLookupResultEnum.Fail)b._guarantorMatchFailed(a.CustomerServicePhone);else if(a.Result===$$WP.BillPay.GuestPayLookupResultEnum.Locked){b._accountLocked(a.CustomerServicePhone);return}else a.Result===$$WP.BillPay.GuestPayLookupResultEnum.Ambiguous&&b._accountMatchAmbiguous(a.CustomerServicePhone);b._captcha!==g&&setTimeout($.proxy(b._captcha.Reset,b._captcha),800)},_guarantorMatchSuccess:function $$WP$Controllers$GuestPayController$_guarantorMatchSuccess(j,m,l){var e=this,g=b;e._convertResponseToViewModel(j,m,l);var c=e.DataPool.PaymentWorkflowModel,k=$afe.select(f).val();e._setupUIForMatchSuccess(k);if(c.IsSBO&&c.TypeDue!==0){if(!c.HBInfo.CanMakePayment){e._noPaymentsAllowed(c.CustomerServicePhone);return}e._setUpSBO()}else if(c.TypeDue===1){if(!c.PBInfo.CanMakePayment){e._noPaymentsAllowed(c.CustomerServicePhone);return}e._setUpPBOnly()}else if(c.TypeDue===2){if(!c.HBInfo.CanMakePayment){e._noPaymentsAllowed(c.CustomerServicePhone);return}e._setUpHBOnly()}else if(c.TypeDue===3){var h=c.HBInfo.CanMakePayment,i=c.PBInfo.CanMakePayment;if(h&&i)e._setUpHBAndPBSplit();else if(h)e._setUpHBOnly();else if(i)e._setUpPBOnly();else{e._noPaymentsAllowed(c.CustomerServicePhone);return}}else{$afe.select("#msgNoBalance").removeClass(a);e._showPromptInSidebar();g=d}if(!g){c.HasActiveWPR&&e._setUpSignInForm();if(c.HasActiveWPR&&c.ShowMyChartPrompt)$afe.select("#divSigninPrompt").removeClass(a);else if(c.ShowMyChartPrompt&&c.SignUpLink.length>0){$afe.select("#divMyChartPrompt").removeClass(a);$afe.select("#btnCreateAccount").safeAttr(K,c.SignUpLink)}else e._continueWithGuestPay()}e._buildPaymentMethodModel();$$WPUtil.CalculateAndSetBodyHeight();$afe.select("#divVerifiedInfoRegion").focus()},_setupUIForMatchSuccess:function WP$BillPay$GuestPayFirstStepController$_setupUIForMatchSuccess(e){var b="#AccountId-Label-2",c=this,d=c.DataPool.PaymentWorkflowModel;$afe.select(L).text(e);$afe.select(M).text(d.GuarantorMatchInfo);$afe.select("#serviceAreaValue").text(d.ServiceAreaDescription);$$WP.Billing.Helpers.hideElements([H,w,x]);$afe.select(i).hide();$afe.select(o).hide();$afe.select(I).removeClass(a);$afe.select("#divQuickPayVerify").safeAttr(j,n);if(d.HospitalAccountId)$afe.select(b).text(c._CONST_GUESTPAY_STRING_NAMESPACE.getString("hospacctnum"));else $afe.select(b).text(c._CONST_GUESTPAY_STRING_NAMESPACE.getString("guaracctnum"));c._changeGuarantorMatchFields()},_buildPaymentMethodModel:function WP$BillPay$GuestPayFirstStepController$_buildPaymentMethodModel(){var a=this.DataPool.PaymentWorkflowModel,b=this.DataPool.PaymentPostingDataModel;b.MerchantServiceAreaId=a.ServiceAreaId;b.PrimaryGuarantorAccountId=a.GuarantorAccountId;b.MerchantContext=a.SelectedBillingSystem===1?1:2;b.UniqueIdentifier=a.GuarantorAccountId;var d=a.HospitalAccountId!==g&&a.HospitalAccountId!==c;b.Details=[];b.Details[0]={PaymentAmount:b.TotalPaymentAmount,GuarantorAccountId:b.PrimaryGuarantorAccountId,BillingSystem:a.SelectedBillingSystem,HospitalAccountId:a.HospitalAccountId,DisplayHospitalAccount:d}},_setUpSignInForm:function WP$BillPay$GuestPayFirstStepController$_setUpSignInForm(){var a=this.DataPool.PaymentWorkflowModel,b=a.GuarantorAccountId,f=a.HospitalAccountId,d=a.SelectedBillingSystem===0?c:a.SelectedBillingSystem,e=b+"|"+a.GuarantorMatchInfo+"|"+a.MatchInfoType+"|"+f;$afe.select("#SignInSidebar-id").val(b);$afe.select("#SignInSidebar-context").val(d);$afe.select("#SignInSidebar-relay").val(e);d=encodeURIComponent(d);b=encodeURIComponent(b);e=encodeURIComponent(e);$afe.select("#btnSignIn").safeAttr(K,makeLink(W+b+"&context="+d+X+e))},_setUpSBO:function WP$BillPay$GuestPayFirstStepController$_setUpSBO(){var b=this;b.DataPool.PaymentWorkflowModel.SelectedBillingSystem=3;b._setPaymentAmountExplanation();b._setPaymentBubbleAmounts();$afe.select("#VerifyInfoField").addClass(a);b._setCustomerServiceMessage(b.DataPool.PaymentWorkflowModel.HBInfo.CustomerServicePhone)},_setUpHBOnly:function WP$BillPay$GuestPayFirstStepController$_setUpHBOnly(){var b=this;$afe.select(Y).removeClass(a);$afe.select(s).text(b._CONST_STRING_NAMESPACE.getString("hb"));b.DataPool.PaymentWorkflowModel.SelectedBillingSystem=2;b._setPaymentAmountExplanation();b._setPaymentBubbleAmounts();b._setCustomerServiceMessage(b.DataPool.PaymentWorkflowModel.HBInfo.CustomerServicePhone)},_setUpPBOnly:function WP$BillPay$GuestPayFirstStepController$_setUpPBOnly(){var b=this;$afe.select(Y).removeClass(a);$afe.select(s).text(b._CONST_STRING_NAMESPACE.getString("pb"));b.DataPool.PaymentWorkflowModel.SelectedBillingSystem=1;b._setPaymentAmountExplanation();b._setPaymentBubbleAmounts(d);b._setCustomerServiceMessage(b.DataPool.PaymentWorkflowModel.PBInfo.CustomerServicePhone)},_setUpHBAndPBSplit:function WP$BillPay$GuestPayFirstStepController$_setUpHBAndPBSplit(){var a=this;$$WP.Billing.Helpers.hideElements([N,O,y,P,Q]);$$WP.Billing.Helpers.showElements([R,S,T]);$afe.select(s).text(a._CONST_STRING_NAMESPACE.getString("hb"));a._CONST_STRING_NAMESPACE.addMnemonic(l,a.DataPool.PaymentWorkflowModel.ServiceAreaDescription,$$WP.Strings.EncodingTypes.None);$$WP.Strings.setDisplayText($afe.select(U),V,v);a._CONST_STRING_NAMESPACE.removeMnemonic(l)},_convertResponseToViewModel:function WP$BillPay$GuestPayFirstStepController$_convertResponseToViewModel(b,d,c){var a=this.DataPool.PaymentWorkflowModel;a.ServiceAreaId=b.ServiceArea;a.ServiceAreaDescription=b.ServiceAreaDescription;a.FormattedName=b.FormattedName;a.CustomerServicePhone=b.CustomerServicePhone;a.EncryptedGuarId=b.EncryptedGuarId;a.GuarantorAccountId=b.GuarantorId;a.HospitalAccountId=b.HospitalAccountId;a.HasActiveWPR=b.HasActiveWPR;a.ShowMyChartPrompt=b.ShowMyChartPrompt;a.ShowAnyMyChartPrompt=b.ShowAnyMyChartPrompt;a.SignUpLink=b.SignUpLink;a.IsSBO=b.IsSBO;a.TypeDue=b.TypeDue;if(a.MatchInfoType===1)a.GuarantorMatchInfo=b.FormattedName;if(a.TypeDue===1||a.TypeDue===3)a.PBInfo=d;if(a.TypeDue===2||a.TypeDue===3)a.HBInfo=c},_setPaymentAmountExplanation:function WP$BillPay$GuestPayFirstStepController$_setPaymentAmountExplanation(){var a="noBalance",b=this.DataPool.PaymentWorkflowModel,e=$afe.select("#serviceAreaExplanation"),d=c;switch(b.SelectedBillingSystem){case 1:d=b.PBInfo.OutstandingBalance>0?"balanceForProfessionalServicesAndServiceArea":a;break;case 2:d=b.HBInfo.OutstandingBalance>0?"balanceForHospitalServicesAndServiceArea":a;break;case 3:d=b.HBInfo.OutstandingBalance>0?"balanceForServiceArea":a}this._CONST_STRING_NAMESPACE.addMnemonic(l,b.ServiceAreaDescription,$$WP.Strings.EncodingTypes.None);$$WP.Strings.setDisplayText(e,d,v);this._CONST_STRING_NAMESPACE.removeMnemonic(l)},_setPaymentBubbleAmounts:function WP$BillPay$GuestPayFirstStepController$_setPaymentBubbleAmounts(i){var d="#newActivityContainer",b=this;for(var f=b.DataPool.PaymentWorkflowModel,c=i?f.PBInfo:f.HBInfo,h,e=0;e<c.PaymentOptions.length;e++)if(c.PaymentOptions[e].AmountType===$$WP.Billing.Shared.PaymentAmountType.AmountDue)h=c.PaymentOptions.Amount;$afe.select("#paymentAmountContainer").empty().safeAppend($afe.renderTemplate($$WP.Templates.Billing.Shared.PaymentAmount.Selector,c.PaymentOptions));if(c.HasActivitySinceStatement){$afe.select(d).removeClass(a);b._setBalanceDiscrepencyMessage(c)}else $afe.select(d).addClass(a);b._PaymentAmountController.setupEventListeners();var g={Type:b.DataPool.PaymentWorkflowModel.SelectedAmountType,Amount:$$WP.Payments.DataPoolHelpers.getTotalPaymentAmount(b.DataPool)};b._PaymentAmountController.setPaymentAmountSelection(g)},_setBalanceDiscrepencyMessage:function WP$BillPay$GuestPayFirstStepController$_setBalanceDiscrepencyMessage(e){var j="newActivity",i="newActivityPhone",f=this,a,l,m,n,b,h,p,o,q,g=f.DataPool.PaymentWorkflowModel,k=!g.ShowAnyMyChartPrompt,r=$$WP.Currency.Helpers.numberToCurrency(e.LastStatementAmountDue,d);if(!g.HasActiveWPR){h=g.SignUpLink;if(k)h=c;if(e.HasBadDebtHARs)if(e.CustomerServicePhone&&h!==c){a="7";b="newActivityBadDebtSignUpPhone"}else if(h!==c){a="8";b="newActivityBadDebtSignUp"}else if(e.CustomerServicePhone){a="5";b=i}else{a="6";b=j}else if(e.CustomerServicePhone&&h!==c){a="1";b="newActivitySignUpPhone"}else if(h!==c){a="2";b="newActivitySignUp"}else if(e.CustomerServicePhone){a="5";b=i}else{a="6";b=j}}else{if(e.HasBadDebtHARs)if(e.CustomerServicePhone)if(k){a="11";b="newActivityBadDebtPhone"}else{a="9";b="newActivityBadDebtSignInPhone"}else if(k){a="12";b="newActivityBadDebt"}else{a="10";b="newActivityBadDebtSignIn"}else if(e.CustomerServicePhone)if(k){a="5";b=i}else{a="3";b="newActivitySignInPhone"}else if(k){a="6";b=j}else{a="4";b="newActivitySignIn"}o=encodeURIComponent(g.GuarantorAccountId);p=encodeURIComponent(g.GuarantorAccountId+"|"+g.GuarantorMatchInfo+"|"+g.MatchInfoType);q=g.SelectedBillingSystem;h=makeLink(W+o+"&summary=1&context="+q+X+p)}l="@MYCHART@LASTSTATEMENTDUE"+a+"@";m="@MYCHART@NEWACTIVITYPHONE"+a+"@";n="@MYCHART@MYCHARTURL"+a+"@";f._CONST_STRING_NAMESPACE.addMnemonic(l,r);f._CONST_STRING_NAMESPACE.addMnemonic(m,e.CustomerServicePhone);f._CONST_STRING_NAMESPACE.addMnemonic(n,h);dangerou$.setHtml($afe.select("#newActivity"),f._CONST_STRING_NAMESPACE.getString(b));f._CONST_STRING_NAMESPACE.removeMnemonic(l);f._CONST_STRING_NAMESPACE.removeMnemonic(m);f._CONST_STRING_NAMESPACE.removeMnemonic(n)},_setCustomerServiceMessage:function WP$BillPay$GuestPayFirstStepController$_setCustomerServiceMessage(d){var b="#divCSPhone";if(!d||d===c)$afe.select(b).addClass(a);else{$afe.select(b).removeClass(a);this._CONST_STRING_NAMESPACE.addMnemonic(E,d);$afe.select("#csPhoneNumber").text(this._CONST_STRING_NAMESPACE.getString(Z));this._CONST_STRING_NAMESPACE.removeMnemonic(E)}},_afterAccountToggle:function WP$BillPay$GuestPayFirstStepController$_afterAccountToggle(e){var d=this,a=d.DataPool.PaymentWorkflowModel;if(!e&&a.SelectedPaymentOptionId){$afe.select("#"+a.SelectedPaymentOptionId).removeClass(t);a.SelectedPaymentOptionId=c;a.TotalPaymentAmount=c;$$WP.Payments.DataPoolHelpers.setTotalPaymentAmount(d.DataPool,0);$$WP.Payments.DataPoolHelpers.setDetailPaymentAmount(d.DataPool.PaymentPostingDataModel.Details[0],0)}$afe.select("#balanceTypeContainer").addClass("selectionMade");if(!e)a.IsAmountValid=b;$$WPUtil.CalculateAndSetBodyHeight();d._updateNextButtonState()},_checkForOverpayment:function WP$BillPay$GuestPayFirstStepController$_checkForOverpayment(f){var c="#divOverpaymentWarning",d=this.DataPool.PaymentWorkflowModel,e=d.SelectedBillingSystem===1?d.PBInfo.OutstandingBalance:d.HBInfo.OutstandingBalance;if(f>e){$afe.select(c).removeClass(a);this.DataPool.PaymentWorkflowModel.IsAmountValid=b}else $afe.select(c).addClass(a);$$WPUtil.CalculateAndSetBodyHeight()},_updateNextButtonState:function WP$BillPay$GuestPayFirstStepController$_updateNextButtonState(){var a=$afe.select("#subway-next");if(this.DataPool.PaymentWorkflowModel.IsAmountValid){a.removeClass(h);a.prop(h,b);a.safeAttr(F,u);a.removeAttr("aria-label")}else{a.addClass(h);a.prop(h,d);a.safeAttr(F,n)}},_updateVerifyButtonState:function WP$BillPay$GuestPayFirstStepController$_updateVerifyButtonState(){var c=$afe.select(z),a=d,e=this.DataPool.PaymentWorkflowModel.MatchInfoType,g;if($$WPUtil.IsNullOrEmpty($afe.select(f).val().trim()))a=b;else if(e===1){if($$WPUtil.IsNullOrEmpty($afe.select(k).val().trim()))a=b}else if(e===2){if($$WPUtil.IsNullOrEmpty($afe.select(p).val())||$$WPUtil.IsNullOrEmpty($afe.select(q).val())||$$WPUtil.IsNullOrEmpty($afe.select(r).val()))a=b}else if(e===3)if($$WPUtil.IsNullOrEmpty($afe.select(m).val()))a=b;if(a){c.removeClass(h);c.safeAttr(F,u)}else{c.addClass(h);c.safeAttr(F,n)}},_showPromptInSidebar:function WP$BillPay$GuestPayFirstStepController$_showPromptInSidebar(){var b=this;if(!b.DataPool.PaymentWorkflowModel.ShowAnyMyChartPrompt)return;if(b.DataPool.PaymentWorkflowModel.HasActiveWPR)$afe.select("#divMyChartSignInPromptSidebar").removeClass(a);else if(b.DataPool.PaymentWorkflowModel.SignUpLink.length>0){$afe.select("#divMyChartSignUpPromptSidebar").removeClass(a);$afe.select("#SidebarCreateAccount").safeAttr(K,b.DataPool.PaymentWorkflowModel.SignUpLink)}},_guarantorMatchFailed:function WP$BillPay$GuestPayFirstStepController$_guarantorMatchFailed(a){$$WP.Billing.Helpers.showElements([ab]);$$WP.Billing.Helpers.hideElements([bb]);this._setupAccountMatchFailure(a)},_accountMatchAmbiguous:function WP$BillPay$GuestPayFirstStepController$_accountMatchAmbiguous(b){if(this.DataPool.PaymentWorkflowModel.MatchInfoType===1){$$WP.Billing.Helpers.showElements([bb]);$$WP.Billing.Helpers.hideElements([ab]);this._setupAccountMatchFailure(b)}else{$afe.select("#divGuarLookup").addClass(a);this._noPaymentsAllowed(b)}},_setupAccountMatchFailure:function WP$BillPay$GuestPayFirstStepController$_setupAccountMatchFailure(a){$$WP.Billing.Helpers.showElements(["guarLookupOptions"]);this._setGuarantorMatchErrorMessage(d,a);$afe.select(i).slideDown(150,function(){$$WPUtil.CalculateAndSetBodyHeight();$afe.select(i).focus()})},_setGuarantorMatchErrorMessage:function WP$BillPay$GuestPayFirstStepController$_setGuarantorMatchErrorMessage(e,f){var c="btnTryName",b="btnTrySSN",a="btnTryDate",d=this.DataPool.PaymentWorkflowModel;switch(d.MatchInfoType){case 1:if(d.UseSSN){$$WP.Billing.Helpers.showElements([a,b]);$$WP.Billing.Helpers.hideElements([c])}else{$$WP.Billing.Helpers.showElements([a]);$$WP.Billing.Helpers.hideElements([c,b])}break;case 2:if(d.UseSSN){$$WP.Billing.Helpers.showElements([c,b]);$$WP.Billing.Helpers.hideElements([a])}else{$$WP.Billing.Helpers.showElements([c]);$$WP.Billing.Helpers.hideElements([a,b])}break;case 3:$$WP.Billing.Helpers.hideElements([b]);$$WP.Billing.Helpers.showElements([c,a])}e&&this._setCustomerServiceMessage(f)},_noPaymentsAllowed:function WP$BillPay$GuestPayFirstStepController$_noPaymentsAllowed(e){var c="errornopayments",b=this,d;$$WP.Billing.Helpers.hideElements([H,w,x]);$afe.select(i).hide();$afe.select(o).hide();$afe.select(I).removeClass(a);d=$afe.select("#errNoPaymentsMessage");if(e){b._CONST_STRING_NAMESPACE.addMnemonic(E,e);d.text(b._CONST_GUESTPAY_STRING_NAMESPACE.getString(c)+" "+b._CONST_STRING_NAMESPACE.getString(Z));b._CONST_STRING_NAMESPACE.removeMnemonic(E)}else d.text(b._CONST_GUESTPAY_STRING_NAMESPACE.getString(c));$afe.select(J).show();$$WPUtil.CalculateAndSetBodyHeight();$afe.select("#errorNoPayments .button").focus()},_accountLocked:function WP$BillPay$GuestPayFirstStepController$_accountLocked(e){var c="errorlocked",b="@MYCHART@CSPHONE2@",a=this,d;$$WP.Billing.Helpers.hideElements(["divGuarLookup",w,x]);$afe.select(i).hide();$afe.select(J).hide();$afe.select(o).show();d=$afe.select("#errLockedMessage");if(e){a._CONST_STRING_NAMESPACE.addMnemonic(b,e);d.text(a._CONST_GUESTPAY_STRING_NAMESPACE.getString(c)+" "+a._CONST_STRING_NAMESPACE.getString("callCustomerService2"));a._CONST_STRING_NAMESPACE.removeMnemonic(b)}else d.text(a._CONST_GUESTPAY_STRING_NAMESPACE.getString(c));$afe.select("#errorLocked .button").focus();$$WPUtil.CalculateAndSetBodyHeight()},_changeGuarantorMatchFields:function WP$BillPay$GuestPayFirstStepController$_changeGuarantorMatchFields(){var e="SecondAuth-Readonly-Label-3",d="SecondAuth-Readonly-Label-2",b="SecondAuth-Readonly-Label-1";$$WP.Billing.Helpers.hideElements(["divEnterLastName","divEnterDOB","divEnterSSN",b,d,e]);$afe.select(b).safeAttr(j,n);$afe.select(d).safeAttr(j,n);$afe.select(e).safeAttr(j,n);switch(this.DataPool.PaymentWorkflowModel.MatchInfoType){case 1:$afe.select("#divEnterLastName").removeClass(a);$afe.select("#SecondAuth-Readonly-Label-1").removeClass(a);$afe.select(b).safeAttr(j,u);$afe.select(k).val(c);$afe.select(k).focus();break;case 2:$afe.select("#divEnterDOB").removeClass(a);$afe.select("#SecondAuth-Readonly-Label-2").removeClass(a);$afe.select(d).safeAttr(j,u);$afe.select(p).val(c);$afe.select(q).val(c);$afe.select(r).val(c);$afe.select(p).focus();break;case 3:$afe.select("#divEnterSSN").removeClass(a);$afe.select("#SecondAuth-Readonly-Label-3").removeClass(a);$afe.select(e).safeAttr(j,u);$afe.select(m).val(c);$afe.select(m).focus()}},_validateGuarantorLookupFields:function WP$BillPay$GuestPayFirstStepController$_validateGuarantorLookupFields(){var e=this,a=d,g=$afe.select(f).val();if(g===c){$$WP.Billing.Helpers.showElements([C]);$$WP.Billing.Helpers.hideElements([D]);a=b}else if(!$.isNumeric(g)||parseInt(g)<0){$$WP.Billing.Helpers.showElements([D]);$$WP.Billing.Helpers.hideElements([C]);$afe.select("AccountIDEntry").focus();a=b}else $$WP.Billing.Helpers.hideElements([C,D]);switch(e._guarMatchItem){case 1:if(!e._validateLastName())a=b;break;case 2:if(!e._validateDateOfBirth())a=b;break;case 3:if(!e._validateSSN())a=b}return a},_validateLastName:function WP$BillPay$GuestPayFirstStepController$_validateLastName(){var a="NameBlankError";if($afe.select(k).val()!==c){$$WP.Billing.Helpers.hideElements([a]);return d}else{$$WP.Billing.Helpers.showElements([a]);return b}},_validateDateOfBirth:function WP$BillPay$GuestPayFirstStepController$_validateDateOfBirth(){var a="DateFormatError",f=$afe.select(p).val(),g=$afe.select(q).val(),h=$afe.select(r).val();if($.isNumeric(f)){var c=Number(f);if(c<1||c>12){$$WP.Billing.Helpers.showElements([a]);return b}}else{$$WP.Billing.Helpers.showElements([a]);return b}if($.isNumeric(g)){var e=Number(g);if(e<1||e>31){$$WP.Billing.Helpers.showElements([a]);return b}}else{$$WP.Billing.Helpers.showElements([a]);return b}if(!$.isNumeric(h)){$$WP.Billing.Helpers.showElements([a]);return b}$$WP.Billing.Helpers.hideElements([a]);return d},_validateSSN:function WP$BillPay$GuestPayFirstStepController$_validateSSN(){var e="SSNNumericError",a="SSNBlankError",f=$afe.select(m).val();if(f===c){$$WP.Billing.Helpers.showElements([a]);$$WP.Billing.Helpers.hideElements([e]);return b}else if($.isNumeric(f)){$$WP.Billing.Helpers.hideElements([a,e]);return d}else{$$WP.Billing.Helpers.showElements([e]);$$WP.Billing.Helpers.hideElements([a]);return b}}};cb.prototype=eb;$$WP.BillPay=$$WP.BillPay||{};$$WP.BillPay.GuestPayLookupResultEnum=db;$$WP.BillPay.GuestPayFirstStepController=cb;cb.extend($$WP.UI.SubwayStopController,"WP$BillPay$GuestPayFirstStepController")})();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function UnitTests$PrevBalPaymentAmountStepController(){var a;a=$$WP.Debug.UnitTest.assert})