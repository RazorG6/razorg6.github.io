/*! Copyright (c) Epic Systems Corporation 2013-2019 */
$$WPComp.SignupDemographicsForm=function Epic$PatientAccess$Components$SignupDemographicsForm(a){var h="Signup.Signup",g="#SignupDemographic_Form",d=null,c=this,b,e,k,f,i;c.Components$DemographicsForm(a);b=c;if(a.formName!=d&&a.containerName!=d){c.$form=$afe.select(a.formName);c.$demoContainer=$afe.select(a.containerName)}else{c.$form=$afe.select(g);c.$demoContainer=$afe.select("#SignupDemographic_Container")}f=$afe.select("#DirectSignupError");k=$$WP.Strings.setDisplayText(f,"DirectSignupError",h);k.length!==0&&f.removeClass("hidden");$$WP.Strings.setDisplayText($afe.select("#BadToken"),"BadToken",h);e=$afe.select("input.workflow");$restartButton=$afe.select("input.cancelworkflow");if(a.multipleSteps){e=$afe.select("input.completeworkflow");i=$afe.select("input.nextstep");i.click(function nextButtonClick(f){f.preventDefault();if(!b.IsRequiredFieldsFilled(b)){var c=b.$demoContainer.find(".alert").not(".hidden").parent().offset(),e=0;if(typeof c!=="undefined"&&c!==d)e=c.top;$$WPUtil.setScrollTop(e);a.parent.SetStepCompleteStatus(a.parent,0,false);return}$$WPUtil.setScrollTop(0);a.parent.ValidateDemographicsAndProceed(a.parent);location.hash=1;return false})}e&&e.click(function submitButtonClick(c){c.preventDefault();if(b._captcha!==d)b._captcha.GetResponse(function(){b.DoNextStep(b,a.parent,a.submitFunc);location.hash=1});else{b.DoNextStep(b,a.parent,a.submitFunc);location.hash=1}return false});$restartButton.click(function restartButtonClick(){window.location.href=makeLink("AnonymousTelehealth")});$afe.select(g).keyup("",function checkInput(a){a.keyCode===9});$afe.select("#ProxySignupDemographic_Form").keyup("",function checkInput(a){a.keyCode===9});if($afe.select("#token").val().length)if(e&&$$WPUtil.queryString("autosubmit")!=="0"){c._automaticallySubmitForm=true;c._submitButton=$afe.jq(e.get(1))}else WP.Events.beforeUnload();var j=$afe.select("#CAPTCHA");if(j.length>0){c._captcha=new $$WP.Captcha(j);c._captcha.Render()}};$$WPComp.SignupDemographicsForm.prototype={currentSignupOption:"",_token:null,_automaticallySubmitForm:false,_submitButton:null,_captcha:null,_addressFieldNames:["Zip","City","HouseNumber","State","Country","County","District","Building","Floor","Unit"],DoNextStep:function Epic$PatientAccess$Components$SignupDemographicsForm$DoNextStep(a,f,g){var c="hidden",d,b,e=0;$afe.select("#DirectSignupError").addClass(c);$afe.select("#BadToken").addClass(c);if(!this._automaticallySubmitForm&&!a.IsRequiredFieldsFilled(a)){b=this.$demoContainer.find(".alert").not(".hidden").parent().offset();if(typeof b!=="undefined"&&b!==null){e=b.top;$$WPUtil.setScrollTop(e)}return}this.$demoContainer.find(".alert").addClass(c);d=a.currentSignupOption;if(d==="1")a.SubmitReview(a,d,f._schedulingSession);else g(f)},ValidateDemographicsAndProceed:function Epic$PatientAccess$Components$SignupDemographicsForm$ValidateDemographics(c,f,i,h){var b=this,d,g,e,a;b._prepareAddressForSerialize();e=b.$form.serialize();b._restoreAddressFromSerialize();d="Method="+h+"&"+e;a=$afe.select("#token");if(b._automaticallySubmitForm)d=d+"&autosubmit=1";g=makeLink("signup/Standalone/SubmitActivationRequest");$.post(g,d,$.proxy(function validateDemog(g){var b=this,d;b.$demoContainer.find(".alert").addClass("hidden");d=b.$form;if(!g.Success){if(!a||a.val().length===0)b._captcha!==null&&b._captcha.Reset();else if(b._automaticallySubmitForm){d.find(":input").not(":button, :submit, :radio").not("input[type=hidden]").val("").removeAttr("data-val").safeAttr("value","");d.find(":input[type=radio]").removeAttr("checked");d.find("#token").val("");d.find("label").removeClass("selected").removeClass("focused")}c.ShowError(g)}else{a&&a.val().length&&!b._automaticallySubmitForm&&WP.Events.cancelBeforeUnload();g!==null&&c.Components$DemographicsForm$FormatData(c,g.PatientInfo);b._prepareAddressForSerialize();e=d.serialize();b._restoreAddressFromSerialize();c._token=g.Token;f._verificationToken=g.Token;d[0].reset();i(f,e)}},b))},ValidateProxyAndPatientDemographicsAndProceed:function Epic$PatientAccess$Components$SignupDemographicsForm$ValidateProxyAndPatientDemographicsAndProceed(a,b,e,d,c){this._prepareAddressForSerialize();patientForm=$afe.select("#SignupDemographic_Form").serialize();patientForm=patientForm.replace(/&Relationship=/i,"&Proxy.Relationship=");this._restoreAddressFromSerialize();proxyForm=$afe.select("#SignupProxyDemographic_Form").serialize();proxyForm=proxyForm.replace(/&Proxy/g,"&Proxy.");queryString="Method="+d+"&schedulingSession="+encodeURIComponent(c)+"&"+patientForm+"&"+proxyForm;url=makeLink("signup/Standalone/SubmitGuestCreate");b._currentStep=1;$.post(url,queryString,function validateProxyDemog(c){a.HandleSubmissionResult(a,c,b,e)})},ContinueSubmission:function Epic$PatientAccess$Components$SignupDemographicsForm$ContinueSubmission(a,b,e,f){var d,c;if(a._token.length===0)f(b);else{c="Method="+a.currentSignupOption+"&Token="+encodeURIComponent(a._token);d=makeLink("signup/Standalone/SubmitRequestByToken");$.post(d,c,function afterThirdPartyVerification(c){a.HandleSubmissionResult(a,c,b,e)})}},SubmitReview:function Epic$PatientAccess$Components$SignupDemographicsForm$SubmitReview(a,e,d){var b,c;this._prepareAddressForSerialize();b="Method="+e+"&"+this.$form.serialize()+"&schedulingSession="+encodeURIComponent(d);this._restoreAddressFromSerialize();c=makeLink("signup/Standalone/SubmitActivationRequest");$.post(c,b,function afterSubmitReview(b){a.HandleSubmissionResult(a,b,null,null)})},ShowMessageInLightBox:function Epic$PatientAccess$Components$SignupDemographicsForm$ShowMessageInLightBox(e,a){var c,d,b;c={};c.SupressTitle=true;c.IsClosable=false;b=new $$WP.Signup.Components.SignupPopupComponent(c);d={Message:e};b.setData(d);if(a!==undefined&&a!==""&&a!==null)a=a&" lb_content";else a="lb_content";$$WPUtil.quickPopup(b,{Class:a,Size:$$WPContain.Popup.SizeEnum.MEDIUM,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:false});b.ContainerComponent.setFocus()},ShowError:function Epic$PatientAccess$Components$SignupDemographicsForm$ShowError(m){var j="RECAPTCHA",i="inputHighlighted",c=this,n,g,f,b,d,a,l,e,k,h;c.$demoContainer=$afe.select("#Signup_demographics");c.$demoContainer.find(".alert").addClass("hidden");c.$demoContainer.find("input").removeClass(i);g=m.ErrorList;for(b in g){if(b===j&&c._captcha!==null)c._captcha.ShowError();else d="#"+b;a=$afe.select(d);if(a.length<1&&c._addressFieldNames.indexOf(b)>-1){d="#AddressInfo_"+b;a=$afe.select(d)}if(b.includes("NameInput"))$$WP.FormValidation.addValidationError(a,g[b]);else $$WP.FormValidation.addValidationError(a);k=a.safeAttr("data-name")||a.safeAttr("name");h=$afe.select('[data-message-display-for="'+k+'"]');h.removeClass("hidden");b!==j&&a.addClass(i)}l=$afe.select("[data-invalid-reason='[object Object]']").not(".hidden")[0].attributes["data-message-display-for"].nodeValue;e=c.$demoContainer.find("#"+l);f=e.offset();if(f&&f.top)$$WPUtil.setScrollTop(f.top);else $$WPUtil.setScrollTop(0);e&&e.focus()},IsRequiredFieldsFilled:function Epic$PatientAccess$Components$SignupDemographicsForm$IsRequiredFieldsFilled(a){var b;b=true;if(a)if(!a.Components$DemographicsForm$IsRequiredFieldsFilled(a))b=false;$afe.jq(window).trigger("matchColumnHeights");return b},HandleSubmissionResult:function Epic$PatientAccess$Components$SignupDemographicsForm$HandleSubmissionResult(i,a,c,e){var d=null,g=this,h,f,b;g.$demoContainer.find(".alert").addClass("hidden");if(!a.Success)if(!a.ErrorList||a.ErrorList.General){if(!a.ErrorList)f=$afe.select("#FailureMessage_NoMessage").html();else f=$afe.select("#FailureMessage_"+a.ErrorList.General).html();if(e!==d)e(c,f,"error");else i.ShowMessageInLightBox(f,"error")}else{g._captcha!==d&&g._captcha.Reset();i.ShowError(a);if(c!=d)if(a.ErrorList.ProxyValidation==1&&a.ErrorList.PatientValidation!=1)c.SwitchToStep(c,1);else c.SwitchToStep(c,0);$afe.select(".helptip").removeClass("hidden")}else if(a.JumpUrl)window.location.href=a.JumpUrl;else{g.$form[0].reset();if(a.SignupToken.length===0){h=$afe.select("#SuccessMessage_"+a.SuccessCode).html();if(e!==d)e(c,h,"");else i.ShowMessageInLightBox(h,"")}else{b="accesscheck.asp";b=b+"?Client="+encodeURIComponent(a.ClientID)+"&InfoID="+encodeURIComponent(a.SignupToken)+"&SelfSignup=1";if(window.location.search.substring(1).length>0)b=b+"&"+window.location.search.substring(1);b=makeLink(b);window.location.href=b}}},_prepareAddressForSerialize:function Epic$PatientAccess$Components$SignupDemographicsForm$_prepareAddressForSerialize(){var a="name";$afe.select("#AddressInfo_Street").safeAttr(a,"AddressInfo.Street");$afe.select("#AddressInfo_Zip").safeAttr(a,"AddressInfo.Zip");$afe.select("#AddressInfo_City").safeAttr(a,"AddressInfo.City");$afe.select("#AddressInfo_State").safeAttr(a,"AddressInfo.State.Number");$afe.select("#AddressInfo_Country").safeAttr(a,"AddressInfo.Country.Number");$afe.select("#AddressInfo_County").safeAttr(a,"AddressInfo.County.Number");$afe.select("#AddressInfo_District").safeAttr(a,"AddressInfo.District.Number");$afe.select("#AddressInfo_HouseNumber").safeAttr(a,"AddressInfo.HouseNumber");$afe.select("#AddressInfo_Building").safeAttr(a,"AddressInfo.Building");$afe.select("#AddressInfo_Floor").safeAttr(a,"AddressInfo.Floor");$afe.select("#AddressInfo_Unit").safeAttr(a,"AddressInfo.Unit")},_restoreAddressFromSerialize:function Epic$PatientAccess$Components$SignupDemographicsForm$_restoreAddressFromSerialize(){var a="name";$afe.select("#AddressInfo_Street").safeAttr(a,"AddressInfo_Street");$afe.select("#AddressInfo_Zip").safeAttr(a,"AddressInfo_Zip");$afe.select("#AddressInfo_City").safeAttr(a,"AddressInfo_City");$afe.select("#AddressInfo_State").safeAttr(a,"AddressInfo_State");$afe.select("#AddressInfo_Country").safeAttr(a,"AddressInfo_Country");$afe.select("#AddressInfo_County").safeAttr(a,"AddressInfo_County");$afe.select("#AddressInfo_District").safeAttr(a,"AddressInfo_District");$afe.select("#AddressInfo_HouseNumber").safeAttr(a,"AddressInfo_HouseNumber");$afe.select("#AddressInfo_Building").safeAttr(a,"AddressInfo_Building");$afe.select("#AddressInfo_Floor").safeAttr(a,"AddressInfo_Floor");$afe.select("#AddressInfo_Unit").safeAttr(a,"AddressInfo_Unit")}};$$WPComp.SignupDemographicsForm.extend("Components.DemographicsForm");function Epic$PatientAccess$Components$SignupDemographicsForm$ClearCaptchaErrors(){var a="hidden";$afe.select("#RECAPTCHA_RECAPTCHA-NOT-REACHABLE").addClass(a);$afe.select("#RECAPTCHA_CAPTCHA-BLANK").addClass(a);$afe.select("#RECAPTCHA_CAPTCHA-INVALID").addClass(a)}