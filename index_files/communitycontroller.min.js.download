(function WP$Community$Controller$definition(){var S="#proxyConsentAlert",gb="'] .orgBottomRow",fb="[data-org-bottom-id='",zb="'] .fullyLinked",yb="[data-org-top-id='",xb="#ceSpotlight",wb="#orgsLinked",K="div#community_container",U="div#loading",vb='div.formcontents input[type="button"]',ub="#orgsLinked>[data-id='",n="ActivityIconImageTitles",m="images/",o="ActivityIconTitles",p="Community.Manage",tb="otherbutton",R="Community.FHIRUpdate",sb=".skeleton",eb="tab_topic_linked",rb="inside.asp",J="url",T="span#redirectURL",l="Community.OrganizationList",qb="#oAuthUnLink",I="from",db="contentpopup noOverflow",pb="Community/Shared/DeclineOrganizationConsent",ob="UnlinkingMessage",G="true",F="aria-disabled",B="disabled",Q=".ajaxspinner",nb="#communityPopupLoading",k="#alertSpan",cb="empty",bb="value",mb="#OrgIdHiddenSpan",A="resize",lb="#challengeQuestions",kb="input change focusout",P="#AnswerField",O="blur change",N="#ChallengeQuestion",M="#verifyAnswer",ab="transitionend transitionEnd",E=".loadingExt",s="loaded",L=".loadingContainer",Z="CEbigloading",jb=".loadingExt ",Y="popupResize",c="hidden",x="#externalLoadingIndicator",D=".loadingStatus",i="Community.Shared",w="ConnectingMessage",ib="no organization ID found",r="id",X="#searchResultsPoliteRegion",b=true,j="json",g="POST",W="close",v="loading",C=".organizationSearchIcon",q="1",z="showDXROrgInMO",a=false,e="",f=null,t="#orgSearch",hb="#show_consent",V="input.fhir-update",d="click",h={Login:1,Manage:2,Allergies:3,HealthIssues:4,Medications:5,PastVisits:6,TestResults:7,UpdateOrg:8,HealthSummary:9},H={Home:0,MyChart:1,Fhir:2,Dxr:3},u={Link:1,Unlink:2,NotMe:3,Signup:4,LinkFHIRFirstTime:5,LinkFHIRAgain:6,UnlinkFHIR:7,Jump:8},Bb={NotHidden:0,UserDismissed:1,NoClinicalData:2},Cb={CeOptOut:1},y={CE:"CE",LinkedOrg:"LinkedOrg",FHIR:"FHIR",UnknownEpic:"UnknownEpic"},Ab=function WP$Community$CommunityController(j,c,g,i,f,e){var a=this,b;a.WP$Controllers$Controller();a.proxify("_successGetOrganizationList","_errorGetOrganizationList","_getOrganizationList","clickLink","_loadConfirm","clickChildOrgs","clickUnlink","clickLoginBottomButtons","clickSignup","clickJump","clickVerifyAnswer","clickNotMe","clickCancel","_successVerifyAccount","showSuccessAndDisposePopup","disposePopup","clickUpdateFHIR","clickConfirmUpdateFHIR","clickLinkFHIR","connectFHIR","_successGetFhirRedirectUrl","clickUnlinkFHIR","clickConfirmUnlinkFHIR","continueFHIRQueryString","_createFHIRUpdatePopup","_getRefreshStatus","_handleLoadStatus","_getUpdateStatusDisplayModel","_getFeatureDisplayModel","_successUpdateFHIRAccount","_forceStopFhirLoadStatus","_disposeFhirUpdatePopup","_renderFhirOrgPopup","_renderFhirOrgPage","_getDXRLinkedOrganizations","_filterDXRLinkedOrganizations","sortDXROrg","_updateAnotherOrganization","_getCurrentLoadingOrgList","_successGetCurrentLoadingOrgList","_replaceLoadingText","_updateDxrOrgModels","giveConsent","_errorGiveConsent","_successGiveConsent","clickConsentLink","autoQuery","_errorAutoQuery","_successAutoQuery","_completeUpdate","_completeUnlink","_displayError","_displayErrorPopup","_successClickConnectEpic","_successGetChildrenOrganizations","renderChildOrgList","CreateLinkToOrganization","organizationSearchOnInput","_displayAndHighlightSearchResults","_organizationSearchSuccessOrError","_renderKnownOrganizations","_renderNearbyOrganizations","_renderLinkedOrganizations","_renderManagePageContent","_renderLoginPageContent","_renderStaticManagePageContent","_tryRenderManagePageContent","_buildActivityIconModel","_getKnownCEOrganizations","_getLinkedOrganizations","_filterLinkedOrganizations","_hasNonDXRLinkedOrganization","_getAutoQueryCount","_displayLoadingPopup","removeQueryStringFromBrowser","closeWebView","handleMobileBackButton","clickConnectEpic","continueCELinking","_successContinueCELinking","_errorContinueCELinking","toLinkedTab","toDiscoverTab","dismissOrganization","_dismissOrganizationCallback","_successDismissOrg");if(c)a._isIntegrated=c;else{switch(j){case"Login":a._Mode=h.Login;a._renderLoginPageContent();break;case"Manage":a._Mode=h.Manage;a._isProxyContext=g;a._isPICELDisabled=e;a._subjectName=i;a._removeHyperlink=f;a._renderStaticManagePageContent();break;case"Allergies":a._Mode=h.Allergies;break;case"HealthIssues":a._Mode=h.HealthIssues;break;case"Medications":a._Mode=h.Medications;break;case"PastVisits":a._Mode=h.PastVisits;break;case"TestResults":a._Mode=h.TestResults;break;case"UpdateOrg":a._Mode=h.UpdateOrg;break;case"HealthSummary":a._Mode=h.HealthSummary}if(a._Mode!==h.Login){a._getOrganizationList();a._linkedFhirOrgId=decodeURIComponent($$WPUtil.queryString("linkedFhirOrgId"));a._userClickedOrgId=a._linkedFhirOrgId}if(a._Mode===h.Login||a._Mode===h.Manage){b=$afe.select("#community_container");b.on(d,"input.org-link",a.clickLink);b.on(d,"a.childorg-link",a.clickChildOrgs);b.on(d,"input.org-unlink",a.clickUnlink);b.on(d,"input.fhir-unlink",a.clickUnlinkFHIR);b.on(d,V,a.clickUpdateFHIR);b.on(d,".org-signup.button",a.clickSignup);b.on(d,".org-jump.button",a.clickJump);b.on(d,"#consent_button",a.giveConsent);b.on(d,hb,a.clickConsentLink);b.on(d,"#continueButton",a.clickLoginBottomButtons);b.on(d,"#goToManageButton",a.clickLoginBottomButtons);b.on("input",t,a.organizationSearchOnInput);b.on(d,".connectFHIR",a.clickLinkFHIR);b.on(d,".connectKnownEpic",a.clickConnectEpic);b.on(d,".connectUnknownEpic",a.clickConnectEpic);b.on(d,"#clear-search-button",a.clearCurrentSearch);b.on(d,"#toLinked",a.toLinkedTab);b.on(d,"#toDiscover",a.toDiscoverTab);b.on("touchend",t,a.scrollToSearchForMobile);b.on("touchstart",a.unFocusSearchInput);b.on(d,".dismiss",a.dismissOrganization)}if(a._Mode!==h.Login&&a._Mode!==h.Manage&&a._Mode!==h.UpdateOrg){b=$afe.select(".RefreshBannerSection");b.on(d,".RefreshBannerButton",a._getCurrentLoadingOrgList)}}},Db={_Mode:0,_popupComponent:f,_userClickedOrgId:e,_userClickedOrgName:e,_linkedFhirOrgId:f,_userClickedAction:0,_orgListObj:f,_autoQueryListObj:f,_spotlightOrganizations:f,_callback:f,_isIntegrated:a,_isConsentNeeded:a,_searchQueryMostRecentRequest:0,_searchQueryLastDisplayedRequest:0,_searchQuery:e,_mostRecentSearchResults:f,_isFhirUpdatePopupShowing:a,_wasFhirUpdatePopupClosed:a,_fhirUpdateComplete:a,_ceOptOut:a,_isProxyContext:a,_subjectName:e,_userCanSearch:a,clickChildOrgs:function WP$Community$CommunityController$clickChildOrgs(c){var b;if(!c)return;var a=$afe.jq(c.currentTarget);b=a.data("orgid");this._userClickedOrgId=a.data("parentorgid");this._userClickedOrgName=a.data("orgname");this.getChildrenOrganizationList(b)},organizationSearchOnInput:function WP$Community$CommunityController$organizationSearchOnInput(h){var c=this,e,d=h.target.value;if(c._searchQuery===d)return;e=$$WPUtil.queryString(z)===q;c._searchQueryMostRecentRequest++;c._searchQuery=d;if(d.length>0){$afe.select(C).addClass(v);$afe.select(C).removeClass(W);$.ajax({url:makeLink("Community/Shared/SearchOrganizations"),type:g,cache:a,data:{query:d,showDXROrgInMO:e},dataType:j,error:c._organizationSearchSuccessOrError.bind(c,c._searchQueryMostRecentRequest,{error:b}),success:c._organizationSearchSuccessOrError.bind(c,c._searchQueryMostRecentRequest)})}else c._organizationSearchSuccessOrError(c._searchQueryMostRecentRequest,f)},_organizationSearchSuccessOrError:function WP$Community$CommunityController$_organizationSearchSuccessOrError(b,c){var a=this;a._mostRecentSearchResults=c;if(b<a._searchQueryLastDisplayedRequest)return;a._searchQueryLastDisplayedRequest=b;if(b===a._searchQueryMostRecentRequest){$afe.select(C).removeClass(v);if(a._searchQuery)$afe.select(C).addClass(W);else $afe.select(C).removeClass(W);$afe.select(X).empty();c&&$afe.select(X).safeAppend($afe.renderTemplate($$WP.Templates.Community.OrganizationSearchResultsPoliteRegion,c))}a._displayAndHighlightSearchResults()},_displayAndHighlightSearchResults:function WP$Community$CommunityController$_displayAndHighlightSearchResults(){var h="#spotlight",f="#searchResultsNormalRegion",e=this,j=e._searchQuery,g=e._mostRecentSearchResults,c,d,i;if(g){if(!g.error)for(i=0;i<g.Results.length;i++){c=g.Results[i];if(c.EpicStatus){c.Type=y.UnknownEpic;c.ShowCEOptOutErrorMsg=e._ceOptOut}else c.Type=y.FHIR;if(e._orgListObj[c.OrganizationId]){d=e._orgListObj[c.OrganizationId];if(e._orgListObj[c.OrganizationId].Accept){c.Type=y.LinkedOrg;c.ShowCEOptOutErrorMsg=a}else if(e._orgListObj[c.OrganizationId].LinkType===H.MyChart&&!d.CanCreateCELink){c.Type=y.CE;c.HasChildOrgs=d.HasChildOrgs;c.CELocationId=c.ChildId;c.LinkType=d.LinkType;c.LastEncounterDetail=d.LastEncounterDetail;c.IsDisabled=d.IsDisabled;c.TermsAndConditionsUrl=d.TermsAndConditionsUrl;c.ProxyTermsAndConditionsUrl=d.ProxyTermsAndConditionsUrl;c.FromSearch=b;c.ShowCEOptOutErrorMsg=a;if(d.RelatedOrganizations&&d.RelatedOrganizations.ChildrenOrganaizationList){c.RelatedOrganizations={};c.RelatedOrganizations.ChildrenOrganaizationList=[{OrganizationName:d.OrganizationName,LogoUrl:d.LogoUrl}].concat(d.RelatedOrganizations.ChildrenOrganaizationList);c.RelatedOrganizations.ChildrenOrganaizationList=c.RelatedOrganizations.ChildrenOrganaizationList.filter(e._hasDifferentName.bind(e,c))}}}c.uniqueId=e._getUniqueNumber()}$afe.select(f).empty();$afe.select(f).safeAppend($afe.renderTemplate($$WP.Templates.Community.OrganizationSearchResults,g));$afe.select(h).hide();e._highlightSearchResults(j)}else{$afe.select(h).show();$afe.select(X).empty();$afe.select(f).empty()}},_hasDifferentName:function WP$Community$CommunityController$_hasDifferentName(a,b){return a.OrganizationName!==b.OrganizationName},_highlightSearchResults:function WP$Community$CommunityController$_highlightSearchResults(c){var a=this._removeDiacritics,b=a(c).toLowerCase().split(/\W+/g).filter(function(a){return a.length});$afe.select("#searchResults .organizationName, #searchResults .popupOrganizationChildName, #searchResults .popupOrganizationLocation").each(function(m,h){for(var g=h.innerText,l=a(g).toLowerCase(),d=[],j,f,i,k,c=0;c<b.length;c++){j=b[c];f=l.indexOf(j);while(f!==-1){d.push({start:f,end:f+j.length});f=l.indexOf(j,f+1)}}d.sort(function(a,b){return a.start-b.start});c=0;while(c<d.length-1)if(d[c+1].start<=d[c].end){d[c].end=Math.max(d[c].end,d[c+1].end);d.splice(c+1,1)}else c++;if(d.length>0){h.innerHTML=e;h.appendChild(document.createTextNode(g.substring(0,d[0].start)));for(c=0;c<d.length;c++){i=document.createElement("span");i.className="hilite";i.innerText=g.substring(d[c].start,d[c].end);h.appendChild(i);k=c<d.length-1?d[c+1].start:g.length;h.appendChild(document.createTextNode(g.substring(d[c].end,k)))}}})},_removeDiacritics:function WP$Community$CommunityController$_removeDiacritics(a){return typeof a.normalize==="function"?a.normalize("NFD").replace(/[\u0300-\u036f]/g,e):a},clickLink:function WP$Community$CommunityController$clickLink(b){var a=$afe.jq(b.target).data(r);if(a)this.CreateLinkToOrganization(a);else $$WP.Debug.logError(ib)},CreateLinkToOrganization:function(c,f,e,d){var b=this;b._callback={Success:f,Failure:e,NotMyAccount:d};b._userClickedOrgId=c;b._userClickedAction=u.Link;b._displayLoadingPopup($$WP.Strings.get(w,i));$.ajax({url:makeLink("Community/Shared/AcceptOrganizationConsent"),type:g,cache:a,data:{organizationId:c,controllerType:b._Mode,isIntegrated:b._isIntegrated},dataType:j,error:b._displayError,success:b._loadConfirm})},_loadConfirm:function Epic$PatientAccess$Controllers$CommunityController$_loadConfirm(d){var a=this,e,g;if(d.Success){if(d.OrgLink!==undefined&&d.OrgLink!==f)if(!a._isIntegrated){a._orgListObj[a._userClickedOrgId]=d.OrgLink;a._orgListObj[a._userClickedOrgId].IsLast=a._userClickedOrgId===a.getLastOrganizationId()}if(d.Data!==undefined&&d.Data!==f){e=d.Data.ValidationData.Questions;g={Questions:e,Organization:d.Data.Organization};$afe.select(D).text($$WP.Strings.get(w,i));$afe.select(x).removeClass(c);$afe.jq(window).trigger(Y);$afe.select(jb).addClass(Z);$afe.select(L).addClass(s);$afe.select(E).removeClass(v).addClass(s).on(ab,$.proxy(a.showChallengeQuestionContent,a,g))}else a._completeUpdate({Success:b,OrgLink:d.OrgLink})}else a._displayError()},showChallengeQuestionContent:function Epic$PatientAccess$Controllers$CommunityController$_showChallengeQuestionContent(h){var e=this,j,f,g;$afe.select(x).addClass(c);e.disposePopup(a);j=new $$WP.Community.Components.CommunityPopupComponent({IsClosable:b,SupressTitle:a,TitleText:$$WP.Strings.get("ChallengeQuestionPopupTitle",i)});e._popupComponent=j;$$WPUtil.quickPopup(j,{Size:$$WPContain.Popup.SizeEnum.MEDIUM,Class:"contentpopup",positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:a});e._popupComponent.setData(h);$afe.select(M).on(d,e.clickVerifyAnswer);$afe.select("#notMe").on(d,e.clickNotMe);$afe.select("#cancelVerify").on(d,e.clickCancel);f=$afe.select(N);if(h&&h.Questions&&h.Questions.length>1){f.on("focus",$$WP.Utilities.UI.FocusGhostableInput);f.on(O,$$WP.Utilities.UI.BlurGhostableInput)}f.on(O,e.enableOrDisableVerifyButton);g=$afe.select(P);g.on("focus",$$WP.Utilities.UI.FocusGhostableInput);g.on(O,$$WP.Utilities.UI.BlurGhostableInput);g.on(kb,e.enableOrDisableVerifyButton);$afe.select(lb).removeClass(c);e._popupComponent.ContainerComponent.setFocus();e._popupComponent.$container.trigger(A)},clickVerifyAnswer:function WP$Community$CommunityController$clickVerifyAnswer(l){var f,h,b,d;if(!l)return;f=$afe.select(mb);h=f.safeAttr(bb);b=$afe.select(N).val();d=$afe.select(P).val();if(b===cb&&d===e){$afe.select(k).text($$WP.Strings.get("NoQuestionAnswer",i));$afe.select(k).removeClass(c)}else if(b===cb){$afe.select(k).text($$WP.Strings.get("NoQuestion",i));$afe.select(k).removeClass(c)}else if(d===e){$afe.select(k).text($$WP.Strings.get("NoAnswer",i));$afe.select(k).removeClass(c)}else{$afe.select(k).addClass(c);$$WPUtil.ShowAjaxSpinner($afe.select(nb).find(Q));$.ajax({url:makeLink("Community/Shared/ConfirmOrganizationLink"),type:g,cache:a,data:{organizationId:h,identifier:b,answer:d,controllerType:this._Mode},dataType:j,error:this._displayErrorPopup,success:this._successVerifyAccount})}},_successVerifyAccount:function Epic$PatientAccess$Controllers$CommunityController$_successVerifyAccount(e){var d=this,f;$$WPUtil.HideAjaxSpinner($afe.select("#communityPopupLoading .ajaxspinner"));if(e.Success){if(!d._isIntegrated){d._orgListObj[d._userClickedOrgId]=e.OrgLink;d._orgListObj[d._userClickedOrgId].IsLast=d._userClickedOrgId===d.getLastOrganizationId()}if(e.Disabled)if(d._isIntegrated)d._displayErrorPopup();else{$afe.select(k).text($$WP.Strings.get("MaxAttemptHit",i));$afe.select(k).removeClass(c);$afe.select(k).focus();$afe.select(M).prop(B,b).safeAttr(F,G);f=d._orgListObj[d._userClickedOrgId];f.IsDisabled=b;d._renderSingleCEOrgBottom(f);$afe.select(N).off(O,d.enableOrDisableVerifyButton);$afe.select(P).off(kb,d.enableOrDisableVerifyButton)}else if(e.AnswerIsCorrect){$afe.select(k).addClass(c);d.disposePopup(a);d._displayLoadingPopup($$WP.Strings.get(w,i));d._completeUpdate({Success:b,OrgLink:e.OrgLink})}else{$afe.select(k).text($$WP.Strings.get("IncorrectAnswer",i));$afe.select(k).removeClass(c);$afe.select(k).focus()}}else d._displayErrorPopup()},clickNotMe:function WP$Community$CommunityController$clickNotMe(d){var b,c;if(!d)return;this._userClickedAction=u.NotMe;b=$afe.select(mb);c=b.safeAttr(bb);$$WPUtil.ShowAjaxSpinner($afe.select(nb).find(Q));$.ajax({url:makeLink("Community/Shared/InvalidateOrganizationLink"),type:g,cache:a,data:{organizationId:c},dataType:j,error:this._displayErrorPopup,success:this._completeUpdate})},clickCancel:function WP$Community$CommunityController$clickCancel(b){if(!b)return;this._callback=f;this.disposePopup(a)},clickUnlink:function WP$Community$CommunityController$clickUnlink(d){var b=this,c=$afe.jq(d.target).data(r);if(c){b._userClickedOrgId=c;b._userClickedAction=u.Unlink;b._displayLoadingPopup($$WP.Strings.get(ob,i));$.ajax({url:makeLink(pb),type:g,cache:a,data:{organizationId:c},dataType:j,error:b._displayError,success:b._completeUnlink})}else $$WP.Debug.logError(ib)},clickUpdateFHIR:function clickUpdateFHIR(g){var e=this,l,j,m,k,f;if(g&&g.target){l=$afe.jq(g.target);j=l.data(r);m={Organization:e._orgListObj[j],IsUpdate:b};e._userClickedAction=u.LinkFHIRAgain;e._userClickedOrgId=j;if(e._Mode!==h.Login&&e._Mode!==h.Manage){e.clickConfirmUpdateFHIR(g);return}k={SupressTitle:a,IsClosable:b,TitleText:$$WP.Strings.get("UpdateFHIRAccountTitle",i)};f=new $$WP.Community.Components.CommunityPopupComponent(k);e._popupComponent=f;$$WPUtil.quickPopup(f,{Size:$$WPContain.Popup.SizeEnum.MEDIUM,Class:db,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:a});e._popupComponent.setData(m);$afe.select("#oAuthDescription").removeClass(c);$afe.select("#connectFHIR").on(d,e.clickConfirmUpdateFHIR);$afe.select("#cancelFHIR").on(d,e.clickCancel);e._popupComponent.$container.trigger(A);f.ContainerComponent.setFocus()}},clickConfirmUpdateFHIR:function clickConfirmUpdateFHIR(e){var c=this,d;if(e&&e.target){c.disposePopup(a);d=c._orgListObj[c._userClickedOrgId].OrganizationId;c.connectFHIR(d,b)}},clickLinkFHIR:function clickLinkFHIR(b){var c;if(b&&b.target){c=b.target.dataset.id;this.connectFHIR(c,a)}},connectFHIR:function connectFHIR(e,d){var b=this,c;this._displayLoadingPopup($$WP.Strings.get(w,i));c=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(z)===q;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/Shared/AcceptFHIRConsent"),type:g,cache:a,data:{encryptedOrgId:e,controllerType:b._Mode,showDXR:c,fromActivity:$$WPUtil.queryString(I),isUpdate:d},dataType:j,error:b._displayError,success:b._successGetFhirRedirectUrl})})},_successGetFhirRedirectUrl:function Epic$PatientAccess$Controllers$CommunityController$_successGetFhirRedirectUrl(a){if(a.Success)window.top.location=a.RedirectURL;else this._displayError()},clickUnlinkFHIR:function WP$Community$CommunityController$clickUnlinkFHIR(j){var e=this,f,g,h,k;if(!j)return;h=$afe.jq(j.target).data(r);e._userClickedOrgId=h;e._userClickedAction=u.UnlinkFHIR;f={};f.SupressTitle=a;f.IsClosable=b;f.TitleText=$$WP.Strings.get("UnlinkFHIRAccountTitle",i);g=new $$WP.Community.Components.CommunityPopupComponent(f);e._popupComponent=g;$$WPUtil.quickPopup(g,{Size:$$WPContain.Popup.SizeEnum.MEDIUM,Class:db,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:a});k={Organization:e._orgListObj[h]};e._popupComponent.setData(k);$afe.select(qb).removeClass(c);$afe.select("#unlinkFHIR").on(d,e.clickConfirmUnlinkFHIR);$afe.select("#cancelFHIRAgain").on(d,e.clickCancel);e._popupComponent.$container.trigger(A);g.ContainerComponent.setFocus()},clickConfirmUnlinkFHIR:function WP$Community$CommunityController$clickConfirmUnlinkFHIR(d){var b=this;if(!d)return;if(b._popupComponent!==f){$afe.select(qb).addClass(c);$afe.select(D).text($$WP.Strings.get(ob,i));$afe.select(jb).addClass(Z);$afe.select(x).removeClass(c)}$$WP.CommunityUtilities.clearCommunityLinksSessionStatus();$.ajax({url:makeLink(pb),type:g,cache:a,data:{organizationId:b._userClickedOrgId},dataType:j,error:b._displayError,success:b._completeUnlink})},dismissOrganization:function WP$Community$CommunityController$dismissOrganization(i){var b="@MYCHART@ORGANIZATIONNAME@",d=$afe.jq(i.target).data(r);$$WP.Strings.addMnemonic(b,this._orgListObj[d].OrganizationName,e,l);var g=$$WP.Strings.get("ConfirmDismissOrg",l),c=$$WP.Strings.get("ConfirmDismissHeader",l);$$WP.Strings.removeMnemonic(b,l);var h=[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("ConfirmDismissButton",l),f,"inlinedelete","ok"),new $$WPComp.ComplexObjects.Button($$WP.Strings.get("PopupGoBackButton",l),f,"continue secondary","cancel")];c=HTMLUnencode(c);$$WPUtil.quickMessageBox(g,c,h,this._dismissOrganizationCallback,[d],f,a)},_dismissOrganizationCallback:function WP$Community$CommunityController$dismissOrganizationCallback(c,b){if(b!=="toolbarok")return;$.ajax({url:makeLink("Community/Shared/DismissOrganization"),type:g,cache:a,data:{encryptedOrgId:c},dataType:j,error:this._displayErrorPopup,success:this._successDismissOrg})},_successDismissOrg:function WP$Community$CommunityController$_successDismissOrg(a){if(a.Success===b){this._orgListObj[a.OrgID]=a.OrgLink;this.renderOrganizationList()}else this._displayErrorPopup()},clickLoginBottomButtons:function WP$Community$CommunityController$clickUnlink(b){var f,d,c,e;if(b&&b.target){f=$afe.jq(b.target).safeAttr(r);d=f==="goToManageButton";c=$afe.select("#dontShowAgain");e=c.prop("checked");$.ajax({url:makeLink("Community/Login/FinishOrganizationLinking"),type:g,cache:a,data:{askLater:!e,goToManagePage:d},dataType:j,error:this._handleLoginAjaxResponse,success:this._handleLoginAjaxResponse})}},_handleLoginAjaxResponse:function WP$Community$CommunityController$_handleLoginAjaxResponse(b){var a;if(b&&b.redirectURL)a=b.redirectURL;else if($afe.select(T).data(J))a=$afe.select(T).data(J);else a=makeLink(rb);if($$WP.Utilities.UI.IsMobile){if(a.indexOf("?")===-1)a+="?nextstep=false";else a+="&nextstep=false";if(b&&!b.goToManagePage)a+="&moworkflow=completeandclose"}$$WP.Utilities.TryRedirect(a)},clickSignup:function WP$Community$CommunityController$clickSignup(g){var c=this,d,a;if(!g)return;d=$afe.jq(g.target).data(r);c._userClickedOrgId=d;c._userClickedAction=u.Signup;a=c._orgListObj[d];if(a.IncompleteH2GSetup||$$WP.Utilities.UI.IsMobile||WP.DOM.Browser.isMobile)$$WP.CommunityUtilities.ShowSignUpNotAllowedMessage(a);else{c.addLinkedTabToQueryParams();$$WP.CommunityUtilities.openDeepLink(e,a,{},$$WP.CommunityUtilities.openDeepLinkType.InPopup,f,f,e,b)}},clickJump:function WP$Community$CommunityController$clickSignup(c){var b,a;if(!c)return;b=$afe.jq(c.target).data(r);this._userClickedOrgId=b;this._userClickedAction=u.Jump;a=this._orgListObj[b];!a.IncompleteH2GSetup&&a.UserMyChartStatus==1&&$$WP.CommunityUtilities.openDeepLink(e,a,{},$$WP.CommunityUtilities.openDeepLinkType.InNewTab)},addLinkedTabToQueryParams:function(){var a;if($$WPUtil.queryString("tab")!=="linked"&&window.history!==undefined&&window.history.replaceState!==undefined){a=window.location.search;if(a.indexOf("?")!==-1)window.history.replaceState({},document.title,a+"&tab=linked");else window.history.replaceState({},document.title,a+"?tab=linked")}$$WPUtil.parseQueryString(window.location.search)},clickConnectEpic:function WP$Community$CommunityController$clickConnectEpic(b){var c=this,d,h=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(z)===q,f;if(!b||!b.currentTarget||!b.currentTarget.dataset){c._displayErrorPopup();return}if(b.currentTarget.dataset.id&&b.currentTarget.dataset.id!==e){d=b.currentTarget.dataset.child;if(d===e)d=b.currentTarget.dataset.id;f=b.currentTarget.dataset.orgname;c._displayLoadingPopup($$WP.Strings.get(w,i));$.ajax({url:makeLink("Community/Shared/InitiateCELink"),type:g,cache:a,data:{externalOrgID:d,showDXR:h,externalOrgName:f},dataType:j,error:c._displayError,success:c._successClickConnectEpic})}else c._displayErrorPopup()},_successClickConnectEpic:function Epic$PatientAccess$Controllers$CommunityController$_successClickConnectEpic(a){var d,e,f,c;if(a.Success===b){this.disposePopup();d=a.RedirectURL;e=a.Token;f=a.LocalHSI;c=d+"home/logout?postloginmode=linkauth&token="+e+"&hsi="+f;window.top.location=makeLink(c)}else this._displayError()},continueCELinking:function Epic$PatientAccess$Controllers$CommunityController$continueCELinking(){var f=this,c,d;c=$$WPUtil.queryString("token1");d=$$WPUtil.queryString("token2");if(c===e||d===e)f._errorContinueCELinking(b);else{c=decodeURIComponent(c);d=decodeURIComponent(d);f._displayLoadingPopup($$WP.Strings.get(w,i));$.ajax({url:makeLink("Community/Manage/AutoLinkH2G"),type:g,cache:a,data:{token1:c,token2:d},dataType:j,error:f._errorContinueCELinking,success:f._successContinueCELinking})}},_successContinueCELinking:function WP$Community$CommunityController$_successContinueCELinking(c){var a=this;if(c===f||!c.Success)a._errorContinueCELinking(e,c);else{a.removeQueryStringFromBrowser();a.showSuccessAndDisposePopup();a._userClickedOrgId=c.OrgID;a._orgListObj[a._userClickedOrgId]=c.OrgLink;c.OrgLink.successLinked=b;a.renderOrganizationList();showTabbedSection(eb)}},_errorContinueCELinking:function WP$Community$CommunityController$_errorContinueCELinking(c,a){this.removeQueryStringFromBrowser();if(c===b)this._displayErrorPopup(a);else this._displayError(a)},autoQuery:function WP$Community$CommunityController$autoQuery(b){var c;c=this;b!==undefined&&b!==e&&b!==f&&$.ajax({url:makeLink("Community/Shared/GetUpdatedCommunityLink"),type:g,cache:a,data:{controllerType:c._Mode,organizationId:b},dataType:j,error:c._errorAutoQuery.bind(this,b),success:c._successAutoQuery.bind(this,b)})},_errorAutoQuery:function WP$Community$CommunityController$_errorAutoQuery(a){$afe.select(sb).first().remove();delete this._autoQueryListObj[a]},_successAutoQuery:function WP$Community$CommunityController$_successAutoQuery(e,d){var c=this,a;if(d.Success){a=d.OrgLink;a.uniqueId=c._getUniqueNumber();a.StartExpanded=b;if(a.CanCreateCELink)a.Type=y.UnknownEpic;else a.Type=y.CE;c._orgListObj[a.OrganizationId]=a;delete c._autoQueryListObj[a.OrganizationId];if(c._getKnownCEOrganizations().length===1)c._renderKnownOrganizations();else $afe.select(sb).first().replaceWith($afe.renderTemplate($$WP.Templates.Community.DiscoverableOrganizationTop,a))}else c._errorAutoQuery(e)},_successCallback:function(b){var a=this;a._callback&&a._callback.Success&&a._callback.Success(b);a._callback=f},_failureCallback:function(){var a=this;a._callback&&a._callback.Failure&&a._callback.Failure();a._callback=f},_notMyAccountCallback:function(){var a=this;a._callback&&a._callback.NotMyAccount&&a._callback.NotMyAccount();a._callback=f},continueFHIRQueryString:function continueFHIRQueryString(){var c=this,d=c,e,f;f=$$WPUtil.queryString("error")===q;if(f){c._displayErrorPopup();return}e=$$WPUtil.queryString("fhirupdated")===G;if(c._linkedFhirOrgId&&!e){c._displayLoadingPopup($$WP.Strings.get(w,i),$$WP.Strings.get("PopupTitle",R),b);c.addNewQueryString("fhirupdated=true");getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/Shared/UpdateFHIROrganization"),type:g,cache:a,data:{organizationId:d._linkedFhirOrgId},dataType:j,error:d._forceStopFhirLoadStatus,success:d._successUpdateFHIRAccount})});c._getRefreshStatus()}},_getRefreshStatus:function WP$Community$CommunityController$_getRefreshStatus(){var b=this;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Loading/GetFhirLoadStatus"),type:g,cache:a,data:{orgId:b._linkedFhirOrgId},dataType:j,error:b._disposeFhirUpdatePopup,success:b._handleLoadStatus})})},_handleLoadStatus:function WP$Community$CommunityController$_handleLoadStatus(k){var j="#finished_",i="#loading_",g=this,d,l,f,m=e,n=a;if(g._wasFhirUpdatePopupClosed)return;if(!k||!k.Success||!k.status){g._disposeFhirUpdatePopup();return}d=k.status;if(!d.IsDXROrg)return;if(d.LoadInProgress||d.IsFinished){!g._isFhirUpdatePopupShowing&&g._createFHIRUpdatePopup(d);if(!d.IsFinished)m=d.FeaturesToLoad[d.FeaturesToLoad.length-1];for(l in d.FeaturesLoaded){f=d.FeaturesLoaded[l];if(f!==m){$afe.select(i+f).addClass(c);$afe.select(j+f).removeClass(c);$afe.select("#success_"+f).removeClass(c)}}for(l in d.FeaturesWithErrors){n=b;f=d.FeaturesWithErrors[l];if(f!==m){$afe.select(i+f).addClass(c);$afe.select(j+f).removeClass(c);$afe.select("#error_"+f).removeClass(c);$afe.select("#errorMessage_"+f).removeClass(c)}}}if(d.IsFinished){g._fhirUpdateComplete=b;$afe.select("#loadingDisclaimer").addClass(c);$afe.select("#updateLoadingTitle").addClass(c);$afe.select("#updateCompleteTitle").removeClass(c);$afe.select("#completeAnimationGif").safeAttr("src",makeStaticLink("images/H2Gicons/successAnimation.gif"));(g._Mode===h.Manage||g._Mode===h.UpdateOrg)&&g._replaceLoadingText(n)}else setTimeout($.proxy(g._getRefreshStatus,g),500)},_createFHIRUpdatePopup:function WP$Community$CommunityController$createFHIRUpdatePopup(f){var e="#updateAnotherOrg",d="#updateClose",a=this;if(!a._isFhirUpdatePopupShowing&&f){$afe.select(x).addClass(c);var g=a._getUpdateStatusDisplayModel(f);$afe.select("#popupContent").empty().safeAppend($afe.renderTemplate($$WP.Templates.Community.FHIRUpdatePopup,g));a._isFhirUpdatePopupShowing=b;$afe.select(d).click(a.disposePopup);if(a._Mode!==h.Manage&&a._Mode!==h.Login&&a._Mode!==h.UpdateOrg){dxrOrgs=a._getDXRLinkedOrganizations();if(dxrOrgs.length>1){$afe.select(e).removeClass(c);$afe.select(e).click(a._updateAnotherOrganization);$afe.select(d).removeClass(tb);$afe.select(d).addClass("reverseNewWorkflow")}}a._popupComponent.ContainerComponent.setFocus()}else return},_getUpdateStatusDisplayModel:function WP$Community$CommunityController$_getUpdateStatusDisplayModel(a){var b={},d,c;if(!a||!a.FeaturesToLoad)return b;if(this._Mode===h.UpdateOrg||this._Mode===h.Manage&&$$WP.Utilities.UI.IsMobile)b.CloseButtonText=$$WP.Strings.get("MobileCloseButton",R);else b.CloseButtonText=$$WP.Strings.get("CloseButton",R);if(a.FeaturesToLoad.length===1)c="col-12";else if(a.FeaturesToLoad.length===2)c="col-6";b.features=[];for(d in a.FeaturesToLoad)b.features.push(this._getFeatureDisplayModel(a.FeaturesToLoad[d],c));return b},_getFeatureDisplayModel:function WP$Community$CommunityController$_getFeatureDisplayModel(c,d){var a={},b=$$WP.Strings.getNamespace(p);a.featureValue=c;a.widthOverride=d;switch(c){case 9:a.text=b.getKeyedString(o,"0");a.iconUrl=m+b.getKeyedString(n,"0").trim();break;case 37:a.text=b.getKeyedString(o,"2");a.iconUrl=m+b.getKeyedString(n,"2").trim();break;case 52:a.text=b.getKeyedString(o,"3");a.iconUrl=m+b.getKeyedString(n,"3").trim();break;case 70:a.text=$$WP.Strings.get("PastVisitsFeatureName",R);a.iconUrl=m+b.getKeyedString(n,"6").trim();break;case 47:a.text=b.getKeyedString(o,"5");a.iconUrl=m+b.getKeyedString(n,"5").trim()}a.iconUrl=makeStaticLink(a.iconUrl);return a},_replaceLoadingText:function WP$Community$CommunityController$_replaceLoadingText(j){var g=".orgUpdateTime",f="@MYCHART@LastAccessTokenDateTime@",c=this,h,d,i=e;orgObj=c._orgListObj[c._userClickedOrgId];orgObj.CurrentlyLoadingDxrData=a;if(j){h=$$WP.Strings.get("ErrorUpdatingLabel",l);orgObj.ErrorLoadingDxrData=b;i="attention"}else{$$WP.Strings.addMnemonic(f,c._orgListObj[c._userClickedOrgId].LastAccessTokenDateTime,e,l);h=$$WP.Strings.get("InformationUpToDateAsOfLabel",l);$$WP.Strings.removeMnemonic(f,l)}c._orgListObj[c._userClickedOrgId]=orgObj;d=$afe.select(ub+c._linkedFhirOrgId+"']");d.find(g).text(h).addClass(i);d.find(".fhir-update").prop(B,a).safeAttr(bb,$$WP.Strings.get("UpdateAccount",l));if(j){var k=d.find(g);k.prepend('<img src="" class="infoIcon" alt="" />');d.find(".infoIcon").safeAttr("src",makeStaticLink("images/toast_warning_icon.png"))}},_forceStopFhirLoadStatus:function WP$Community$CommunityController$_forceStopFhirLoadStatus(){var b=this;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/Shared/ForceStopFhirLoadStatus"),type:g,cache:a,data:{orgId:b._linkedFhirOrgId},dataType:j,error:b._disposeFhirUpdatePopup})})},_disposeFhirUpdatePopup:function WP$Community$CommunityController$_disposeFhirUpdatePopup(){var a=this;if(a._isFhirUpdatePopupShowing||$afe.select(D).length!==0){a.disposePopup(e,b);a._displayErrorPopup()}(a._Mode===h.Manage||a._Mode===h.UpdateOrg)&&a._replaceLoadingText(b)},_successUpdateFHIRAccount:function Epic$PatientAccess$Controllers$CommunityController$_successUpdateFHIRAccount(c){var a=this;if(c.Success){if(!c.IsLiveFhir&&!a._fhirUpdateComplete)c.FhirOrg.CurrentlyLoadingDxrData=b;if(c.IsFromNewOrg){a._userClickedAction=u.LinkFHIRFirstTime;c.FhirOrg.successLinked=b}else a._userClickedAction=u.LinkFHIRAgain;c.IsLiveFhir&&a.showSuccessAndDisposePopup();a._orgListObj[a._userClickedOrgId]=c.FhirOrg;a.renderOrganizationList()}else a._forceStopFhirLoadStatus()},addNewQueryString:function Epic$PatientAccess$Controllers$CommunityController$addQueryString(b){var a;if(b&&window.history!==undefined&&window.history.replaceState!==undefined){a=window.location.search;if(a.indexOf("?")!==-1)window.history.replaceState({},document.title,a+"&"+b);else window.history.replaceState({},document.title,a+"?"+b)}$$WPUtil.parseQueryString(window.location.search)},_completeUpdate:function Epic$PatientAccess$Controllers$CommunityController$_completeUpdate(d){var c=this;$$WPUtil.HideAjaxSpinner($afe.select(Q));if(d.Success){c.showSuccessAndDisposePopup();if(c._isIntegrated)if(c._userClickedAction===u.NotMe)c._notMyAccountCallback();else c._successCallback(d.OrgLink);else if(c._userClickedAction===u.NotMe){c._orgListObj[c._userClickedOrgId].IsDisabled=b;c._orgListObj[c._userClickedOrgId].ShowDismissOption=a;c._renderSingleCEOrgBottom(c._orgListObj[c._userClickedOrgId])}else{c._orgListObj[d.OrgLink.OrganizationId]=d.OrgLink;c._renderJustLinkedOrganization(d.OrgLink.OrganizationId);c._renderLinkedOrganizations()}}else c._displayError()},_completeUnlink:function Epic$PatientAccess$Controllers$CommunityController$_completeUnlink(c){var b=this;$$WPUtil.HideAjaxSpinner($afe.select(Q));if(c.Success){b.showSuccessAndDisposePopup();if(b._userClickedAction===u.UnlinkFHIR)b._orgListObj[b._userClickedOrgId].UserActionStatus=u.UnlinkFHIR;else b._orgListObj[b._userClickedOrgId].UserActionStatus=u.Unlink;b._orgListObj[b._userClickedOrgId].Accept=a;$afe.select(ub+b._userClickedOrgId+"']").empty().safeAppend($afe.renderTemplate($$WP.Templates.Community.RecentUnlinkedCEOrg,b._orgListObj[b._userClickedOrgId]));b._renderKnownOrganizations();b.clearCurrentSearch()}else b._displayError()},clearCurrentSearch:function Epic$PatientAccess$Controllers$CommunityController$_clearCurrentSearch(a){$afe.select(t).val(e);$afe.select(t).trigger("input");a&&a.target.id==="clear-search-button"&&$afe.select(t).focus()},_displayError:function Epic$PatientAccess$Controllers$CommunityController$_displayError(e){var a="loadingerror",d=$afe.select(x),b=$afe.select(E);if(!d.hasClass(s)){d.removeClass(c);$afe.jq(window).trigger(Y);$afe.select(L).addClass(s)}if(b.hasClass(s)){b.addClass(a);this._displayErrorPopup(e)}else b.removeClass(v).addClass(a).on(ab,$.proxy(this._displayErrorPopup,this,e))},_displayErrorPopup:function Epic$PatientAccess$Controllers$CommunityController$_displayErrorPopup(c){var a="@MYCHART@EXTERNALORGANIZATIONNAME@",d,f,g;this.disposePopup(b);if(c&&c.Error&&c.Error===Cb.CeOptOut){$$WP.Strings.addMnemonic(a,c.ExternalOrgName,e,p);d="CeOptOutErrorText"}else d="ErrorOccurredText";f={ToolbarButtons:[{Text:$$WP.Strings.get("OKButton",p),Class:tb}],TitleText:$$WP.Strings.getForTemplate("ErrorTitle",p),Html:$$WP.Strings.get(d,p),IsClosable:b,callback:function(){}};g=new $$WPComp.ConfirmComponent(f,{Size:$$WP.Containers.Popup.SizeEnum.SMALL});$$WPUtil.quickPopup(g);$$WP.Strings.removeMnemonic(a,p)},_displayLoadingPopup:function _displayLoadingPopup(l,m,k){var d=this,g,e,f,i=b,j;j=d._Mode!==h.Manage&&d._Mode!==h.Login&&d._Mode!==h.UpdateOrg;if($afe.select(D).length===0||j){if(k){f=$$WPContain.Popup.SizeEnum.MEDIUM;i=a}else f=$$WPContain.Popup.SizeEnum.SMALL;g={SupressTitle:i,IsClosable:a,TitleText:m};e=new $$WP.Community.Components.CommunityPopupComponent(g);d._popupComponent=e;$$WPUtil.quickPopup(e,{Size:f,Class:db,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:a});$afe.select(D).text(l);$afe.select(E).addClass(Z);$afe.select(x).removeClass(c);d._popupComponent.$container.trigger(A);d._popupComponent.ContainerComponent.setFocus()}},showSuccessAndDisposePopup:function(){if(this._popupComponent!==f){$afe.select(E).addClass(v).removeClass(s);$afe.select(L).addClass(v).removeClass(s);$afe.select(lb).addClass(c);$afe.select(x).removeClass(c);$afe.jq(window).trigger(Y);$afe.select(L).addClass(s);$afe.select(E).removeClass(v).addClass(s).on(ab,this.disposePopup)}},disposePopup:function Epic$PatientAccess$Controllers$CommunityController$disposePopup(d,e){var c=this;if(c._popupComponent!==f){c._popupComponent.dispose();c._popupComponent=f;if(c._isFhirUpdatePopupShowing){c._isFhirUpdatePopupShowing=a;c._wasFhirUpdatePopupClosed=b;c.removeQueryStringFromBrowser();c._Mode===h.HealthSummary&&c.addNewQueryString("mode=snapshot");!e&&c._fhirUpdateComplete&&c._Mode!==h.Manage&&c._Mode!==h.Login&&c._Mode!==h.UpdateOrg&&location.reload()}c._isIntegrated&&d&&c._failureCallback()}},enableOrDisableVerifyButton:function WP$Community$CommunityController$enableOrDisableVerifyButton(){var c,d;c=$afe.select(N).val();d=$afe.select(P).val();if(c===cb||d===e)$afe.select(M).prop(B,b).safeAttr(F,G);else $afe.select(M).prop(B,a).safeAttr(F,"false")},disableSubmit:function WP$Community$CommunityController$diableSubmit(){$afe.select(vb).prop(B,b).safeAttr(F,G)},enableSubmit:function WP$Community$CommunityController$enableSubmit(){$afe.select(vb).prop(B,a).safeAttr(F,"false")},getChildrenOrganizationList:function WP$Community$CommunityController$getChilrenOrganizationList(b){$.ajax({url:makeLink("Community/Shared/LoadChildrenOrganizations"),type:g,cache:a,data:{organizationID:b},error:this._displayErrorPopup,success:this._successGetChildrenOrganizations})},_successGetChildrenOrganizations:function Epic$Community$CommunityController$_successGetChildrenOrganizations(a){this.renderChildOrgList(a.childrenOrgs.ChildrenOrganaizationList,a.childrenOrgs.ChildrenOrganaizationList.length)},renderChildOrgList:function Epic$Community$CommunityController$renderChildOrgList(n,c){var a=this,j,d,g,h,m,k,i;if(c!==undefined&&c!==f&&c!==e&&c>0)j=c;else j=0;if(!$$WPUtil.IsNullOrEmpty(a._userClickedOrgName))h=a._userClickedOrgName;else{i=a._orgListObj[a._userClickedOrgId];if(!$$WPUtil.IsNullOrEmpty(i))h=i.OrganizationName}d={};d.SupressTitle=b;d.IsClosable=b;d.TitleText=$$WP.Strings.get("ChildOrganizationPopupTitle",l);g=new $$WP.Community.Components.CommunityPopupComponent(d,$$WP.Templates.Community.ChildOrganizationsPopup);a._popupComponent=g;m={ChildOrgList:n,Count:j,ParentOrg:h};a._popupComponent.setData(m);k=isDataTile();$$WPUtil.quickPopup(g,{Class:"Popup childOrgPopup",Size:$$WPContain.Popup.SizeEnum.MEDIUM,positioningFunction:$$WPContain.Positions.InsideNearTop,HasBackButton:k});g.ContainerComponent.setFocus();matchWrapHeight()},_getOrganizationList:function WP$Community$CommunityController$_getOrganizationList(){var c=$$WPUtil.queryString(z)===q,b=this;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/Shared/LoadCommunityLinks"),type:g,cache:a,data:{controllerType:b._Mode,showDXROrgInMO:c},error:b._errorGetOrganizationList,success:b._successGetOrganizationList})})},_successGetOrganizationList:function Epic$PatientAccess$Controllers$CommunityController$_successGetOrganizationList(b){var a=this,e,d;if(a._orgListObj===f||a._orgListObj===undefined||Object.keys(a._orgListObj).length===0)a._orgListObj=b.OrgList;else $.extend(a._orgListObj,b.OrgList);if(a._Mode===h.Manage||a._Mode===h.Login){a._autoQueryListObj=b.AutoQueryList;a._isConsentNeeded=b.IsConsentNeeded;a._ceOptOut=b.CEOptOut;a._spotlightOrganizations=b.Spotlight;a._tryRenderManagePageContent(b)}else{a._Mode===h.UpdateOrg&&a._getCurrentLoadingOrgList();if(a._Mode===h.HealthSummary){e=a._getDXRLinkedOrganizations();if(e.length!==0){d=$afe.select("#refresh-banner-container");d.removeClass(c)}}a.continueFHIRQueryString()}},_errorGetOrganizationList:function WP$Community$CommunityController$__errorGetOrganizationList(){var b,a;switch(this._Mode){case h.Login:$afe.onDocumentReady(function(){window.location=$afe.select(T).data(J)});break;case h.Manage:setTimeout(function(){$afe.select(U).hide();b=$$WP.SimpleTemplates.Span({"class":"nodata"},$$WP.Strings.get("GenericError",p));a=$afe.select(K);a.empty();a.safeAppend(b);a.slideDown(200,function(){matchWrapHeight()})},500)}},_buildActivityIconModel:function(){var a=$$WP.Strings.getNamespace(p),b=[{title:a.getKeyedString(o,"0"),image:m+a.getKeyedString(n,"0").trim()},{title:a.getKeyedString(o,q),image:m+a.getKeyedString(n,q).trim()},{title:a.getKeyedString(o,"2"),image:m+a.getKeyedString(n,"2").trim()},{title:a.getKeyedString(o,"3"),image:m+a.getKeyedString(n,"3").trim()},{title:a.getKeyedString(o,"4"),image:m+a.getKeyedString(n,"4").trim()},{title:a.getKeyedString(o,"5"),image:m+a.getKeyedString(n,"5").trim()},{title:a.getKeyedString(o,"6"),image:m+a.getKeyedString(n,"6").trim()}];return b},_renderLoginPageContent:function(){var a=$afe.select(K),c=this._buildActivityIconModel(),d=$afe.renderTemplate($$WP.Templates.Community.CommunityLoginView,{ActivityIcons:c,expanded:b,hideExpandCollapseButton:b});a.hide();a.empty();a.safeAppend(d);$afe.select(U).hide();a.show()},_renderStaticManagePageContent:function(){var a=this,c=$afe.select(K),b=a._buildActivityIconModel(),d=$afe.renderTemplate($$WP.Templates.Community.CommunityLinksView,{ActivityIcons:b,From:$$WPUtil.queryString(I),IsProxyContext:a._isProxyContext,RemoveHyperlink:a._removeHyperlink,SubjectName:a._subjectName});c.empty().safeAppend(d);$$WPUtil.queryString("tab")==="linked"&&!a._isProxyContext&&$$WP.Utilities.UI.OnUIFrameworkLoaded($.proxy(showTabbedSection,a,eb))},_tryRenderManagePageContent:function(a){$$WP.Utilities.UI.OnUIFrameworkLoaded($.proxy(this._renderManagePageContent,this,a))},_renderManagePageContent:function(c){var a=this,f=$afe.select(K),g,h,d,e;if(a._isPICELDisabled&&!c.IsNPP){e=$afe.renderTemplate($$WP.Templates.Core.Banner,{BannerType:"informationalType",HeaderText:$$WP.Strings.get("LocalPICELDisabledHeader",p),DetailText:$$WP.Strings.get("LocalPICELDisabledBody",p)});$afe.select("#picel-disabled-banner").empty().safeAppend(e)}!c.HasSearchableOrgs&&a._getKnownCEOrganizations().length===0&&a._getAutoQueryCount()===0&&!a._isConsentNeeded&&a._spotlightOrganizations.length===0&&$afe.select("#noOrganizations").show();a._userCanSearch=c.HasSearchableOrgs;c.HasSearchableOrgs&&$afe.select("#organizationSearchContainer").show();if(!c.H2GHasBeenViewed){g=$afe.renderTemplate($$WP.Templates.Community.ManagePageIntroText,{ActivityIcons:a._buildActivityIconModel(),expanded:b});$afe.select("#discover-H2G-intro-text").empty().safeAppend(g)}a.renderOrganizationList();$afe.select(U).hide();f.show();for(h in a._autoQueryListObj)a.autoQuery(a._autoQueryListObj[h].OrganizationId);a.updateImagePlaceholders(f);matchWrapHeight();$afe.jq(window).trigger(A);d=$$WPUtil.queryString("celink");if(d===q){a._userClickedAction=u.Link;a.continueCELinking()}else a.continueFHIRQueryString()},renderOrganizationList:function Epic$PatientAccess$Controllers$CommunityController$renderOrgnizationList(){var a=this;a._renderLinkedOrganizations();a._renderKnownOrganizations();a._renderNearbyOrganizations();a._renderUpdatedSearchResultsIfNeeded();matchWrapHeight();$afe.jq(window).trigger(A);$$WP.Utilities.UI.IsMobile&&$$WP.Utilities.Mobile&&$$WP.Utilities.Mobile.Optimization.CommunityLinks()},_renderLinkedOrganizations:function(){var a=this,b=a._getLinkedOrganizations(),e={organizationList:b,isProxyContext:a._isProxyContext,subjectName:a._subjectName,removeHyperlink:a._removeHyperlink},d=$afe.renderTemplate($$WP.Templates.Community.OrganizationList,e);$afe.select("#organizationList").empty().safeAppend(d);b&&b.length>0&&a._isProxyContext&&$afe.select("#proxyContextInfo").removeClass(c)},_getCurrentLoadingOrgList:function(){if(this._Mode!==h.UpdateOrg&&$$WP.Utilities.UI.IsMobile){$$WP.Utilities.TryRedirect(makeLink("Community/UpdateData"));return}var d=this._getDXRLinkedOrganizations(),f,i,b=e,c=this;for(i in d){f=d[i];b=b+"^"+f.OrganizationId}getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/Shared/GetCurrentLoadingOrgList"),type:g,cache:a,data:{orgIds:b,controllerType:c._Mode},dataType:j,error:c._displayErrorPopup,success:c._successGetCurrentLoadingOrgList})})},_successGetCurrentLoadingOrgList:function(a){if(this._Mode===h.UpdateOrg)this._renderFhirOrgPage(a.loadingOrgList,a.errorOrgList);else this._renderFhirOrgPopup(a.loadingOrgList,a.errorOrgList)},_renderFhirOrgPage:function(e,f){var a=this,b=0,c=a._getDXRLinkedOrganizations();a._updateDxrOrgModels(c,e,f);if(a._hasNonDXRLinkedOrganization())b=1;$afe.select("#organization_container").empty().safeAppend($afe.renderTemplate($$WP.Templates.Community.OrganizationList,{organizationList:c,inlineUpdate:1,showDisclaimer:b}));matchWrapHeight();var g=$afe.select(wb);g.on(d,V,a.clickUpdateFHIR)},_updateAnotherOrganization:function WP$Community$CommunityController$createFHIRUpdatePopup(){this.disposePopup(e,b);this._getCurrentLoadingOrgList()},_renderFhirOrgPopup:function(k,l){var a=this,h,f,c,e,g=0,j;h=$afe.select(".FhirOrgPopup").length;if(!h){f=a._getDXRLinkedOrganizations();if(!f)a._displayErrorPopup();else{a._updateDxrOrgModels(f,k,l);c={};c.SupressTitle=b;c.IsClosable=b;c.TitleText=$$WP.Strings.get("UpdateFHIROrgTitle",i);e=new $$WP.Community.Components.CommunityPopupComponent(c,$$WP.Templates.Community.OrganizationList);if(a._hasNonDXRLinkedOrganization())g=1;a._popupComponent=e;j={organizationList:f,inlineUpdate:1,showDisclaimer:g};a._popupComponent.setData(j);$$WPUtil.quickPopup(e,{Class:"Popup noOverflow FhirOrgPopup",Size:$$WPContain.Popup.SizeEnum.MEDIUM,positioningFunction:$$WPContain.Positions.InsideCentered});e.ContainerComponent.setFocus();matchWrapHeight();var m=$afe.select(wb);m.on(d,V,a.clickUpdateFHIR)}}},_updateDxrOrgModels:function(d,f,g){var e,c;for(e in d){c=d[e];if(f.indexOf(c.OrganizationId)>-1){c.CurrentlyLoadingDxrData=b;c.ErrorLoadingDxrData=a}else if(g.indexOf(c.OrganizationId)>-1){c.CurrentlyLoadingDxrData=a;c.ErrorLoadingDxrData=b}else{c.CurrentlyLoadingDxrData=a;c.ErrorLoadingDxrData=a}}},_renderKnownOrganizations:function(){var a=this,h=a._getAutoQueryCount(),c=a._getKnownCEOrganizations(),e=a._getUniqueNumber,d=a._userCanSearch;c.sort(a.sortKnownOrg);c.forEach(function(a){if(a.LinkType===H.MyChart){if(a.CanCreateCELink)a.Type=y.UnknownEpic;else a.Type=y.CE;a.ShowCEOptOutErrorMsg=this._ceOptOut}else a.Type=y.FHIR;a.uniqueId=e();a.StartExpanded=b;a.ShowDismissOption=d});var f=a._isConsentNeeded,g={Results:c,skeletonCount:h,isConsentNeeded:f};$afe.select(xb).empty().safeAppend($afe.renderTemplate($$WP.Templates.Community.UnlinkedOrganizationList,g))},_renderNearbyOrganizations:function(){var a=this._getUniqueNumber;this._spotlightOrganizations.forEach(function(b){if(b.EpicStatus){b.Type=y.UnknownEpic;b.ShowCEOptOutErrorMsg=this._ceOptOut}else b.Type=y.FHIR;b.uniqueId=a()});$afe.select("#fhirSpotlight").empty().safeAppend($afe.renderTemplate($$WP.Templates.Community.NearbyOrganizationSpotlight,{Spotlight:this._spotlightOrganizations}))},_renderUpdatedSearchResultsIfNeeded:function(){var c=this._userClickedAction,b=this._userClickedOrgId,a;if(c===u.Link){$afe.select(yb+b+zb).show();a=$afe.select(fb+b+gb);a.empty();a.safeAppend($afe.renderTemplate($$WP.Templates.Community.RecentCEOrgBottom,{}))}},_renderJustLinkedOrganization:function(b){var a=$afe.select(fb+b+gb);$afe.select(yb+b+zb).show();a.empty();a.safeAppend($afe.renderTemplate($$WP.Templates.Community.RecentCEOrgBottom,{}))},_renderSingleCEOrgBottom:function(b){var a;a=$afe.select(fb+b.OrganizationId+gb);a.empty();a.append($afe.renderTemplate($$WP.Templates.Community.CEOrgBottom,b))},_getLinkedOrganizations:function(){var a=this._orgListObj;return Object.keys(a).map(function(b){return a[b]}).filter(this._filterLinkedOrganizations).sort(this.sortOrg)},_filterLinkedOrganizations:function(c){var d=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(z)===q;if(!d&&c.LinkType&&c.LinkType===H.Dxr)return a;if(c.LinkType===2||c.LinkType===1)c.DisplayAutoRefresh=b;return c.Accept},_getDXRLinkedOrganizations:function(){var a=this._orgListObj;return!a?e:Object.keys(a).map(function(b){return a[b]}).filter(this._filterDXRLinkedOrganizations).sort(this.sortDXROrg)},_filterDXRLinkedOrganizations:function(a){return a.Accept&&a.LinkType===H.Dxr},_hasNonDXRLinkedOrganization:function(){var e=this._orgListObj,c;if(!e)return a;c=Object.keys(e).map(function(a){return e[a]}).filter(this._filterLinkedOrganizations);for(var d=0;d<c.length;d++)if(c[d].LinkType===H.MyChart||c[d].LinkType===H.Fhir)return b;return a},_getKnownCEOrganizations:function(){var b=this._orgListObj,c=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(z)===q,d=Object.keys(b).map(function(a){return b[a]}).filter(function(b){switch(b.HiddenFromMyChart){case Bb.UserDismissed:case Bb.NoClinicalData:return a}return!c&&b.LinkType&&b.LinkType===H.Dxr?a:!b.Accept});return d},_getUniqueNumber:function(){var a=0;function getAndIncrement(){return a++}return getAndIncrement}(),_getAutoQueryCount:function(){var a=0;if(this._autoQueryListObj&&typeof this._autoQueryListObj==="object")a=Object.keys(this._autoQueryListObj).length;return a},sortOrg:function(a,b){return a.LinkType!==b.LinkType&&(a.LinkType===H.Dxr||b.LinkType===H.Dxr)?a.LinkType===H.Dxr?-1:1:a.ShowSignup!==b.ShowSignup?a.ShowSignup?-1:1:0},sortKnownOrg:function(b,a){return b.ShowUnavailableMsg!==a.ShowUnavailableMsg?a.ShowUnavailableMsg?-1:1:b.ShowAccountDisabledErrorMsg!==a.ShowAccountDisabledErrorMsg?a.ShowAccountDisabledErrorMsg?-1:1:typeof b.LinkType==="number"&&typeof a.LinkType==="number"?b.LinkType-a.LinkType:0},sortDXROrg:function(c,d){var a=new Date(c.LastAccessTokenDateTime),b=new Date(d.LastAccessTokenDateTime);if(a!==b)if(a>b)return 1;else if(a<b)return-1;return 0},removeQueryStringFromBrowser:function Epic$PatientAccess$Controllers$CommunityController$removeQueryStringFromBrowser(){var a=window.location.search.substring(1);if(a.length)window.history!==undefined&&window.history.pushState!==undefined&&window.history.pushState({},document.title,window.location.pathname)},giveConsent:function WP$Community$CommunityController$giveConsent(){var b;this._isConsentNeeded=a;b=this;b.disableSubmit();$afe.select(hb).hide();$$WPUtil.ShowAjaxSpinner($afe.select("#proxyConsentAlert .ajaxspinner"));$.ajax({url:makeLink("Community/Shared/QueryCommunityLinks"),type:g,cache:a,data:{controllerType:b._Mode},error:b._errorGiveConsent,success:b._successGiveConsent})},_errorGiveConsent:function WP$Community$CommunityController$_errorGiveConsent(){$afe.select(S).hide();this.enableSubmit(this);this._displayErrorPopup()},_successGiveConsent:function WP$Community$CommunityController$_successGiveConsent(d){var a=this,f,c,g,e;f=a;if(d.OrgList&&Object.keys(d.OrgList).length>0){if(a._getKnownCEOrganizations().length===0){a._orgListObj=$.extend(a._orgListObj,d.OrgList);a._renderKnownOrganizations()}else{$.extend(a._orgListObj,d.OrgList);for(g in d.OrgList){c=d.OrgList[g];c.uniqueId=a._getUniqueNumber();c.StartExpanded=b;c.ShowDismissOption=a._userCanSearch;if(c.CanCreateCELink)c.Type=y.UnknownEpic;else c.Type=y.CE;a._orgListObj[g]=c;$afe.select(xb).safeAppend($afe.renderTemplate($$WP.Templates.Community.DiscoverableOrganizationTop,c))}}e=a._spotlightOrganizations.filter(function(a){return d.OrgList[a.OrganizationId]===undefined});if(e.length<a._spotlightOrganizations.length){a._spotlightOrganizations=e;a._renderNearbyOrganizations()}$afe.select(S).remove()}else{$afe.select(S).text($$WP.Strings.get("NoOrganizationsFoundFromDemographicsSearch",i));$afe.select(S).addClass("no-additional-orgs-found")}f.enableSubmit(f)},getLastOrganizationId:function WP$Community$CommunityController$getLastOrganizationId(){var b,a;b=$afe.select("div.organization");if(b.length>0)a=b.last().safeAttr(r);if(a!==undefined)a=a.slice(13);return a},clickConsentLink:function WP$Community$CommunityController$clickConsentLink(){var a;a=this;$.proxy(a.giveConsent(),a)},updateImagePlaceholders:function WP$Community$CommunityController$updateImagePlaceholders(d){var c,a,b;function addIcon(a){a.addClass("icon")}c=$afe.jq(d).find(".org_col_logo img");for(b=0;b<c.length;b++){a=$afe.jq(c[b]);a.on("load",addIcon(a));a.safeAttr("src",a.data(J))}},handleMobileBackButton:function WP$Community$CommunityController$handleMobileBackButton(){if($$WPUtil.queryString("backToPrevPage")===G)if($$WPUtil.queryString(I))$$WP.Utilities.TryRedirect(makeLink(rb)+"?mode="+$$WPUtil.queryString(I));else window.history.back();else this.closeWebView()},closeWebView:function WP$Community$CommunityController$closeWebView(){$$WP.Utilities.TryRedirect(makeLink("inside.asp?moworkflow=completeandclose"))},toLinkedTab:function WP$CommunityCommunityController$toLinkedTab(){showTabbedSection(eb);window.scrollTo(0,0)},toDiscoverTab:function WP$CommunityCommunityController$toLinkedTab(){showTabbedSection("tab_topic_discover");window.scrollTo(0,0)},scrollToSearchForMobile:function WP$CommunityCommunityController$scrollToSearchForMobile(){var b=$afe.select(t)[0].getBoundingClientRect(),a=b.top;a/window.innerHeight>.33&&$("html, body").animate({scrollTop:$(t).offset().top-window.innerHeight*.2},500)},unFocusSearchInput:function WP$CommunityCommunityController$unFocusSearchInput(b){var a="orgSearch";b.target.id!==a&&document.activeElement.id===a&&$(t).blur()}};Handlebars.registerHelper("ifNotNullOrEmpty",function(b,a){return!$$WPUtil.IsNullOrEmpty(b)?a.fn(this):a.inverse(this)});Ab.prototype=Db;$$WP.Community=$$WP.Community||{};$$WP.Community.CommunityController=Ab;Ab.extend($$WP.Controllers.Controller,"WP$Community$CommunityController")})();function expandSection(d){var a=$afe.select("#"+d),b=$afe.select("[data-expand-button="+d+"]"),e=b.safeAttr("data-scroll-into-view"),c=null;b.safeAttr("aria-expanded",true);b.safeAttr("data-expand-state","expanded");if(e)c=function(){var d=a[0].getBoundingClientRect(),c=d.bottom,b=c-window.innerHeight;b>0&&a[0].scrollIntoView(false)};a.slideDown({progress:c})}function collapseSection(b){var a;$afe.select("#"+b).slideUp();a=$afe.select("[data-expand-button="+b+"]");a.safeAttr("aria-expanded",false);a.safeAttr("data-expand-state","collapsed")}function toggleSection(a){if($afe.select("#"+a).is(":hidden"))expandSection(a);else collapseSection(a)}$afe.select("body").on("click","[data-expand-button],[data-expand-clickable-row]",function handleClick(a){var b=a.currentTarget.dataset.expandButton||a.currentTarget.dataset.expandClickableRow;toggleSection(b);a.stopPropagation()})