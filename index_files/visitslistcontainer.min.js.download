/*! Copyright Epic Systems Corporation 2016 */
$$WPUtil.guaranteeExistence($$WP,"Visits");$$WP.Visits.PastUpcomingEnum={UpcomingAndPast:"1",UpcomingOnly:"2",PastOnly:"3"};$$WP.Visits.FilterCategoryEnum={Providers:"1",Departments:"2",Specialties:"3"};$$WP.Visits.VisitsListContainer=function WPVst$VtsLtComponent(b){var a=this;a.HeaderComponent=new $$WP.Visits.VisitsListHeaderComponent;a.UpcomingComponent=new $$WP.Visits.UpcomingVisitsListComponent;a.PastComponent=new $$WP.Visits.PastVisitsListComponent;a.FooterComponent=new $$WP.Visits.VisitsListFooterComponent;b.Components=[a.HeaderComponent,a.UpcomingComponent,a.PastComponent,a.FooterComponent];a.Containers$ContainerComponent(b);a.show(true);$afe.select("div.splitter").length===0&&a._addSplitter();a.addEventListener("click",a._click)};$$WP.Visits.VisitsListContainer.prototype={HeaderComponent:$$WPComp.Component.prototype,FooterComponent:$$WPComp.Component.prototype,UpcomingComponent:$$WPComp.Component.prototype,PastComponent:$$WPComp.Component.prototype,SupportAnimations:false,IsClosable:false,IsPastVisitLoadingIconDrawn:false,_click:function(a){$afe.jq(a.target).safeAttr("name")!=="filterCat"&&$afe.jq(a.target).parents("div.dropdown").length!==1&&this.HeaderComponent.ShowFilterMenu===true&&this.HeaderComponent.toggleMenu()},show:function(a){a=a!==false;this.Containers$ContainerComponent$show(a)},_addSplitter:function(){var a=$afe.jq(document.createElement("div"));a.addClass("splitter hidden");a.safeInsertBefore($afe.select(".visitcomponent.pastvisits"))},resetSplitter:function(){var c="hidden",b=".splitter",a=this,d;d=a.UpcomingComponent.isVisible()&&a.PastComponent.isVisible();d=d&&a.$content.find("div.nodatalistelement:not(.hidden)").length===0&&a.$content.find(".afterList .nodata:not(.hidden)").length===0;if(d){if(a.$content.find(b).hasClass(c)){a.$content.find(b).removeClass(c);a.$content.trigger("resize",{forceShrink:true})}}else if(!a.$content.find(b).hasClass(c)){a.$content.find(b).addClass(c);a.$content.trigger("resize",{forceShrink:true})}},drawPastVisitListHeart:function(){var a=this;if(a.UpcomingComponent.HasFinishedLoading&&!a.PastComponent.HasFinishedFirstLoad&&!a.IsPastVisitLoadingIconDrawn){var b=$afe.renderTemplate($$WP.Templates.UI.AjaxSpinner,{inline:1});b.safeAttr("id","pastVisitLoadingHeart");b.safeInsertBefore($afe.select(".visitcomponent.pastvisits"));$$WPUtil.ShowAjaxSpinner(b);a.IsPastVisitLoadingIconDrawn=true}},removePastVisitListHeart:function(){if(this.PastComponent.HasFinishedFirstLoad&&this.IsPastVisitLoadingIconDrawn){var a=$afe.select("#pastVisitLoadingHeart");a&&$$WPUtil.HideAjaxSpinner(a);this.IsPastVisitLoadingIconDrawn=false}}};$$WP.Visits.VisitsListContainer.extend("Containers.ContainerComponent");$$WP.Visits.VisitsListHeaderComponent=function VisitsListHeaderComponent(b){var a=this;a.Components$TemplateComponent(b);a.addEventListener("change",a._change);a.addEventListener("keydown",a._keydown);a.addEventListener("click",a._click);a._registerHandlebarsHelpers()};$$WP.Visits.VisitsListHeaderComponent.prototype={template:$$WP.Templates.Visits.VisitsListHeader,SupportAnimations:false,Url:makeLink("Visits/VisitsList/VisitsHeaderOptions"),IsClosable:false,TitleText:null,CommunicationsIndicator:false,ContainerComponent:$$WP.Visits.VisitsListContainer.prototype,PastUpcomingEnum:$$WP.Visits.PastUpcomingEnum,FilterCategoryEnum:$$WP.Visits.FilterCategoryEnum,PastUpcomingFilterValue:$$WP.Visits.PastUpcomingEnum.UpcomingAndPast,PreviousPastUpcomingFilterValue:$$WP.Visits.PastUpcomingEnum.UpcomingAndPast,FilterOptionsLoaded:false,ShowFilterBar:false,ShowFilterButton:false,ShowFilterMenu:false,FilterCategoryValue:$$WP.Visits.FilterCategoryEnum.Providers,HideCanceledShifted:true,FilterOptionsData:null,CurrentOptionsList:null,CurrentOptionString:"All Providers",CurrentDatList:null,SelectedOptions:[],ProviderCount:0,DepartmentCount:0,SpecialtyCount:0,HomeOrgId:"",OrganizationFilterValue:"",StringsManager:$$WP.Strings.getNamespace("Visits"),ShowCanceledApptsSetting:false,LoadProviders:true,LoadDepartments:true,LoadSpecialties:true,H2GEnabled:false,setData:function(b){var a=this;if(b.NumberOrganizations&&b.NumberOrganizations>1){a.H2GEnabled=true;a.loadHomeOrgId();a.HideCanceledShifted=false}a.CurrentOptionString=$$WP.Strings.getForTemplate("AllProvidersSelected","Visits");a._setTemplateData(b);a.Components$TemplateComponent$setData(b)},refresh:function(){var a=this;a.Data=$$WPUtil.mergeObjects(a.ListData,a.Data,false,true);a._setTemplateData(a.Data);a.Data.Filter=a.ContainerComponent.PastComponent.Filter;var b=$afe.select(":focus").safeAttr("id");a.Components$TemplateComponent$refresh();a.FilterOptionsLoaded&&a.handleListeners();a._moveResetButton();a.ContainerComponent.FooterComponent.determineLoadLinkStatus(a.CurrentDatList);a.keepFocusOnElement("#"+b)},_setTemplateData:function(b){var a=this;b.PastUpcomingFilterValue=a.PastUpcomingFilterValue;b.FilterOptionsLoaded=a.FilterOptionsLoaded;b.HideCanceledShifted=a.HideCanceledShifted;b.FilterCategoryValue=a.FilterCategoryValue;b.CurrentOptionsList=a.CurrentOptionsList;b.CurrentOptionString=a.CurrentOptionString;b.CurrentDatList=a.CurrentDatList;b.ProviderCount=a.ProviderCount;b.DepartmentCount=a.DepartmentCount;b.SpecialtyCount=a.SpecialtyCount;b.ShowFilterBar=a.ShowFilterBar;b.SelectedOptions=a.SelectedOptions;b.ShowFilterButton=a.ShowFilterButton;b.ShowFilterMenu=a.ShowFilterMenu;b.ShowCanceledApptsSetting=a.ShowCanceledApptsSetting;b.LoadProviders=a.LoadProviders;b.LoadDepartments=a.LoadDepartments;b.LoadSpecialties=a.LoadSpecialties},clearFilters:function(){var b=null,a=this,c=a.OrganizationFilterValue&&a.OrganizationFilterValue.split("~")[1]===a.HomeOrgId;a.CurrentDatList=b;a.SelectedOptions=[];if(a.H2GEnabled)if(c){a.ContainerComponent.UpcomingComponent.setFilter(a.OrganizationFilterValue);a.ContainerComponent.UpcomingComponent.applyFilters();a.ContainerComponent.PastComponent.setFilter(a.OrganizationFilterValue);a.ContainerComponent.PastComponent.applyFilters()}else a.HideCanceledShifted=false;a.ContainerComponent.PastComponent.applyDATFilters(b);a.ContainerComponent.PastComponent.stopAutoClick();a.ContainerComponent.UpcomingComponent.applyFilters(b);a.updateCurrentCategoryOptions(b,b,b,true);a.refresh()},getFilterOptions:function(){var c="hidden",i="specialtiesCategory",h="departmentsCategory",e="none",d="display",g="providersCategory",a=this,b=$afe.jq(document.createElement("div"));b.safeAppendTo("body");b.addClass(g);a.LoadProviders=b.css(d)!==e;b.removeClass(g);b.addClass(h);a.LoadDepartments=b.css(d)!==e;b.removeClass(h);b.addClass(i);a.LoadSpecialties=b.css(d)!==e;b.removeClass(i);b.remove();var j="Visits/VisitsList/LoadFilterOptions",k={loadProviderOptions:a.LoadProviders,loadDepartmentOptions:a.LoadDepartments,loadSpecialtyOptions:a.LoadSpecialties};if(a.LoadProviders)a.FilterCategoryValue=a.FilterCategoryEnum.Providers;else if(a.LoadDepartments)a.FilterCategoryValue=a.FilterCategoryEnum.Departments;else if(a.LoadSpecialties)a.FilterCategoryValue=a.FilterCategoryEnum.Specialties;else a.FilterCategoryValue="";var f=$afe.select("span.loadingFilterProgressBar");f.removeClass(c);$.ajax({type:"POST",url:makeLink(j),data:k,context:a,success:function(b){var a=this;a.FilterOptionsData=b;a.ShowCanceledApptsSetting=b.ShowCanceledApptsSetting;a.FilterOptionsLoaded=true;a.ShowFilterBar=true;a.ShowFilterMenu=true;a.ContainerComponent.PastComponent.SortedPastDATs=b.SortedPastDATs;a.updateCurrentOptions();f.addClass(c);a.refresh();a.keepFocusOnElement('*[data-id="filterCategories"]')},failure:function(){f.addClass(c)}})},toggleFilterBar:function(){var a=this;a.ShowFilterBar=!a.ShowFilterBar;var b=$afe.select("#visitsFilterBar-"+a.ContainerComponent.HeaderComponent.ComponentNumber);b.toggleClass("hidden");if(a.ShowFilterBar){a.ShowFilterMenu=true;a.keepFocusOnElement('*[data-id="filterCategories"]')}a.refresh()},keepFocusOnElement:function(a){var b=setTimeout(function(){var b=$afe.select(a).get(0);b&&b.focus()},50)},toggleCanceledShiftedCards:function(){var a=this;a.HideCanceledShifted=!a.HideCanceledShifted;a.ContainerComponent.PastComponent.applyDATFilters(a.CurrentDatList);a.refresh()},filterAppointments:function(){var h="@MYCHART@TOTALFILTERCOUNT@",g="@MYCHART@NUMFILTERSSELECTED@",b=true,c=null,a=this,f=Object.keys(a.CurrentOptionsList).length,e="";a.CurrentDatList=[];for(var d=0;d<a.SelectedOptions.length;d++){e=a.SelectedOptions[d];a.CurrentDatList=a.CurrentDatList.concat(a.CurrentOptionsList[a.SelectedOptions[d]])}if(a.SelectedOptions.length===1)if(e==="Other")a.CurrentOptionString=a.StringsManager.getStringForTemplate("OtherOptionBucket");else a.CurrentOptionString=e;else if(a.SelectedOptions.length===f||a.SelectedOptions.length===0){a.updateCurrentCategoryOptions(c,c,c,b);a.CurrentDatList=c}else{a.StringsManager.addMnemonic(g,a.SelectedOptions.length);a.StringsManager.addMnemonic(h,f);a.CurrentOptionString=a.StringsManager.getStringForTemplate("SomeFilterOptionsSelected");a.StringsManager.removeMnemonic(g,a.SelectedOptions.length);a.StringsManager.removeMnemonic(h,f)}switch(a.PastUpcomingFilterValue){case a.PastUpcomingEnum.UpcomingAndPast:a.ContainerComponent.PastComponent.applyDATFilters(a.CurrentDatList,b);a.ContainerComponent.PastComponent.stopAutoClick();a.ContainerComponent.UpcomingComponent.applyFilters(a.CurrentDatList);break;case a.PastUpcomingEnum.UpcomingOnly:a.ContainerComponent.UpcomingComponent.applyFilters(a.CurrentDatList);break;case a.PastUpcomingEnum.PastOnly:a.ContainerComponent.PastComponent.applyDATFilters(a.CurrentDatList,b);a.ContainerComponent.PastComponent.stopAutoClick()}a.ShowFilterMenu=false;a.ContainerComponent.resetSplitter();a.refresh();$afe.select('*[data-component="visitslist"]').trigger("resize",{forceShrink:b});$afe.select("div.Visits.template").trigger("resize",{forceShrink:b});a.keepFocusOnElement('*[data-id="clearFilters"]')},updateCurrentOptions:function(){var a=this;switch(a.PastUpcomingFilterValue){case a.PastUpcomingEnum.UpcomingAndPast:a.updateCurrentCategoryOptions(a.FilterOptionsData.AllProvidersDATs,a.FilterOptionsData.AllDepartmentsDATs,a.FilterOptionsData.AllSpecialtiesDATs);break;case a.PastUpcomingEnum.UpcomingOnly:a.updateCurrentCategoryOptions(a.FilterOptionsData.FutureProvidersDATs,a.FilterOptionsData.FutureDepartmentsDATs,a.FilterOptionsData.FutureSpecialtiesDATs);break;case a.PastUpcomingEnum.PastOnly:a.updateCurrentCategoryOptions(a.FilterOptionsData.PastProvidersDATs,a.FilterOptionsData.PastDepartmentsDATs,a.FilterOptionsData.PastSpecialtiesDATs)}a.refresh()},updateCurrentCategoryOptions:function(f,c,d,b){var e="Visits",a=this;switch(a.FilterCategoryValue){case a.FilterCategoryEnum.Providers:if(!b)a.CurrentOptionsList=f;a.CurrentOptionString=$$WP.Strings.getForTemplate("AllProvidersSelected",e);break;case a.FilterCategoryEnum.Departments:if(!b)a.CurrentOptionsList=c;a.CurrentOptionString=$$WP.Strings.getForTemplate("AllDepartmentsSelected",e);break;case a.FilterCategoryEnum.Specialties:if(!b)a.CurrentOptionsList=d;a.CurrentOptionString=$$WP.Strings.getForTemplate("AllSpecialtiesSelected",e)}if(!b){a.ProviderCount=f?Object.keys(f).length:0;a.DepartmentCount=c?Object.keys(c).length:0;a.SpecialtyCount=d?Object.keys(d).length:0;a.determineFilterButtonStatus()}},loadHomeOrgId:function(){this.HomeOrgId===""&&$.ajax({type:"POST",url:makeLink("Visits/VisitsList/GetHomeOrganizationIdAndName"),data:null,context:this,success:function(b){var a=this;a.HomeOrgId=b.ID;a.ContainerComponent.PastComponent.HomeOrgId=a.HomeOrgId;a.StringsManager.addMnemonic("@MYCHART@VISITSHOMEORG@",b.NAME)}})},determineFilterButtonStatus:function(){var b=false,a=this,c=b,f=b,d=b,e=b;d=!a.ContainerComponent.UpcomingComponent.NoUpcomingVisits;e=a.ContainerComponent.PastComponent.RenderedData.length!==0;switch(a.PastUpcomingFilterValue){case a.PastUpcomingEnum.UpcomingAndPast:c=d||e;break;case a.PastUpcomingEnum.UpcomingOnly:c=d;break;case a.PastUpcomingEnum.PastOnly:c=e}f=a.H2GEnabled?a.OrganizationFilterValue.split("~")[1]===a.HomeOrgId:true;if(!a.FilterOptionsLoaded)a.ShowFilterButton=c&&f;else a.ShowFilterButton=c&&f&&(a.ProviderCount||a.DepartmentCount||a.SpecialtyCount||a.ShowCanceledApptsSetting&&a.PastUpcomingFilterValue!==a.PastUpcomingEnum.UpcomingOnly);if(!a.ShowFilterButton)a.ShowFilterBar=b;a.refresh()},updateUpcomingPastFooterComponents:function(){var a=this,b=false;switch(a.PastUpcomingFilterValue){case a.PastUpcomingEnum.UpcomingAndPast:a.ContainerComponent.UpcomingComponent.show();a.ContainerComponent.PastComponent.show();a.ContainerComponent.FooterComponent.show();b=true;break;case a.PastUpcomingEnum.UpcomingOnly:a.ContainerComponent.UpcomingComponent.show();a.ContainerComponent.PastComponent.hide();a.ContainerComponent.FooterComponent.hide();break;case a.PastUpcomingEnum.PastOnly:a.ContainerComponent.UpcomingComponent.hide();a.ContainerComponent.PastComponent.show();a.ContainerComponent.FooterComponent.show()}if(a.FilterOptionsLoaded)if(b){a.updateCurrentOptions();a.filterAppointments()}else{a.clearFilters();a.updateCurrentOptions()}else a.determineFilterButtonStatus()},uncheckAllFilterOptions:function(){this.SelectedOptions=[];var a=this.$content.find("tbody.optionsTableBody tr.optionsRow").children();a.children("input").each(function(c,a){var b=$afe.jq(a);b.prop("checked",false).removeAttr("checked")})},handleListeners:function(){var a=this;a.$content.find("input#uncheckAll-"+a.ComponentNumber).on("click",$.proxy(a.uncheckAllFilterOptions,a));a.$content.find("input#applyFilters-"+a.ComponentNumber).on("click",$.proxy(a.filterAppointments,a))},toggleMenu:function(){this.ShowFilterMenu=!this.ShowFilterMenu;this.refresh()},_moveResetButton:function(){var a=this,b;if(a.ShowFilterMenu){b=parseInt(a.$content.find(".dropdown-content").css("width"))-parseInt(a.$content.find(".currentOptionsButton").css("width"));a.$content.find(".clearFiltersButton").css("left",-b)}},_keydown:function(a){if(a.keyCode===13)return this._change(a)},_change:function(c){var d="checked",e=true,a=this,b=c.$dataId.val();switch(c.dataId){case"filter":a.OrganizationFilterValue=b;a.clearFilters();a.ContainerComponent.UpcomingComponent.setFilter(b);a.ContainerComponent.PastComponent.setFilter(b);a.determineFilterButtonStatus();a.$container.trigger("resize",{forceShrink:e});$$WP.Utilities.UI.MatchColumnHeights();break;case"pastUpcomingFilter":a.PreviousPastUpcomingFilterValue=a.PastUpcomingFilterValue;a.PastUpcomingFilterValue=b;a.updateUpcomingPastFooterComponents();break;case"showFilters":a._toggleShowFilters();break;case"filterCategories":a.FilterCategoryValue=b;a.ShowFilterMenu=e;a.clearFilters();a.updateCurrentOptions();break;case"singleFilterOption":var f=a.SelectedOptions.indexOf(b);if(f>-1){a.SelectedOptions.splice(f,1);c.type==="keydown"&&c.$target.prop(d,false).removeAttr(d)}else{a.SelectedOptions.push(b);c.type==="keydown"&&c.$target.prop(d,e).safeAttr(d,d)}break;case"clearFilters":a.clearFilters();break;case"toggleCanceledShifted":a.toggleCanceledShiftedCards();break;case"currentOptionsButton":a.toggleMenu();break;case"uncheckAll":a.uncheckAllFilterOptions();break;case"applyFilters":a.filterAppointments()}a.ContainerComponent.resetSplitter();return e},_toggleShowFilters:function _toggleShowFilters(){if(!this.FilterOptionsLoaded)this.getFilterOptions();else this.toggleFilterBar()},_click:function(b){var a=false;if(b.dataId==="showFilters"){this._toggleShowFilters();a=true}if(b.dataId==="clearFilters"){this.clearFilters();a=true}a&&this.ContainerComponent.resetSplitter();return true},_registerHandlebarsHelpers:function _registerHandlebarsHelpers(){Handlebars.registerHelper("GetCheckboxIdFromName",function(b){var c="option-",a="";if(!b)return"";a=b.split(" ").join("-");return c.concat(a)})}};$$WP.Visits.VisitsListHeaderComponent.extend("Components.TemplateComponent");$$WP.Visits.VisitsListFooterComponent=function VisitsListFooterComponent(a){this.Components$TemplateComponent(a);this.addEventListener("click",this._click)};$$WP.Visits.VisitsListFooterComponent.prototype={template:$$WP.Templates.Visits.VisitsListFooter,SupportAnimations:false,Url:"",IsClosable:false,TitleText:null,Class:"visitfooter",ContainerComponent:$$WP.Visits.VisitsListContainer.prototype,CurrentyDisabled:false,AreFiltersApplied:false,makeRequest:function(){},_click:function(a){if(a.dataId===undefined)return;if(a.dataId==="ignore")return;var b=a.dataId;switch(b){case"loadmore":this.ContainerComponent.PastComponent.NeverAutoFocus=true;this.ContainerComponent.PastComponent.addNextPage(undefined,true)}return false},refresh:function(){var a=this;a.Data=$$WPUtil.mergeObjects(a.ListData,a.Data,false,true);a.ContainerComponent.resetSplitter();a.Components$TemplateComponent$refresh();if(a.CurrentyDisabled)a.disableLoadLink();else a.enableLoadLink(a.AreFiltersApplied);a.ContainerComponent.PastComponent.$content.find(".pastlist > .nodatalistelement").length!==0&&a.$content.find(".nodata").addClass("hidden")},determineLoadLinkStatus:function(a){var c=this;if(typeof a!=="undefined"&&a!==null&&a.length>0){var l=a.length,h=c.ContainerComponent.HeaderComponent.FilterOptionsData.FutureProvidersDATs,g=0,i=0,e=c.ContainerComponent.PastComponent.RenderedData,d,b,f=[];Object.keys(h).forEach(function(d){var c=h[d];for(b=0;b<c.length;b++){if(a.indexOf(c[b])!==-1&&f.indexOf(c[b])===-1)g++;f.push(c[b])}});var k=l-g;for(d=0;d<e.length;d++){var j=e[d];if(a.indexOf(j.Dat)!==-1&&j.IsLocal)i++}if(i===k)c.disableLoadLink();else c.enableLoadLink(true)}else c.enableLoadLink(false)},disableLoadLink:function(){this.CurrentyDisabled=true;var a=$afe.select("a.clickable.noprint");a.addClass("disabled");a.text($$WP.Strings.getForTemplate("NoMoreVisitsWithFilters","Visits"))},enableLoadLink:function(a){this.CurrentyDisabled=false;this.AreFiltersApplied=a;var b=$afe.select("a.clickable.noprint");b.removeClass("disabled");var c=$$WP.Strings.getForTemplate("ViewMoreLinkLabel","Visits");if(a)c+=" "+$$WP.Strings.getForTemplate("SelectedFiltersWillBeApplied","Visits");b.text(c)}};$$WP.Visits.VisitsListFooterComponent.extend("Components.TemplateComponent")