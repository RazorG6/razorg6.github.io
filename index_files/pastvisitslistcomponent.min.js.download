/*! Copyright Epic Systems Corporation 2016-2019 */
$$WPUtil.guaranteeExistence($$WP,"Visits");$$WP.Visits.PastVisitsListComponent=function PastVisitsComponent(b){var a=this;a.Components$CommunityListManagerComponent(b);a.addEventListener("click",a._click);a.addEventListener("keydown",a._keydown);a.$container.throttledTransitionEnd("li",$$WP.Utilities.UI.MatchColumnHeights,"height")};$$WP.Visits.PastVisitsListComponent.prototype={template:$$WP.Templates.Visits.PastVisitsList,SupportAnimations:false,Url:makeLink("Visits/VisitsList/LoadPast?loadpast=1"),IsClosable:false,TitleText:null,CommunicationsIndicator:false,Class:"visitcomponent pastvisits",NeverAutoFocus:true,ContainerComponent:$$WP.Visits.VisitsListContainer.prototype,PastVisitLoadLimit:10,AllBucketsHidden:true,CurrentShowingDatList:null,HomeOrgId:"",LastLoadedDat:"",SortedPastDATs:null,HasFinishedFirstLoad:false,AutoClickStarted:false,PreviouslyShowingCount:-1,MaxAutoClicks:5,AutoClickCount:0,TotalLoadedCount:0,RefreshBannerViewModel:null,CommunityController:null,_click:function(c){var d="notes",g="visitsummary",f="admissions",e="visitdetails";if(typeof c.dataId==="undefined")return;if(c.dataId==="ignore")return;if(c.dataId==="")return;var h,i,a,b;h=c.dataId;i=c.$dataId.safeAttr("data-index");a=this.RenderedData[i];b=a.Csn;switch(h){case"pastvisitdetail":if(a.IsLocal)if(a.CanRedirectToApptDetails)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=visitdetails&csn="+b));else if(a.EncounterType===4)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=admissions&csn="+b));else $$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=visitsummary&csn="+b));else if(a.PrimaryOrganizationLink.LinkType==1){if(a.CanRedirectToApptDetails)$$WP.CommunityUtilities.openDeepLink(e,a.Organization,{csn:b});else if(a.EncounterType===4)$$WP.CommunityUtilities.openDeepLink(f,a.Organization,{csn:b});else $$WP.CommunityUtilities.openDeepLink(g,a.Organization,{csn:b});return false}else a.PrimaryOrganizationLink.LinkType==3&&$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=visitdetails&dxoID="+a.EncodedOrgID+"&refID="+a.ReferenceID));break;case"pastvisitnote":if(a.IsLocal)if(a.CanRedirectToApptDetails)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=visitdetails&submode=notes&csn="+b));else if(a.EncounterType===4)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=admissions&submode=notes&csn="+b));else $$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=visitsummary&submode=notes&csn="+b));else{if(a.CanRedirectToApptDetails)$$WP.CommunityUtilities.openDeepLink(e,a.Organization,{submode:d,csn:b});else if(a.EncounterType===4)$$WP.CommunityUtilities.openDeepLink(f,a.Organization,{submode:d,csn:b});else $$WP.CommunityUtilities.openDeepLink(g,a.Organization,{submode:d,csn:b});return false}}return false},show:function(){this.Components$CommunityListManagerComponent$show()},setData:function(b){var a=this,e="",f="",g;if(b!==null&&typeof b==="object"&&a.HomeOrgId){var c=b.List[a.HomeOrgId],d=c.ListSize;a.LastLoadedDat=d!==0?c.List[d-1].Dat:""}if(b.SerializedIndex&&!a.HasFinishedFirstLoad){a.HasFinishedFirstLoad=true;a.ContainerComponent.resetSplitter();a.ContainerComponent.removePastVisitListHeart()}if(b&&b.ViewBagProperties){e=b.ViewBagProperties.LoadingOrgNames;f=b.ViewBagProperties.ErrorOrgNames}a._createRefreshBannerViewModel(b.List,e,f);a.Components$CommunityListManagerComponent$setData(b);if(a.HasFinishedFirstLoad&&a.CommunityController===null)a.CommunityController=$$WP.CommunityUtilities.instantiateCommunityController("PastVisits");else if(a.HasFinishedFirstLoad&&a.CommunityController!==null){g=$afe.select(".pastvisits");g.find(".RefreshBannerSection").on("click",".RefreshBannerButton",a.CommunityController._getCurrentLoadingOrgList)}},refresh:function(){var a=this;a.Data.HideCount=a.HideCount;a.Components$CommunityListManagerComponent$refresh();a.ContainerComponent.HeaderComponent.determineFilterButtonStatus();a._applyDATFilters()},load:function(c){var a=this,f,g={},i=0,e=-1,d,b,h;if(a.CurrentShowingDatList){c=c||"";for(b=0;b<a.CurrentShowingDatList.length;b++)g[a.CurrentShowingDatList[b]]=true;h=a.SortedPastDATs.length;d=a.SortedPastDATs.indexOf(a.LastLoadedDat);for(b=d+1;b<h;b++){if(g[a.SortedPastDATs[b]]){i++;e=b}if(i>=a.PastVisitLoadLimit)break}f=e-d+5;if(e!==-1)c+="&numVisitsToRetrieve="+f}a.Components$CommunityListManagerComponent$load(c)},addNextPage:function(c,b){var a=this;b&&a.autoClickStart();a.Components$CommunityListManagerComponent$addNextPage(c);b&&a.focusOn();a.TotalLoadedCount=a.RenderedData.length},focusOn:function(){var b=this.$container.find("ul").children("li").get(this.TotalLoadedCount),a=WP.DOM.Search.getNextFocusable(b);a&&a.focus()},autoClickStart:function(){var a=this;if(!a.AutoClickStarted&&typeof a.CurrentShowingDatList!=="undefined"&&a.CurrentShowingDatList!==null&&a.CurrentShowingDatList.length>0&&a.RenderedData.length!==0){a.PreviouslyShowingCount=a.$content.find("li.card:not(.hidden)").length;a.AutoClickStarted=true;a.AutoClickCount=0}},autoClickEnd:function(){var a=this;if(a.AutoClickCount>=a.MaxAutoClicks){a.stopAutoClick();return}if(a.AutoClickStarted)if(a.PreviouslyShowingCount!==a.$content.find("li.card:not(.hidden)").length)a.stopAutoClick();else{a.NeverAutoFocus=false;a.addNextPage();a.AutoClickCount++}},stopAutoClick:function(){var a=this;a.AutoClickStarted=false;a.PreviouslyShowingCount=-1;a.AutoClickCount=a.MaxAutoClicks},applyFilters:function(){var a=this;a._createUlBucket("past3month","3monthlist");a._createUlBucket("past6month","6monthlist");a._createUlBucket("past1year","past1yearlist");a._createUlBucket("after1year","after1yearlist");a.Components$CommunityListManagerComponent$applyFilters(true);a._applyDATFilters();a.ShowHideAllBuckets()},applyDATFilters:function(c,b){var a=this;a.CurrentShowingDatList=c;a._applyDATFilters();b&&a.HasMoreData&&a.load();a.ShowHideAllBuckets()},_applyDATFilters:function(){var a=this,h=0,f,d,i=0,e,g,b,c;f=a.$content.find("ul");for(d=0;d<f.length;d++){g=$afe.jq(f[d]).children("li");for(e=0;e<g.length;e++){b=$afe.jq(g[e]);c=parseInt(b.safeAttr("data-index"),10);if(isNaN(c))c=i;if(a._shouldBeShown(a.RenderedData[c])){h--;b.removeClass("hidden")}else{h++;b.addClass("hidden")}i++}}a.$content.trigger("resize",{forceShrink:h>0})},_shouldBeShown:function(a){var b=this;if(b.CurrentShowingDatList)return a.IsLocal&&b.CurrentShowingDatList.indexOf(a.Dat)>-1&&!(b.ContainerComponent.HeaderComponent.HideCanceledShifted&&a.IsCanceled);else{var c=b.shouldBeFiltered(a);return c?false:!(b.ContainerComponent.HeaderComponent.HideCanceledShifted&&a.IsCanceled)}},ShowHideAllBuckets:function(){var c="hidden",a=this;a.AllBucketsHidden=true;a._ShowHideBucket("past3month","3monthlist");a._ShowHideBucket("past6month","6monthlist");a._ShowHideBucket("past1year","past1yearlist");a._ShowHideBucket("after1year","after1yearlist");var b=a.$content.find("div.nodatalistelement");if(a.AllBucketsHidden)b.removeClass(c);else b.addClass(c);var d=b.find("span");if(typeof a.CurrentShowingDatList!=="undefined"&&a.CurrentShowingDatList!==null&&a.CurrentShowingDatList.length>0&&a.RenderedData.length!==0){a.autoClickEnd();if(a.ContainerComponent.FooterComponent.$content.find('[data-id="loadmore"]').length===1&&a.AllBucketsHidden){a.NeverAutoFocus=false;a.addNextPage();b.addClass(c)}else d.text($$WP.Strings.getForTemplate("NoPastVisitsWithFilters","Visits"))}else d.text($$WP.Strings.getForTemplate("NoDataToDisplay","Visits"))},_ShowHideBucket:function(c,d){var a="hidden",b=this.$content.find("."+d);if(this.$content.find("."+c+":not(.hidden)").length===0)!b.hasClass(a)&&b.addClass(a);else{b.removeClass(a);this.AllBucketsHidden=false}},_keydown:function(a){if(a.keyCode===13)return this._click(a)},_createUlBucket:function(c,d){var a,b;a=this.$content.find(".placeholder ."+c);if(a.length!==0){b=$afe.select("."+d+" .timeLineDetails ul.cardlist");b.safeAppend(a)}},_getListHtml:function(b,a){a=this.RefreshBannerViewModel;return this.Components$CommunityListManagerComponent$_getListHtml(b,a)},_createRefreshBannerViewModel:function(e,a,b){if(!e)return;var f=this._areAnyDxrOrgs(e),d=false,c=false;if(a&&a.length>0)d=true;else if(b&&b.length>0)c=true;this.RefreshBannerViewModel={Locale:MyChartLocale,ShowDxrBannerAction:f,NonEpicWarningText:$$WP.Strings.getForTemplate("NonEpicVisitRefreshWarningText","Visits"),HasOrgsLoading:d,LoadingOrgNames:a,HasOrgsWithErrors:c,ErrorOrgNames:b}},_areAnyDxrOrgs:function(c){var a,b=false;for(var d in c){a=c[d];if(a&&a.ViewbagProperties&&a.ViewbagProperties.LinkType)b=b||a.ViewbagProperties.LinkType=="3"}return b}};$$WP.Visits.PastVisitsListComponent.extend("Components.CommunityListManagerComponent")