/*! Copyright Epic Systems Corporation 2016-2019 */
$$WPUtil.guaranteeExistence($$WP,"Visits");$$WP.Visits.VisitCategory={UPCOMING_APPOINTMENT:1,UPCOMING_SURGERY:2,PAST_APPOINTMENT:3,PAST_ADMISSION:4,PAST_ED:5,PAST_SURGERY:6,UPCOMING_ADMISSION:7,UPCOMING_LD:8,UPCOMING_ED:9};$$WP.Visits.UpcomingVisitsListComponent=function UpcomingVisitsListComponent(b){var a=this;a.Components$TemplateComponent(b);a._hightlightCalendar=$.proxy(a._hightlightCalendar,a);a.addEventListener("click",a._click);a.addEventListener("keydown",a._keydown)};$$WP.Visits.UpcomingVisitsListComponent.prototype={template:$$WP.Templates.Visits.UpcomingVisitsList,SupportAnimations:false,Url:makeLink("Visits/VisitsList/LoadUpcoming"),IsClosable:false,TitleText:null,ContainerComponent:$$WP.Visits.VisitsListContainer.prototype,DataFromMultipleSources:true,AreaName:"VisitsUpcoming",Class:"visitcomponent upcomingvisits",Filter:"None",NoUpcomingVisits:false,HasFinishedLoading:false,load:function(){var a=$$WPUtil.queryString("xorgcsn"),b=$$WPUtil.queryString("xorgid");if(a&&a.length>0&&b&&b.length>0){b=decodeURIComponent(b);a=decodeURIComponent(a);window.history.replaceState({},document.title,window.location.href.split("?")[0]);$.post({url:makeLink("TelemedicineHome/GetOrganizationAndVerifyVisit"),data:{orgId:b,csn:a},cache:false,async:true,success:$.proxy(this.__afterGetOrganizationAndVerifyVisit,this)})}this.Components$TemplateComponent$load()},__afterGetOrganizationAndVerifyVisit:function(a){var c="Visits",b=this;if(a)if(a.MissingLink||a.Failure)b.__showError($$WP.Strings.getForTemplate("ErrorWebRequestFailed",c));else if(a.DeadLink)if(a.SuccessfullyRemovedDeadLink)b.__showError($$WP.Strings.getForTemplate("ErrorLinkIsDeadSuccess",c));else b.__showError($$WP.Strings.getForTemplate("ErrorLinkIsDeadFailure",c));else a.Organization&&b._h2gPopupHelper(null,a.Organization,"visitdetails",{csn:a.CSN})},__showError:function(c,a){$$WP.Strings.setDefaultNamespace("Visits");var e=$$WP.Strings.getForTemplate("ErrorTitle"),d=$$WP.Strings.getForTemplate("ErrorClose");$$WP.Strings.clearDefaultNamespace();var b=new $$WPComp.MessageComponent({TitleText:e,Message:c,ToolbarButtons:[new $$WPComp.ComplexObjects.Button(d,null,"cancelworkflow","")],callback:a});$$WPUtil.quickPopup(b)},_h2gPopupHelper:function(d,a,c,b){$$WP.CommunityUtilities.openDeepLink(c,a,b,null,function(){location.reload()},this)},setData:function(a){var e=true,c=this,b,d,f;$$WP.Strings.setDefaultNamespace("Visits");f=$$WP.Visits.VisitCategory;if(!a.LaterVisitsList&&!a.NextNDaysVisits)c.NoUpcomingVisits=a.EmptyList=e;else{if(a.LaterVisitsList.length>0)a.HasFuture=e;if(a.NextNDaysVisits.length>0)a.HasSoon=e;if(a.InProgressVisits.length>0)a.HasInProgress=e;c.NoUpcomingVisits=a.HasNoData=!a.HasSoon&&!a.HasFuture}if(a.HasSoon)for(b=0;b<a.NextNDaysVisits.length;b++){d=a.NextNDaysVisits[b];c._setUpVisit(d)}if(a.HasInProgress)for(b=0;b<a.InProgressVisits.length;b++){d=a.InProgressVisits[b];c._setUpVisit(d);d.IsInProgress=e}if(a.HasFuture)for(b=0;b<a.LaterVisitsList.length;b++){d=a.LaterVisitsList[b];(d.EncounterType===f.UPCOMING_ADMISSION||d.EncounterType===f.UPCOMING_LD)&&c._getVisitTypeNameForAdmission(d)}if(!a.EmptyList){setTimeout(c._hightlightCalendar,1e3);c.HasFinishedLoading=e;c.ContainerComponent.resetSplitter();c.ContainerComponent.drawPastVisitListHeart()}$$WP.Strings.clearDefaultNamespace("Visits");c.Components$TemplateComponent$setData(a)},_setUpVisit:function(a){var g=null,h="@MYCHART@TIMEZONE@",p="@MYCHART@TIME@",o="@MYCHART@DATE@",n="MutipleProvidersDescriptionListPage",m="SingleProviderDescriptionListPage",f="</span>",l="@MYCHART@BOLDMARKUPEND@",d="Visits",c=false,e='<span class="bold">',k="@MYCHART@BOLDMARKUPSTART@",j="@MYCHART@VISITTYPE@",i="@MYCHART@PROVIDER@",b=$$WP.Visits.VisitCategory;a.DurationString=$$WPSchedulingUtil.GetMinutesAndHoursFromMinutes(a.DurationInMinutes);$$WP.Strings.addMnemonic(i,a.PrimaryProviderName);$$WP.Strings.addMnemonic(j,a.VisitTypeName);$$WP.Strings.addMnemonic(k,e,c,d,$$WP.Strings.EncodingTypes.None);$$WP.Strings.addMnemonic(l,f,c,d,$$WP.Strings.EncodingTypes.None);if(a.EncounterType===b.UPCOMING_APPOINTMENT||a.EncounterType===b.UPCOMING_SURGERY)if(a.IsSingleProvider||a.EncounterType===b.UPCOMING_SURGERY)a.VisitDescription=$$WP.Strings.get(m);else a.VisitDescription=$$WP.Strings.get(n);else if(a.EncounterType===b.UPCOMING_ADMISSION||a.EncounterType===b.UPCOMING_LD||a.EncounterType===b.UPCOMING_ED){if(!a.PrimaryProviderName)a.VisitDescription="";else if(a.HasProcedures)if(a.IsSingleProvider)a.VisitDescription=$$WP.Strings.get(m);else a.VisitDescription=$$WP.Strings.get(n);else a.VisitDescription=$$WP.Strings.get("PreAdmissionDescription");$$WP.Strings.addMnemonic(o,e+HTMLEncode(a.Date)+f,c,d,$$WP.Strings.EncodingTypes.None);if(!a.Time)a.ExpectedArrivalDateTime=$$WP.Strings.get("ExpectedArrivalDate");else{$$WP.Strings.addMnemonic(p,e+HTMLEncode(a.Time)+f,c,d,$$WP.Strings.EncodingTypes.None);if(a.TimeZone)$$WP.Strings.addMnemonic(h,e+HTMLEncode(a.TimeZone)+f,c,d,$$WP.Strings.EncodingTypes.None);else $$WP.Strings.addMnemonic(h,"");if(a.SurgeryTimeOfDay)a.ExpectedArrivalDateTime=$$WP.Strings.get("ExpectedArrivalDateAMPM");else a.ExpectedArrivalDateTime=$$WP.Strings.get("ExpectedArrivalDateTime");$$WP.Strings.removeMnemonic(p);$$WP.Strings.removeMnemonic(h)}$$WP.Strings.removeMnemonic(o)}$$WP.Strings.removeMnemonic(i);$$WP.Strings.removeMnemonic(j);$$WP.Strings.removeMnemonic(k);$$WP.Strings.removeMnemonic(l);if(a.Copay!==g&&typeof a.Copay!=="undefined"){a.Copay.UseAmountDueRawData=true;a.Copay.UseAmountPaidRawData=true;if(a.Copay.AmountDiscountedRawData===g)a.Copay.AmountDiscountedRawData=0;if(a.Copay.AmountDueRawData===g){a.Copay.AmountDueRawData=0;a.Copay.UseAmountDueRawData=c}if(a.Copay.AmountPaidRawData===g){a.Copay.AmountPaidRawData=0;a.Copay.UseAmountPaidRawData=c}if(a.Copay.CanPay&&a.Copay.AmountDiscountedRawData>0)a.Copay.OriginalAmount=a.Copay.AmountDueRawData+a.Copay.AmountDiscountedRawData+a.Copay.AmountPaidRawData}(a.EncounterType===b.UPCOMING_ADMISSION||a.EncounterType===b.UPCOMING_LD)&&this._getVisitTypeNameForAdmission(a)},_getVisitTypeNameForAdmission:function(a){var b=$$WP.Visits.VisitCategory;if(a.VisitTypeName==="")if(a.EncounterType===b.UPCOMING_ADMISSION)a.VisitTypeName=$$WP.Strings.get("AdmissionWithoutService");else a.VisitTypeName=$$WP.Strings.get("LD")},refresh:function(){this.Components$TemplateComponent$refresh();this.ContainerComponent.HeaderComponent.determineFilterButtonStatus()},_hightlightCalendar:function(){if(typeof window.sidebarContainer!=="undefined"){this.Data.MonthsMap="";window.sidebarContainer&&window.sidebarContainer._Components&&window.sidebarContainer._Components[0]&&window.sidebarContainer._Components[0]._Components&&window.sidebarContainer._Components[0]._Components[0]&&window.sidebarContainer._Components[0]._Components[0].setData(this.Data)}},_keydown:function(a){if(a.keyCode===13)return this._click(a)},_click:function(b){var k="reschedule",j="echeckin",i="visitdetails",h="inside.asp?mode=visitdetails&csn=",g="laterdetail",c=this,a,f;typeof b.dataId==="undefined"&&b.preventDefault();b.dataId==="ignore"&&b.preventDefault();var l=b.dataId;if(b.$dataId.is("li"))f=b.$dataId;else f=b.$dataId.closest("li.card");var d=f.index();if(l!=g&&!f.parent().hasClass("inprogressvisits"))d=d+c.Data.InProgressVisits.length;var e=c.Data.InProgressVisits.concat(c.Data.NextNDaysVisits);switch(l){case"nextdetail":a=e[d];if(a.IsLocal)$$WP.Utilities.TryRedirect(makeLink(h+a.Csn));else c._h2gPopupHelper(a,a.Organization,i,{csn:a.Csn});b.preventDefault();break;case g:a=c.Data.LaterVisitsList[d];if(a.IsLocal)$$WP.Utilities.TryRedirect(makeLink(h+a.Csn));else c._h2gPopupHelper(a,a.Organization,i,{csn:a.Csn});b.preventDefault();break;case j:a=e[d];if(a.IsLocal)$$WP.Utilities.TryRedirect(makeLink("echeckin?csn="+a.CsnForECheckIn+"&fromlistpage=1"));else c._h2gPopupHelper(a,a.Organization,j,{csn:a.CsnForECheckIn});b.preventDefault();break;case"cancel":a=e[d];if(a.IsLocal)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=apptdircancel&csn="+a.Csn));else $$WP.CommunityUtilities.openDeepLink("apptdircancel",a.Organization,{csn:a.Csn},null,function(){location.reload()},c);b.preventDefault();break;case"requestcancel":a=e[d];if(a.IsLocal)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=apptcancel&csn="+a.Csn));else $$WP.CommunityUtilities.openDeepLink("apptcancel",a.Organization,{csn:a.Csn},null,function(){location.reload()},c);b.preventDefault();break;case k:a=e[d];if(a.IsLocal)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=apptmake&action=schednewstart&flow=reschedule&eCSN="+a.Csn));else $$WP.CommunityUtilities.openDeepLink("apptmake",a.Organization,{action:"schednewstart",flow:k,eCSN:a.Csn},null,function(){location.reload()},c);b.preventDefault();break;case"msgdetail":$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=messages"));b.preventDefault()}},setFilter:function(b){var a=this;if(b===a.Filter)return;a.Filter=b;switch(b.split("~")[0]){case"None":case"organization":a.applyFilters();return;default:a.reload();return}},applyFilters:function(e){var a="hidden",b=this,f=b,j,k,i,m,h,l,g,c,d=0;i=b.$content.find("div.listsection");i.removeClass(a);m=b.$content.find(".latervisits");h=m.parent().parent();h.removeClass(a);l=b.$content.find(".sevendaysvisits");g=l.parent().parent();g.removeClass(a);c=b.$content.find("div.nodatalistelement");c.removeClass(a);var o=f.Data.InProgressVisits.concat(f.Data.NextNDaysVisits);l.children("li").each(function(g,c){var b=$afe.jq(c);if(f.shouldBeFiltered(o[g],e)){if(!b.hasClass(a)){b.addClass(a);d++}}else if(b.hasClass(a)){b.removeClass(a);d--}});m.children("li").each(function(g,c){var b=$afe.jq(c);if(f.shouldBeFiltered(f.Data.LaterVisitsList[g],e)){if(!b.hasClass(a)){b.addClass(a);d++}}else if(b.hasClass(a)){b.removeClass(a);d--}});j=b.$content.find(".sevendaysvisits li.card:not(.hidden)");k=b.$content.find(".latervisits li.card:not(.hidden)");if(k.length===0)!h.hasClass(a)&&h.addClass(a);if(j.length===0)!g.hasClass(a)&&g.addClass(a);if(k.length===0&&j.length===0){!i.hasClass(a)&&i.addClass(a);c.hasClass(a)&&c.removeClass(a);var n=c.find("span");if(typeof e!=="undefined"&&e!==null&&e.length>0&&!b.NoUpcomingVisits)n.text($$WP.Strings.getForTemplate("NoUpcomingVisitsWithFilters","Visits"));else n.text($$WP.Strings.getForTemplate("NoUpcomingVisitsLabel","Visits"))}else!c.hasClass(a)&&c.addClass(a);b.$content.trigger("resize",{forceShrink:d>0})},shouldBeFiltered:function(c,a){var b=this;if(typeof a!=="undefined"&&a!==null&&a.length>0)return!b.__isVisitOrComponentInList(c,a);else{b.Filter=b.Filter||"";var d=b.Filter.split("~");return d[0]==="organization"&&c.Organization.OrganizationId!==d[1]}},__isVisitOrComponentInList:function(b,e){var c=0,d=null,a=false;if(e.indexOf(b.Dat)!==-1)a=true;else if(b.HasComponentVisits)for(c=0;c<b.ComponentVisits.length;c++){d=b.ComponentVisits[c];a=a||this.__isVisitOrComponentInList(d,e)}return a},html:function(b){var a;this.ContainerComponent.resetSplitter();this.Components$TemplateComponent$html(b);a=$afe.select(".PVGbanner");a.length>0&&a.unbind().bind("click",function(b){b.preventDefault();var a=new $$WP.Visits.PatientVisitGuide;a.generateFile()})}};$$WP.Visits.UpcomingVisitsListComponent.extend("Components.TemplateComponent")