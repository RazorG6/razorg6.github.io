$$WPUtil.guaranteeExistence($$WP,"Scheduling.AutoWaitList.Components");$$WP.Scheduling.AutoWaitList.Components.AutoWaitListComponent=function(b){var a=this;a.Components$ViewComponent(b);a.context=parseInt(a.context,10)||0;a.csn=a.csn||0;a.load(makeLink("Scheduling/AutoWaitList/Index?context="+a.context+"&csn="+encodeURIComponent(a.csn)));a.addEventListener("click",a._clickAWL)};$$WP.Scheduling.AutoWaitList.Components.AutoWaitListComponent.prototype={Url:makeLink("Scheduling/AutoWaitList/Index"),SupportAnimations:true,_bodyHeights:[],respond:function(f,e,d,c,a){var b=this;getCSRFTokenAsQS(function(k){var g,h,i,j;if(a){g=$$WPComp.getInstance(a.find(".inlineloading").safeAttr("data-component-id"));i=a.innerHeight(true);if(!g){g=new $$WPComp.InlineLoadingComponent;a.safePrepend(g.$container);a.addClass("waitingforresponse");j=a.innerHeight();a.css("height",i+"px");a.css("height",j+"px");b.$container.trigger("resize",{delta:j-i});b._bodyHeights[a.data("id")]=null}h={$alertContent:a,h:0}}b.makeRequest({url:makeLink("Scheduling/AutoWaitList/RespondToOffer?&csn="+f+"&line="+e+"&accept="+d+"&mark="+c),type:"POST",dataType:"json",data:k,success:b.redirectAction},"respond",g,h);if(h)h.oldHeight=i})},mark:function(c){var b="data-view",a=$afe.select("#alerts-head-"+this.ComponentNumber+"-"+c);if(a.safeAttr(b)==="1")return;a.safeAttr(b,"1");this.makeRequest({url:makeLink("Scheduling/AutoWaitList/MarkOffersAsViewed?mark="+encodeURIComponent(a.safeAttr("data-mark"))),success:function(){},type:"POST"},"mark",false)},_clickAWL:function(a){var b=a.$target.closest("*[data-object]");if(b.length>0)b=b.safeAttr("data-object");switch(b){case"head":case"body":case"tab":this.mark(a.dataId);this.toggleBody(a.dataId);return false;case"response":this.respond(encodeURIComponent(a.$target.safeAttr("data-csn")),a.$target.safeAttr("data-line"),a.$target.safeAttr("data-accept"),encodeURIComponent(a.$target.safeAttr("data-mark")),a.$target.closest(".alertcontent"));return false}},toggleBody:function(c){var h="alerttab-down",g="margin-top",e="alerttab-up",a=this,d,f,b,i;d=$afe.select("#alerts-body-"+a.ComponentNumber+"-"+c);b=d.parent().next();i=b.hasClass(e);a._bodyHeights[c]=a._bodyHeights[c]||d.outerHeight(true);a.$content.css("height","");if(!i){d.css(g,"");a.$container.trigger("resize",{delta:a._bodyHeights[c]});b.removeClass(h);b.addClass(e)}else{f=-a._bodyHeights[c];d.css(g,f+"px");a.$container.trigger("resize",{delta:f});b.addClass(h);b.removeClass(e)}},html:function(g){var c="hidden",d=".loginalert .component",a=this;a.Components$Component$html(g);WP.Utils.minifyElement($afe.select(".loginalert"));$$WP.Behaviors.matchRowHeights($afe.select(d),".alertcontent .apptDetails");$$WP.Behaviors.matchRowHeights($afe.select(d),".alertcontent .apptoffer");if(g.replace(new RegExp("\x0d|\x0a","g"),"").length===0){var e=$afe.select("#updatewaitlist");e.length&&e.removeClass(c);a.dispose();return}if(a.context){var f=$afe.select("#alerts");f.removeClass(c);f.next("br").removeClass(c)}var b;b=a.$container.parent().closest("[data-component-id]");b.css("height","");b.children(".content").css("height","");a._recalcHeights();a.$container.trigger("resize")},redirectAction:function $$WP$Scheduling$AutoWaitList$Components$Alert$redirectAction(b,r){var l="cancelworkflow",k="ButtonClose",q="&scheduled=1",p="inside.asp?mode=visitdetails&csn=",o="TitleSuccessAccept",i=null,j="resize",a=this,f=r.$alertContent.closest(".loginalert.tab"),t;if(f.length===0)f=a.$content.children(".loginalert");if(b.status===1){if(f.find(".alertcontent").length<=1){t=-f.outerHeight(true);f.remove();if(a.$content.html().replace(/[^a-z]/gi,"").length===0){a.dispose();$afe.select("#alerts").closest(".component").trigger(j)}else{var s=$afe.select("#alertspanel-autowaitlist");s&&s.hide();a.$container.trigger(j,{delta:t})}}else{r.$alertContent.remove();a.$container.css("height","");a.$container.trigger(j)}a._bodyHeights[f.children("a").data("id")]=i}var c=$$WP.Strings.getNamespace("Scheduling.AutoWaitList.ConfirmationPopup"),h;if(b.csn)if(a.context===2){h=new $$WPComp.MessageComponent({TitleText:c.getStringForTemplate(o),Message:c.getString("MessageSuccessAccept"),callback:$$WPUtil.TryRedirect,CallbackArgs:[makeLink(p+encodeURIComponent(b.csn)+q)],ToolbarButtons:[new $$WPComp.ComplexObjects.Button(c.getStringForTemplate(k),i,l,"")]});$$WPUtil.quickPopup(h)}else if(b.canRedirect)$$WPUtil.TryRedirect(makeLink(p+encodeURIComponent(b.csn)+q));else{h=new $$WPComp.MessageComponent({TitleText:c.getStringForTemplate(o),Message:c.getString("MessageSuccessAcceptNoRedirect"),callback:a.context===0?function(){}:function(){window.location.reload()},ToolbarButtons:[new $$WPComp.ComplexObjects.Button(c.getStringForTemplate(k),i,l,"")]});$$WPUtil.quickPopup(h)}else if(b.accept&&b.status===1)location.reload();else{var n="Title",m="Message",g="",e="",d;switch(b.status){case 0:d="Error";if(b.accept)g="Accept";else g="Decline";switch(b.offerStatus){case 0:e="Active";break;case 1:e="Accepted";break;case 2:e="Declined";break;case 3:e="Expired";break;case 4:case 5:e="Unavailable"}break;case 1:d="Success";g="Decline";break;case 2:d="Pending";break;default:d="Default"}n=n+d+g;m=m+d+g+e;$$WPUtil.quickPopup(new $$WPComp.MessageComponent({ToolbarButtons:[new $$WPComp.ComplexObjects.Button(c.getStringForTemplate(k),i,l,"")],callback:b.status===0?a.refresh:function(){},CallbackContext:a,TitleText:c.getStringForTemplate(n),Message:c.getString(m)}))}},refresh:function(){this.Components$ViewComponent$refresh();this.$content.empty();this.$container.trigger("resize",{forceShrink:true})},hide:function(){var a=this,b=a.$container.parent(),c=b.outerHeight(true);a.__containerTargetHeight=1;a.$container.parent().css("display","none");a.Components$ViewComponent$hide();b.closest(".component").trigger("resize",{delta:-c+1});$afe.jq(window).off("resize","",$.proxy(a._onresize,a))},show:function(){var a=this;a.$container.parent().css("display","");a.Components$ViewComponent$show();if(!isDataTile())$afe.jq(window).on("resize","",a.ComponentNumber,$.proxy(a._onresize,a))},_onresize:function(b){var a=$$WPComp.getInstance(b.data)||this;if(a===null||!$$WPComp.isComponent(a))return;a._recalcHeights();a.$content.children(".loginalert").children(".body").each(function(f,b){var d=b.getAttribute("data-id"),c=$afe.jq(b),e=parseInt(c.css("margin-top"),10);if(e<0){c.parent().parent().children("img").removeClass("alerttab-up");a.toggleBody(d)}});a.$container.trigger("resize",{forceShrink:true})},_recalcHeights:function(){var a=this;this.$container.find(".body").each(function(g,f){var b="margin-top",c=$afe.jq(f),d=parseInt(c.css(b),10),e=parseInt(c.safeAttr("data-id"),10);a._bodyHeights[e]=c.outerHeight(true)-d;if(d<0){c.css(b,-a._bodyHeights[e]+"px");return}})},dispose:function(){var a=$afe.select("#alertspanel-autowaitlist"),b=a.outerHeight(true);a.remove();this.Components$ViewComponent$dispose();a=$afe.select("#alerts");a.closest(".component").trigger("resize",{delta:-b});!a.children().length&&a.remove()}};$$WP.Scheduling.AutoWaitList.Components.AutoWaitListComponent.extend("Components.ViewComponent");$$WPUtil.guaranteeExistence($$WPUtil,"ComponentFactory.HomePage");$$WPUtil.ComponentFactory.HomePage.AutoWaitList=function CF$HP$AWL(c,e,a){var b=$afe.select("#alertspanel-autowaitlist");if(!b.length)b=$afe.select("#alertspanel-expiredautowaitlist");if(b.length||a.$parent&&a.$parent.length){a=$$WPUtil.mergeObjects({context:c,csn:e,$parent:b},a,true,false);var d=new $$WP.Scheduling.AutoWaitList.Components.AutoWaitListComponent(a);d.show()}};function $$WP$Scheduling$AutoWaitList$Components$Alert$SetUpAddToWaitList(g,e,j,k){var b="Scheduling/AutoWaitList/AddAppointmentToWaitList",a="&addRemove=",d="Scheduling.AutoWaitList.UpdateWaitListErrorPopup",f=$afe.select("#updatewaitlist_button");if(f.length){$$WP.Strings.setDefaultNamespace(d);var c={button:$$WP.Strings.getForTemplate("ErrorClose"),title:$$WP.Strings.getForTemplate("ErrorTitle"),content:$$WP.Strings.get("ErrorContent")};$$WP.Strings.clearDefaultNamespace();var l=[new $$WPComp.ComplexObjects.Button(c.button,null,"previousstep","continue")],i=function(){new $$WP.Popups.MessagePopup(c).show()},h=function(a){if(a.success===true)if(k)$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=apptdetails&csn="+g));else location.reload();else new $$WPUtil.quickMessageBox(c.content,c.title,l)};if(e===2&&j)f.unbind().bind("click",function(f){f.preventDefault();$$WP.Strings.setDefaultNamespace(d);var c={ToolbarButtons:[{Text:$$WP.Strings.get("ConfirmOK"),Class:"otherbutton"},{Text:$$WP.Strings.get("ConfirmCancel"),Class:"inlinedelete"}],TitleText:$$WP.Strings.get("ConfirmTitle"),Html:$$WP.Strings.get("ConfirmContent"),callback:function(c){c&&getCSRFTokenAsQS(function(c){var d=c+"&csn="+encodeURIComponent(g)+a+e;$.ajax({url:makeLink(b),type:"POST",data:d,error:i,success:h})})}};$$WP.Strings.clearDefaultNamespace();$$WPUtil.quickPopup(new $$WPComp.ConfirmComponent(c))});else f.unbind().bind("click",function(c){c.preventDefault();getCSRFTokenAsQS(function(c){var d=c+"&csn="+encodeURIComponent(g)+a+e;$.ajax({url:makeLink(b),type:"POST",data:d,error:i,success:h})})})}}